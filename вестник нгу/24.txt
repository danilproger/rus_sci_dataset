ЛОКАЛИЗАЦИЯ ИСТОЧНИКОВ АКТИВНОСТИ МОЗГА  НА ЕГО ТРЕХМЕРНОЙ МОДЕЛИ ПРИ ПОМОЩИ СОВМЕСТНОГО АНАЛИЗА   ДАННЫХ ЭЭГ/CМРТ   

Несмотря на большое количество существующих методов диагностики головного мозга, он остается наименее изученной частью человеческого организма. Электроэнцефалография (ЭЭГ) – один из наиболее популярных методов исследования мозговой активности. Это обусловлено относительной дешевизной, безвредностью  и мобильностью оборудования. При анализе данных ЭЭГ возникает проблема решения обратной задачи электроэнцефалографии – локализации источников электрической активности мозга. Ее можно сформулировать следующим образом: по сигналам, регистрируемым на поверхности головы, необходимо определить, в какой области мозга расположены источники этих сигналов. Целью исследования является разработка программной системы для локализации источников мозговой активности на основе совместного анализа данных ЭЭГ и сМРТ. Существуют различные подходы к решению обратной задачи ЭЭГ. Для получения наиболее точных результатов некоторые из них предполагают использование данных сМРТ (изображений структурной магнитнорезонансной томографии), описывающих индивидуальную анатомию головы человека. В этой работе используется один из таких подходов – EMSICA (Electromagnetic Spatiotemporal Independent Component Analysis), предложенный A. Tsai. В статье рассмотрены основные этапы работы системы, такие как предварительная обработка исходных данных; расчет специальной матрицы подхода EMSICA, значения которой показывают уровень активности определенного участка мозга; визуализация источников активности мозга на его трехмерной модели.  

, Мозг выполняет огромное количество жизненно важных функций человека, поэтому точная и своевременная диагностика состояния головного мозга одна из ключевых задач современной медицины. Мозг человека активно исследуют посредством измерения и анализа его анатомии, биоэлектрической активности и т. п. Один из наиболее популярных методов исследования мозговой активности электроэнцефалография ЭЭГ метод оценки функционального состояния головного мозга при помощи регистрации и анализа электрических сигналов на поверхности головы. Электроэнцефалография занимает важное место среди методов функциональной диагностики состояния мозга. Несмотря на появление таких диагностических методов, как магнитно-резонансная томография МРТ, функциональная магнитно-резонансная томография, позитронно-эмис сионная томография ПЭТ и др., интерес врачей и исследователей к электроэнцефалографии и методам ее анализа в последнее время возрастает. Популярность ЭЭГ связана со сравнительно низкой стоимостью оборудования и его мобильностью, безвредностью ввиду отсутствия вредных для мозга излучений. Также стоит отметить, что ЭЭГ чувствительный метод исследования, он отражает малейшие изменения состояния коры головного мозга и глубинных мозговых структур, обеспечивая миллисекундное временное разрешение, недоступное другим методам исследования мозговой активности. При анализе ЭЭГ-данных возникает проблема решения обратной задачи электроэнцефалографии локализации источников электрической активности мозга. Ее можно сформулировать следующим образом по ЭЭГ сигналам, регистрируемым на поверхности головы, необходимо определить, в какой области мозга расположены источники этих сигналов. Целью данной работы является разработка программной системы для локализации источников мозговой активности на основе совместного анализа данных ЭЭГ и сМРТ. Локализация источников ЭЭГ основана на широком спектре методов обработки сигналов, включающих цифровую фильтрацию, анализ трехмерных изображений, обработку массивов сигналов, моделирование и реконструкцию изображений, слепое разделение источников 1. Наиболее распространенным подходом к решению обратной задачи ЭЭГ является определение пространственных характеристик и силы токовых диполей для компонент, вычисленных при помощи анализа независимых компонент Independent Component Analysis ICA. Данный алгоритм был разработан Aapo Hyvrinen и Erkki Oja 2. Его основное преимущество использование только ЭЭГ-данных для нахождения источников сигналов, кроме того данный метод включен в распространенный программный пакет EEGLAB. Но такой подход не учитывает индивидуальную анатомию человеческого мозга, что ведет к ошибкам в определении расположения источников активности. Еще одним распространенным методом локализации источников мозговой активности является электромагнитная томография низкого разрешения LORETA 3. Для получения наиболее точных результатов некоторые подходы предполагают использование данных МРТ, которые дают высокоточную информацию об индивидуальной анатомии головы человека. МРТ способ получения томографических медицинских изображений для исследования внутренних органов и тканей с использованием явления ядерного магнитного резонанса. Изображения структурной МРТ сМРТ мозга предоставляют данные об анатомических структурах мозга с высоким пространственным разрешением. Одним из подходов, использующих МРТ для решения обратной задачи ЭЭГ, является метод одновременной регистрации данных ЭЭГ и МРТ, описанный K. J. Mullinger и др. 4. Данный способ точно локализует источники сигнала в головном мозге, но он крайне затратен по временным и денежным ресурсам. В этой работе предполагается использование подхода, который также использует МРТданные электромагнитный пространственно-временной анализ независимых компонент Electromagnetic Spatiotemporal Independent Component Analysis EMSICA, предложенного A. Tsai 5 6. Данный метод является модификацией анализа независимых компонент, в то же время он использует МРТ-данные. Его преимущество перед одновременной регистрацией данных ЭЭГ и МРТ использование одних данных МРТ для разных ЭЭГ-экспериментов одного и того же обследуемого. В статье подробно описана математическая модель электромагнитного пространственновременного анализа независимых компонент, оригинальный алгоритм, а также предложенная модификация этого алгоритма. Также описан процесс предварительной обработки данных ЭЭГ и МРТ для использования алгоритмом. Представлена архитектура разработанной системы, этапы ее работы, пользовательский интерфейс, а также некоторые детали реализации. Особое внимание уделено подходу к визуализации источников мозговой активности. Электромагнитный пространственно-временной анализ независимых компонент, предложенный A. Tsai 5, основан на совместном анализе данных ЭЭГ и МРТ. Этот метод является модификацией ICA, и его основное преимущество использование информации об индивидуальной анатомии головы обследуемого. Стоит отметить, что данные сМРТ регистрируются один раз независимо от регистрации ЭЭГ-данных. Иначе говоря, можно получать источники мозговой активности для каждого нового ЭЭГ-обследования без повторного МРТ-обследо вания. В данном подходе расположение источников мозговой активности будет определяться на поверхности коры головного мозга. Для этого предполагается разделить поверхность головного мозга на тесселяционных элементов здесь под тесселяционным элементом подразумевается небольшой участок на поверхности коры головного мозга. Математическая модель данного метода 5 выглядит следующим образом 1 известная векторная функция от времени, содержащая данные ЭЭГ-сигналов, в реальном наборе данных представляется как . неизвестная векторная функция от времени, описывающая искомые разделенные сигналы, в реальном наборе данных представляется как . известная матрица потенциальных полей, содержащая информацию о геометрии и проводимости модели. неизвестная матрица весов с элементами, которые задают уровень активности -го источника в -м тесселяционном элементе на коре. Таким образом, по значениям столбца можно определить активные участки коры мозга, соответствующие -й компоненте. Задача заключается в поиске матрицы по известным и для последующей визуализации активных участков мозга в виде компонент EMSICA. Предполагается, что, чтобы гарантировать существование матрицы . Также в 5 утверждается, что матрица в 1 может быть интерпретирована аналогично матрице смешивания подхода анализа независимых компонент. В байесовском подходе 1 обратную задачу можно сформулировать как оценку распределения источников на коре, а также соответствующих им сигналов по данным, записанным с электродов. Расположение источников, т. е., можно оценить, максимизируя следующую апостериорную вероятность 11 2 Здесь обозначает пропорциональность, т. е. то же самое, что . Если предположить независимость расположения источников на поверхности коры и независимость сигналов во времени, справедливо . Тогда Чтобы избавиться от неудобного параметра по правилам байесовского подхода уравнение 2 можно преобразовать к 3 Поскольку исходные компоненты считаются независимо распределенными, априорную вероятность можно представить в виде произведения априорных вероятностей отдельных источников, т. е. . Тогда на основе подхода алгоритма Infomax ICA 7, также использующего байесовский подход, интеграл в правой части уравнения 3 можно преобразовать следующим образом . Элементы -го столбца матрицы могут рассматриваться как случайный вектор, и предполагается, что эти векторы имеют независимое распределение в пространстве, тогда их распределение . На основе изложенного апостериорная вероятность имеет следующий вид 4 В работе A. Tsai 6 выдвинуто предположение, что и имеют следующий вид 5 6 На основе представленных в статье 6 формул приведем подробное описание используемых величин функций и диагональная матрица, каждое значение которой имеет вид гиперболический секанс, т. е. скалярный квадрат вектора . Скаляр является гиперпараметром. Из-за того, что временной интервал ЭЭГ-обследования временных единиц может быть достаточно большим, в подходе EMSICA предлагается разбить его на интервалы по единиц времени. Другими словами вектор-функция в реальном наборе данных представляет собой матрицу, тогда разобьем ее на блоков . Учитывая это, в работе A. Tsai было установлено, что апостериорная логарифмическая вероятность, соответствующая апостериорной вероятности в 4, имеет следующий вид На основе вышеизложенного для нахождения матрицы необходимо решить следующую задачу безусловной оптимизации 7 где A. Tsai предлагает найти максимум логарифмической вероятности с помощью метода градиентного спуска. Для этого берется ее градиент по здесь подразумевается взятие частной производной по каждому элементу матрицы где, матрицы со значениями и соответственно. На основании 5 и 6 нами были выведены следующие формулы где элемент матрицы Умножим правую часть уравнения 7 на 5 Тогда на каждой итерации градиентного спуска 8 В качестве правила окончания цикла было выбрано правило . Здесь возникает проблема поиска параметра в уравнении 8. Принятие параметра за константное значение и его эмпирический подбор не показали хорошего результата. Поэтому поиск параметра был произведен на основе модификации алгоритма Нелдера Мида 8. В результате эмпирических исследований нами были выбраны следующие значения гиперпараметров алгоритма, . Такие значения обеспечили наименьшее количество общего числа итераций оптимизационного алгоритма для предоставленного набора тестовых данных. Для исследования Научно-исследовательским институтом физиологии и фундаментальной медицины были предоставлены очищенные от шума ЭЭГ-данные в формате EEGLAB с расширением .set и данные структурной МРТ с расширением .nii. Алгоритм EMSICA в качестве входных данных принимает матрицу потенциальных полей, полученную на основе обработки данных МРТ и ЭЭГ, а также вектор-функцию или матрицу в дискретном виде, извлеченную из ЭЭГданных Исходя из предоставленных данных размерности . Количество тесселяционных элементов в этом исследовании . Программная система включает в себя модуль по обработке данных. После того, как пользователь загрузит файл с ЭЭГ-данными с расширением .set, а также файл с матрицей потенциальных полей с расширением .mat, запускается реализованный на языке MATLAB скрипт для извлечения необходимых данных. Далее описывается способ получения файла с матрицей потенциальных полей, примененный в результате подготовки данных для нашей программной системы. Решение обратной задачи ЭЭГ с использованием данных об анатомии мозга предполагает предварительное моделирование тканей головы и характеристик электродов. Матрица потенциальных полей матрица усиления, используемая в 1, содержит информацию о том, как электрический ток, протекающий в мозге, создает различия в электрических потенциалах на внешних датчиках ЭЭГ электродах, учитывая различные ткани головы. На основании подхода EMSICA для каждого обследуемого матрица рассчитывается на основе высококачественной реалистичной модели головы методом граничного элемента BEM boundary element method 9. В настоящее время существует несколько программных продуктов, выполняющих подобные вычисления. В этой работе для вычисления матрицы усиления было решено использовать программный пакет Brainstorm, который задокументирован и предназначен для скачивания онлайн под общедоступной лицензией GNU 10. Для расчета матрицы этому программному пакету необходимы данные модели головы, которые могут быть получены с помощью разных средств. Мы решили остановиться на программе BrainSuite. Выбор данных продуктов был обусловлен прежде всего удобством и простотой в использовании, а также наличием подробного руководства. Итак, сначала необходимо построить реалистичную модель головы в программном пакете BrainSuite. BrainSuite создает индивидуальные модели структур мозга на основе T1-взве шенной МРТ головы человека, в том числе модели внутренних и внешних границ коры головного мозга. Данные этой модели также будут использованы для визуализации активных участков мозга на его трехмерной модели. Предоставленные данные МРТ имеют высокое пространственное разрешение, и при построении модели головы в программе BrainSuite возникает сбой из-за превышения максимального размера стека памяти. Для решения этой проблемы был реализован скрипт OVERRIDEMRI для сжатия МРТ-данных на языке MATLAB на основе метода библиотеки Tools for NIfTI and ANALYZE image. После использования скрипта для сжатия нужно загрузить полученный файл в приложение BrainSuite и выбрать опцию для выполнения всех шагов извлечения поверхности коры головного мозга. В результате выполнения программы будут созданы файлы с моделями анатомических структур мозга. Теперь на основе полученных данных можно вычислить матрицу с помощью программного пакета Brainstorm. Сначала нужно импортировать данные анатомии мозга и файл с ЭЭГданными. В программном обеспечении Brainstorm по умолчанию считается, что электрическая активность, которая регистрируется датчиками, создается в основном набором электрических диполей, расположенных на поверхности коры 9. Используемая сетка источников диполей определяется поверхностью коры, каждая вершина этой поверхности рассматривается как диполь. Анализ данных в этой работе был проведен на основе 15 000 вершин значение, выставленное в Brainstorm по умолчанию. Использование меньшего количества вершин просто снизит разрешение результатов использование большего количества приводит к чрезмерному увеличению объема данных и может привести к проблемам с памятью. Для вычисления матрицы Brainstorm предлагает несколько методов. Основываясь на работах 5 6, нужно использовать OpenMEEG BEM метод граничного элемента из программного обеспечения с открытым исходным кодом OpenMEEG 11. В результате создается файл с расширением .mat, содержащий матрицу, а также координаты вершин сетки. Для извлечения этих данных из полученного файла был реализован скрипт на языке MATLAB, который включается в модуль по обработке данных нашей программной системы. Кортикальная карта, или изображение коры головного мозга -й компоненты EMSICA, может быть описана на основе значений соответствующего столбца матрицы, т. е., содержащего одно значение для каждого тесселяционного элемента. Чтобы найти и отобразить вершины, сильно активные в определенной карте компонент EMSICA, столбцы матрицы нормализуются по стандартному отклонению. Нормализованные значения матрицы обозначим . Участки мозга, для которых соответствующие абсолютные значения превышают некоторый порог, считаются сильно активными 5 и выделяются цветом на трехмерной модели головного мозга. Именно таким образом отображаются компоненты EMSICA в нашей системе. Здесь стоит отметить, что интерпретировать физический смысл ненормализованных значений довольно сложно, так как единицей измерения значений матрицы по СИ является 1 . Эта величина выведена из уравнения 1 на основе единиц измерения матрицы потенциальных полей 1 и матрицы ЭЭГ-данных именно такие единицы измерения имели извлеченные из файлов данные. Нормализованное значение отображает степень отклонения состояния соответствующего участка коры. При реализации модуля для визуализации компонент EMSICA возникла проблема совмещения сетки мозга, полученной в программном пакете Brainstorm, с реалистичной моделью мозга BrainSuite. Как уже отмечалось, наша программная система использует эти промежуточные данные для визуализации трехмерной модели головного мозга. На основе подхода EMSICA нам известен уровень активности вершин модели Brainstorm. Но так как мы визуализируем компоненты EMSICA на модели мозга BrainSuite, для каждой вершины этой модели необходимо найти ближайшую вершину модели Brainstorm. Для решения возникшей проблемы был разработан следующий подход. Сначала осуществляется поиск центров моделей мозга. Мы предполагаем, что центр это точка, имеющая минимальное среднее расстояние до вершин сетки. Формально это можно представить следующим образом вектор координат -й вершины сетки модели мозга искомый центр сетки модели мозга. Тогда поиск центра модели будет состоять в решении задачи оптимизации В качестве начального приближения центра модели мы выбрали центр масс . Будем считать что вершины модели Brainstorm вершины модели BrainSuite центр модели Brainstorm, центр модели BrainSuite, полученные на основе приведенного выше алгоритма. Тогда если вершина активная вершина, то все вершины такие, что угол между векторами и меньше, будем считать активными. Таким образом мы совмещаем центры моделей друг с другом. Стоит отметить, что приведение базисов не требуется, так как системы координат обеих моделей уже имеют один и тот же базис. Поэтому мы можем интерпретировать векторы и как радиусвекторы вершин соответствующих моделей в одной системе координат, при этом центры моделей будут совпадать с началом координат. Теперь поясним роль угла в нашем подходе. Предположим, что мы спроецировали вершины обеих моделей на сферу с центром в начале координат. Тогда будем считать, что для некоторой активной вершины модели Brainstorm, все вершины, проекции которых находятся в малой окрестности проекции вершины, являются активными. Очевидно, что при такой постановке, явное проецирование не требуется, так как такая окрестность может быть задана с помощью угла угла между радиус-векторами вершин обеих моделей. Разработанная система для локализации источников мозговой активности имеет три основных модуля. 1. Модуль предварительной обработки данных. 2. Модуль для вычисления компонент EMSICA. Данный модуль находит решение оптимизационной задачи 7. 3. Модуль для визуализации источников мозговой активности Модуль для обработки данных был реализован на языке MATLAB. Выбор языка определен прежде всего тем, что файл с матрицей потенциальных полей имеет формат данных программной системы MATLAB, поэтому здесь имеется богатый функционал для обработки подобных данных. Второй модуль также реализован на языке MATLAB и реализует алгоритм максимизации апостериорной логарифмической вероятности. После вычисления матрицы он осуществляет экспорт этой матрицы и набор координат модели Brainstorm для использования модулем визуализации. Модуль для визуализации компонент EMSICA разработан с помощью фреймворка Qt на языке C и предоставляет пользовательский интерфейс для работы со всей системой. Основной опцией нашей программной системы является визуализация кортикальных карт компонент EMSICA с заданным порогом, который характеризует уровень активности участков коры мозга. Также для осуществления дополнительного анализа компонент на основе программного комплекса EEGLAB предоставляется опция для создания и сохранения файла с расширением .set, который содержит данные о компонентах EMSICA, подобно данным о компонентах ICA матрицу смешивания, поэтому все механизмы анализа независимых компонент применимы и к новым компонентам. Программная система опробована на данных 10 человек, и, по экспертной оценке сотрудников НИИФФМ, было подтверждено, что полученные компоненты действительно локализуют наиболее активные участки мозга, а также имеют тенденцию к разделению коры мозга на стандартные анатомические области. Кроме того, отображение новых компонент с помощью программного пакета EEGLAB соответствует изображениям на трехмерной модели мозга для всех тестовых данных, что подтверждает выбранный для визуализации подход. На рис. 1 представлена визуализация компоненты EMSICA на трехмерной модели мозга нашей программной системы слева, а также двумерное изображение этой же компоненты, полученное в программном пакете EEGLAB справа. На рис. 2 изображена информация о частотной характеристике сигнала источника, соответствующей этой компоненте. Данные также получены в программном пакете EEGLAB. По частотному анализу видно, что найденный источник действительно проявляет активность в момент начала ЭЭГ-эксперимента выраженный пик в момент времени 0. Подход EMSICA для решения обратной задачи ЭЭГ объединяет сильные стороны существующих подходов, поэтому нами был выбран этот подход для разработки программной системы локализации источников мозговой активности. Во время исследования данного подхода были внесены некоторые уточнения и модификации, необходимые с точки зрения реализации. Также был разработан подход к визуализации компонент EMSICA на трехмерной модели головного мозга, полученной с помощью приложения BrainSuite. Результатом работы является программная система, которая позволяет визуализировать кортикальные карты компонент EMSICA, а также активные участки мозга в определенный момент времени. Кроме того, для получения большей информации о компонентах предусмотрена опция сохранения данных в файл с расширением .set, в результате чего может быть проведен дополнительный анализ полученных результатов в программном пакете EEGLAB. На данный момент разработанная система проходит апробацию в Научно-исследователь ском институте физиологии и фундаментальной медицины. 