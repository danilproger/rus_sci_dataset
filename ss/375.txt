СИНХРОНИЗАЦИЯ ПРОФИЛЕЙ ПОЛЬЗОВАТЕЛЕЙ MS SHAREPOINT PORTAL SERVER 2003 С ВНЕШНИМ ИСТОЧНИКОМ ДАННЫХ 

При построении корпоративных порталов одной из важных задач является синхронизация данных, публикуемых на портале, с данными, используемыми другими приложениями и хранимыми в различных форматах средствами различных СУБД. В случае, когда данные на портале могут редактироваться пользователями или сторонними приложениями, необходимо организовать их синхронизацию. Когда один из источников данных назначается главным, а другой подчиненным, синхронизация не представляет трудностей. В том случае, когда может потребоваться двунаправленность, необходимо обеспечить как прямую, так и обратную синхронизацию. В статье рассматриваются решение задачи синхронизации профилей пользователей MS SharePoint Portal Server 2003 (SPS) с внешним источником данных – унаследованной подсистемой отдела кадров и обратная синхронизация этого источника с данными профилей пользователей SPS. Рассмотрены два варианта получения данных из пользовательских профилей: с помощью SQL-запроса и с применением объектной модели SPS. Для организации синхронизации предлагается использовать промежуточный файл в формате XML. Такое решение позволяет заменить источник синхронизируемых данных без существенных изменений в уже имеющемся программном обеспечении. Кроме того, он предоставляет возможность передать данные третьей стороне или получить их от нее. Приводятся примеры скриптов на языке сценариев PowerShell, входящем в стандартную поставку MS Windows, реализующие прямую и обратную синхронизацию. Кроме задачи синхронизации, рассмотренный подход может использоваться для переноса данных при переходе с MS SharePoint на другую платформу..

 Одна из важных функций корпоративного портала публикация информации о сотрудниках предприятия. В случае использования MS SharePoint Portal Server 2003 хранилищем данных о сотрудниках служат профили пользователей . Стандартно информация о сотрудниках может заноситься в профили пользователей вручную самим пользователем или системным администратором, а также автоматически синхронизироваться с данными Active Directory . Перечень атрибутов профиля, их соответствие полям AD и возможность редактирования самим пользователем устанавливаются администратором SPS. На практике данные для заполнения профилей могут находиться во внешних по отношению к AD и SPS хранилищах, например, в унаследованной кадровой системе на основе СУБД MySQL, выполняющейся под управлением некоторой версии ОС Linux. Для таких источников данных требуется создание специального программного модуля, соответствующего категории ETL 1 и обеспечивающего извлечение данных из их источника изменение структуры, формата иили типов данных для их соответствия номенклатуре полей профилей пользователей SharePoint их последующую загрузку в профили. В качестве инструмента для создания такого модуля используется свободно распространяемый язык сценариев MS Windows PowerShell 2. PowerShell разработан на платформе MS. NET Framework, благодаря чему в сценариях на основе этого языка можно манипулировать объектами любых. NET-приложений, одним из которых является MS SharePoint 3. В своем составе он также имеет мощные средства для работы с данными в XMLформате. Для получения доступа к информации в профилях пользователей в PowerShell-скрипте следует обратиться к объектной модели SharePoint 3. Для этого скрипт должен выполняться с правами администратора на том же сервере, что и целевой сервер SharePoint. Процедура загрузки данных может быть разделена на два независимых шага и, соответственно, на два сценария PowerShell. На первом шаге данные извлекаются из внешнего хранилища и сохраняются в универсальном промежуточном формате. В качестве такого промежуточного формата данных выберем формат XML-разметки, соответствующий структуре данных профиля пользователя SharePoint. Благодаря такому подходу остальные действия уже не зависят от конкретного источника данных. Кроме того, эти XML-данные могут использоваться и для других задач. Скрипт для создания такого XMLдокумента зависит от конкретного источника данных и здесь рассматриваться не будет. На втором шаге PowerShell-скрипт считывает эти XML-данные и записывает в профили пользователей. Рассмотрим подробнее действия, выполняемые скриптом на втором шаге. Сначала для получения доступа к свойствам и методам SPS необходимо подключить его библиотеки. В PowerShell это делается следующими предложениями Далее получаем коллекцию профилей пользователей портала. Для этого понадобится объект типа system.URI, обязательно содержащий полный URL-адрес целевого портала. Создаем объект TopologyManager . Окончательно выделяем коллекцию профилей SPS Заранее подготовленные для синхронизации данные загружаем из файла в XML-объект PowerShell и проходим в цикле по всем атрибутам этого объекта. Если профиль для данной учетной записи существует, сравниваем поля, которые требуется обновлять, и, если есть различия, вносим изменения. MS SharePoint Portal Server 2003 предоставляет возможность каждому неанонимному пользователю редактировать данные своего профиля, в том числе и в тех полях, которые загружаются из некоторого внешнего источника данных. Будем считать, что данные, введенные пользователем, наиболее актуальны. Пусть пользователь имеет право редактировать значения автоматически заполняемых атрибутов своего профиля. Тогда, если не принять специальные меры, после очередного автоматического обновления изменения, сделанные пользователем, будут утрачены. Поэтому для применения изменений, внесенных пользователем в свой профиль, к данным в хранилище-первоисточнике требуется разработать специальный программный модуль. Процедуру, реализуемую таким модулем, назовем процедурой обратной синхронизации. Она относится к системам категории ETL 1, которые предусматривают извлечение данных из источника, изменение структуры иили формата данных для их использования в целевом приложении и отправки этому приложению 2. В рассматриваемом случае выполняется обращение к БД профилей SPS, из которой извлекаются значения атрибутов профилей, сопоставленных пользователям. Далее данные, извлеченные из профилей, сравниваются с соответствующими данными в исходном хранилище, и в случае обнаружения различий в исходном хранилище происходит обновление. В качестве инструмента для создания такого модуля используем MS PowerShell. Рассмотрим два варианта получения доступа к данным профилей пользователей. В первом варианте используем объектную модель SharePoint 3. Скрипт должен выполняться с правами администратора на том же сервере, что и SPS. Как и в случае прямой синхронизации, для доступа к свойствам и методам объектной модели SPS подключаем соответствующие библиотеки и создаем объект, содержащий профили пользователей. В цикле проходим по всем профилям, на основе значения их атрибутов формируем соответствующий XML-документ и сохраняем его в файл. Второй вариант основывается на SQL-запросе к данным, хранимым во внутреннем представлении БД, лежащей в основе SPS 4. Однако такой запрос нельзя построить сразу. Чтобы его сформировать, необходимо установить соответствие между номерами и именами атрибутов профилей пользователей. В сокращенном варианте оно будет иметь вид В результате выполнения скрипта получается файл в формате XML, содержащий данные из профилей пользователей. Далее этот файл может быть передан для загрузки данных в некоторое внешнее хранилище например, в AD или кадровую БД. Следует отметить, что подобный скрипт может выполняться не только на том же сервере, что и SPS, если удаленный доступ к БД профилей разрешен политиками безопасности. После того, как все сценарии синхронизации готовы, для их автоматического запуска необходимо настроить планировщик заданий Windows. Следует обратить внимание на то, что при планировании операций прямой и обратной синхронизации данных обратная синхронизация должна выполняться ранее прямой. Рассмотренный подход может использоваться не только в задаче синхронизации, но и для переноса данных при миграции с MS SharePoint на другую платформу. 