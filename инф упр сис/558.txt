ОБ ИЕРАРХИЧЕСКОМ КОДИРОВАНИИ  В ЦИФРОВОЙ СИСТЕМЕ ВИДЕОНАБЛЮДЕНИЯ 

существующие системы видеонаблюдения обладают рядом недостатков, одним из которых является низкая устойчивость к воздействию пакетных ошибок в каналах связи. Целью исследования является усовершенствование системы видеонаблюдения с использованием дискретного псевдокосинусного преобразования и принципа постоянной цветовой яркости для повышения устойчивости, порождаемого ею потока видеоданных к ошибкам, возникающим в каналах связи. Результаты: описаны основные функциональные блоки системы видеонаблюдения с использованием дискретного псевдокосинусного преобразования и принципа постоянной цветовой яркости в целях последующей доработки в части применения иерархического кодирования. Рассмотрены методы иерархического кодирования для кодеков с использованием дискретного (псевдо-)косинусного преобразования. Произведено сравнение типов иерархического кодирования применительно к системе видеонаблюдения с использованием дискретного псевдокосинусного преобразования и принципа постоянной цветовой яркости в условиях ограниченных аппаратных ресурсов, которое показало, что наиболее выгодным вариантом с точки зрения аппаратной реализации является применение иерархического кодирования с масштабированием по качеству. Исследование влияния потери пакетов в канале связи на иерархический поток видеоинформации, порожденный системой с использованием дискретного псевдокосинусного преобразования, принципа постоянной цветовой яркости и иерархического кодирования, показало, что применение иерархического кодирования с масштабированием по качеству может дать выигрыш пикового отношения сигнал/шум до 6 дБ относительно базовой схемы кодирования без иерархического расширения. Практическая значимость: результаты исследований иерархического кодирования позволили создать систему с улучшенными в части помехоустойчивости характеристиками передачи цветовой информации для аппаратных реализаций системы видеонаблюдения.

Системы видеонаблюдения являются одной из областей обработки видеоинформации, имеющей потенциал для улучшения потребительских характеристик. Большое распространение системы видеонаблюдения получили как в охранных системах, так и в бытовых, таких как видеодомофоны, автомобильные видеорегистраторы и пр. Однако существующие системы видеонаблюдения обладают рядом недостатков, таких как плохая передача четкости насыщенных цветовых деталей видеоизображений, большая вычислительная сложность и, как следствие, высокое энергопотребление. Большинство методов кодирования видео для достижения эффекта сжатия используют два типа избыточности временную и пространственную 1. Системы цифрового видеонаблюдения устраняют при обработке видеоинформации временную и пространственную избыточность за счет применения стандартизованных кодеков, таких как MJPEG и MPEG. Кодеки на базе стандартов семейства MPEG MPEG-2, MPEG-4, H.264MPEG-4 AVC обеспечивают высокую эффективность сжатия видеоданных, так как при помощи алгоритмов оценки и компенсации движения учитывают межкадровую зависимость отсчетов видеоинформации 2. Однако данные алгоритмы обладают высокой вычислительной сложностью. Кодеки на базе стандарта MJPEG MJPEG, JPEG2000 учитывают только внутрикадровую зависимость отсчетов видеоинформации и поэтому обладают низкой вычислительной сложностью, но при этом уступают по эффективности сжатия. Одним из существенных недостатков применения в цифровых системах видеонаблюдения стандартизованных кодеков является использование принципа постоянной яркости как первичного звена преобразования цветовых отсчетов в яркостные и цветоразностные отсчеты. Применение принципа постоянной яркости приводит к потере четкости видеоинформации в моноцветных деталях и потере яркости насыщенных цветов 3, 4. Альтернативой системам видеонаблюдения, построенным на стандартизованных кодеках, может стать система, реализованная с использованием дискретного псевдокосинусного преобразования ДПКП и принципа постоянной цветовой яркости ПЦЯ 5. Улучшения потребительских характеристик в системе видеонаблюдения с использованием ДПКП и принципа ПЦЯ можно достичь применением иерархического кодирования видеоинформации, которое позволит улучшить помехоустойчивость системы видеонаблюдения. Улучшения передачи цветовой информации в системах видеонаблюдения наряду с упрощением системы сжатия можно достичь, применив систему с использованием ДПКП и принципа ПЦЯ рис. 1. Кратко последовательность обработки видеоданных описывается следующим алгоритмом. Данные поступают с видеосенсора в формате RGB в, где преобразовываются входные отсчеты в выходные согласно принципу ПЦЯ, после чего в происходит накопление восьми кадров и формирование непересекающихся кубов размером 8 8 8 отсчетов. Далее выделяется один куб размерностью 8 8 8 отсчетов, который поступает в, где анализируется количество движения внутри куба. В зависимости от типа куба в производится вычисление трехмерного ДПКП ДПКП-3 и квантование, либо двумерного ДПКП ДПКП-2 по плоскостям и квантование коэффициентов. Затем в формируется массив кодовых слов кода Хаффмана для каждого куба. производит разбиение сжатого потока на пакеты и передачу информации по каналу связи. выдает значение коэффициента квантования для каждого куба в зависимости от требуемой скорости битового потока и количества бит в буфере передатчика. Прием пакетов и сборку осуществляет Сформированный поток поступает в, где производится извлечение кодовых слов кода Хаффмана. Далее поток передается в, после чего блоки раскладываются в . Для отображения из извлекается каждый из восьми кадров по порядку и передается в, где выполняется восстановление отсчетов согласно принципу ПЦЯ. Подробно принцип ПЦЯ и его использование описаны в работах 35. Основными преимуществами принципа ПЦЯ является сохранение четкости видеоинформации при передаче цветовой информации с прореживанием цветоразностных видеоотсчетов и сохранение четкости в моноцветных насыщенных деталях видеоизображений. Анализатор движения внутри куба оценивает блок и задает три возможных типа кодирования трехмерного куба статический куб, куб с умеренным движением и динамический куб 2, 5. Если куб оценен как статический, то кодер производит запись в поток двух бит на повторение куба, декодер в таком случае восстанавливает блок полностью из предыдущего накопленного набора видеоданных. Динамические кубы обрабатываются по плоскостям, так как трехмерное преобразование приводит к появлению специфичных визуальных искажений. Куб с умеренным движением обрабатывается с использованием ДПКП-3. Пространственно-временная избыточность устраняется применением ДПКП-3 в кубах видеоинформации размерностью 8 8 8. ДПКП-3 является целочисленной реализацией трехмерного дискретного косинусного преобразования ДКП-3 в сочетании с квантованием коэффициентов преобразования без операции деления 2. Отличие вычисления преобразования с применением ДПКП-3 состоит в том, что используется аппроксимированная матрица Одномерное ДПКП может быть вычислено следующим образом, где матрица значений ДПКП диагональная матрица матрица входных значений единичный вектор-столбец длины 8 поэлементное умножение. Обратное ДПКП может быть вычислено как, где матрица восстановленных значений. Производя вычисление ДПКП по трем осям строкам, столбцам и времени, можно произвести вычисление ДПКП-3 2, 6, 7. Процедура квантования без операции деления может быть реализована с операциями умножения и арифметического сдвига 2, 6, 7. Применение ДПКП-3 обеспечивает сравнимый с MPEG-4 коэффициент сжатия видеоинформации в сочетании со сравнительно невысокой вычислительной сложностью. Согласно исследованиям ФГУП НИИТ 8, для реализации кодека на основе ДКП-3 потребовалось меньше вычислительных ресурсов по сравнению с кодеком MPEG-4. Поток формируется в функциональном блоке передачи, формат пакета видеоданных изображен на рис. 2 белым цветом указаны поля заголовка пакета, серым данные кубов. Поле содержит информацию о типе пакета 0 пакет видеоданных, 2 сервисный пакет, содержащий временные метки, порядковый номер куба, количество кубов в пакете, размер пакета, коэффициент квантования для первого куба в пакете. Поле данных содержит тип куба, изменение шага коэффициента квантования для следующего за этим полем куба, далее записываются кодовые слова кода Хаффмана. Сначала записывается низкочастотный коэффициент и за ним кодовые слова кода Хаффмана высокочастотных коэффициентов, где порядковый номер кодового слова. Окончание куба фиксируется записью кодового слова . Максимальный размер пакета примем равным 1000 Б. Очередной пакет формируется, пока суммарный размер коэффициентов кода Хаффмана куба меньше, чем размер оставшегося места в текущем пакете. Если суммарный размер коэффициентов кода Хаффмана куба не вмещается в текущий пакет, то происходит переход к формированию следующего пакета. Представленная выше система видеонаблюдения может быть доработана и улучшена в целях повышения помехоустойчивости видеоданных. Для удобства изложения назовем функциональные блоки от блока прямого цветового преобразования до блока передачи, а блоки от блока приема до блока обратного цветового преобразования . Представим иерархическое кодирование для системы сжатия видеоинформации с использованием ДПКП. Но перед этим рассмотрим основы иерархического кодирования видеоинформации. Иерархическое представление видеоинформации было предложено для стандартов H 262 MPEG-2, H.263 и MPEG-4 Visual. Подробно механизмы иерархического кодирования для стандарта H.264MPEG-4 AVC изложены в работе 9. В англоязычной литературе используется термин Scalable Video Coding SVC масштабируемое иерархическое кодирование видео. В русскоязычной терминологии термины масштабируемое и иерархическое кодирование видео будем считать тождественными. Иерархическое кодирование представление видеоданных в целях адаптации их для различных потребностей и предпочтений конечных пользователей, а также различных возможностей приемной декодирующей аппаратуры и различных сетевых условий. Целью иерархического кодирования является порождение такого потока видеоданных, в котором содержится один или более потоков разного уровня, которые могут быть декодированы как по отдельности базовым декодером видеоинформации, так и иерархическим декодером видеоинформации в зависимости от аппаратной мощности декодирующей аппаратуры и или характеристик канала передачи данных. Для общего понимания приведена схема кодирования и декодирования разных уровней иерархической видеоинформации рис. 3. Имеется иерархический кодер ДПКП, на вход которого подается полноформатное полнокадровое видеоизображение. Кодер порождает иерархический поток видеоданных. Поток содержит информацию в виде иерархических слоев, первый из которых несет основную видеоинформационную составляющую и называется слоем, остальные слои являются дополняющими, полученными при помощи базового слоя, и называются слоями. Базовый слой может быть декодирован при помощи декодера ДПКП описан ранее, далее . Расширяющие слои могут быть декодированы иерархическим декодером и суммированы с базовым слоем таким образом, что выходное изображение получает дополнительную информацию либо в виде пространственного увеличения видеоизображения увеличение разрешения, либо в виде увеличения кадровой скорости видеоряда. Использовать иерархическое кодирование целесообразно по следующим причинам. Вопервых, аппаратное устройство не способно производить декодирование большого количества видеоинформации, т. е. ограничена вычислительная сложность аппаратуры декодирования. Во-вторых, пропускная способность канала связи ограничена при получении базового потока можно произвести декодирование уменьшенной по разрешению и кадровой скорости видеоинформации, в то время как при увеличении пропускной способности канала связи качество декодированной видеопоследовательности будет улучшено за счет добавления пространственных уточняющих деталей и увеличения кадровой скорости видеоинформации. Рассмотрим виды иерархического кодирования для системы сжатия с использованием ДПКП. Как и для стандарта H.264MPEG-4 AVC, имеется 3 вида иерархического кодирования пространственное, временное и иерархическое кодирование с масштабированием по качеству. Пространственное иерархическое кодирование видеоинформации рис. 4 предполагает, что кадры исходного видеоряда будут уменьшены в 2 раза или более в . Уменьшенные изображения накапливаются в, после чего из него извлекаются блоки размерностью 8 8 8 отсчетов. Далее сжатие производится так же, как описано ранее в системе сжатия видеоинформации с использованием ДПКП, с тем исключением, что кубы, после того как были проквантованы коэффициенты спектра, поступают в и далее в ветку формирования расширяющего слоя. Расширяющий слой формируется следующим образом. Кадры из поступают в, который содержит восстановленные кадры базового слоя, увеличенные в 2 раза. Из исходных кадров производится вычитание восстановленных кадров базового слоя, после чего формируются кубы расширяющего слоя. Далее сжатие разностных кубов расширяющего слоя производится аналогично сжатию кубов базового слоя. управляет скоростью выходного потока базового слоя, изменяя значение коэффициента квантования для каждого куба. регулирует скорость битового потока расширяющего слоя аналогичным образом. Таким образом, на выходе пространственного иерархического кодера имеются базовый и расширяющий потоки. Для порождения двух и более расширяющих слоев требуется для каждого расширяющего потока ввести дополнительную ветку сжатия, которая будет получать разностную информацию от предыдущих слоев и формировать дополнительный расширяющий поток. Распределение видеоинформации по слоям показано на рис. 5, . Базовый слой занимает примерно 25 от основного потока, 75 приходится на расширяющий слой. Пространственное иерархическое кодирование с использованием ДПКП-3 более подробно изложено в работе 11. Иерархическое кодирование с масштабированием по времени рис. 6 представляет собой, по сути, применение двух и более базовых кодеров ДПКП с тем исключением, что принимает только нечетные кадры, а принимает только четные кадры. Исходный видеоряд в данном случае представляет собой ряд с вдвое большим количеством кадров 16 кадров., изменяя значение коэффициента квантования, порождает базовый слой с требуемой скоростью битового потока. аналогично порождает расширяющий слой с требуемой скоростью битового потока для расширяющего слоя. Распределение видеоинформации по слоям для иерархического кодирования по времени показано на рис. 7, Рассмотрев более детально принципы временного иерархического кодирования, можно сделать вывод, что любой из порожденных иерархическим кодером потоков в данной схеме является базовым и может быть декодирован по отдельности базовым декодером ДПКП с уменьшенной кадровой скоростью. Однако, чтобы получить полнокадровый видеоряд, требуется произвести перемежение и интерполяцию кадров базового и расширяющего слоев. Отличие сжатия видеоинформации с применением иерархического кодирования видеоинформации с масштабированием по качеству рис. 8 от базового кодирования видеоинформации заключается в том, что из кодовых слов кода Хаффмана, полученных в блоке, коэффициенты распределяются в базовый слой и расширяющие слои. При этом расширяющих слоев может быть два и более. Распределение коэффициентов по слоям показано на рис. 9. Базовый слой состоит из низкочастотных коэффициентов трехмерного куба коэффициентов. Расширяющий слой 1 состоит из высокочастотных коэффициентов блока показаны серым цветом, согласно обходу по зигзагу для трехмерного куба. Расширяющий слой 2 состоит из оставшихся высокочастотных коэффициентов куба показаны белым цветом. Восстановленные изображения декодированных иерархических слоев показаны на рис. 10, Базовый слой занимает около 13 от суммарного потока, расширяющий слой 1 занимает около 29, расширяющий слой 2 занимает 58 . После декодирования базового слоя кадр видеоряда представляет собой блочное изображение, где базовой единицей отображения является блок 8 8 пикселей, яркость в котором определяется -коэффициентом. При декодировании базового слоя и расширяющего слоя 1 изображение дополняется деталями и становится более четким. При декодировании всех слоев базового и двух расширяющих получается наиболее четкое изображение для заданного критерия сжатия при сжатии установлено ограничение 1 Мбитс на весь поток видеоданных. Распределение по слоям можно производить в зависимости от характеристик канала связи, для которого планируется применять систему сжатия и передачи видеоинформации. К примеру, первый расширяющий слой можно увеличить до коэффициентов диагонали, тем самым перераспределив поток таким образом, что расширяющий слой 1 займет 50, а расширяющий слой 2 займет 37 . Отметим преимущества и недостатки иерархических моделей кодирования в применении к описанной ранее системе видеонаблюдения с использованием ДПКП и принципа ПЦЯ. Критериями ограничения будем считать вычислительную сложность системы сжатия и требуемый объем оперативной памяти для хранения кадров. Пространственное иерархическое кодирование требует увеличения объема памяти для хранения дополнительных уменьшенных кадров. При увеличении количества расширяющих слоев потребуется дополнительное увеличение объемов памяти для хранения разностных кадров. Кодирование каждого из расширяющих слоев приводит к запуску дополнительного кодера ДПКП. Кроме того, требуется производить увеличение и уменьшение кадров с вычитанием, что намного увеличивает количество вычислительных ресурсов, требуемых для формирования пространственных иерархических потоков. Применение иерархического кодирования с масштабированием по времени требует увеличения объема оперативной памяти для хранения вдвое большего количества кадров, потому как уменьшение ДПКП по времени до четырех вместо восьми отсчетов существенно скажется на коэффициенте сжатия каждого из слоев. Относительно вычислительных операций потребуется запуск двух кодеров, работающих в параллель, но каждому из кодеров отводится вдвое больше времени для сжатия потока, т. е. не потребуется существенных затрат в вычислительном отношении. Иерархическое кодирование с масштабированием по качеству не требует значительного увеличения объемов оперативной памяти, и вычислительная сложность ограничивается только формированием потоков по отдельности, что является приемлемым для рассмотренных ограничений в применении к описанной ранее системе видеонаблюдения. Сравнение типов иерархического кодирования в применении к системе видеонаблюдения с использованием ДПКП и принципа ПЦЯ позволяет сделать вывод, что иерархическое кодирование видеоинформации с масштабированием по качеству является наименее требовательным к вычислительным аппаратным ресурсам, вследствие чего его реализация является преимущественной для применения в системе видеонаблюдения с использованием ДПКП. Схема системы видеонаблюдения с использованием ДПКП, принципа ПЦЯ и иерархическим кодированием потока показана на рис. 11. Обработка видеоинформации производится аналогично обработке в базовом кодере ДПКП с тем исключением, что из коэффициентов кода Хаффмана формирует базовый слой и два расширяющих. Базовый слой слой 1, как описано выше, содержит только низкочастотные коэффициенты кубов, слои 2 и 3 являются расширяющими., получая каждый из слоев, формирует пакеты иерархических слоев и передает их по отдельному логическому либо физическому каналу связи. Рассмотрим распределение коэффициентов по слоям иерархического потока видеоинформации. Количество слоев определим по количеству логических либо физических каналов передачи данных. Для нашего случая определим три канала с пропускными характеристиками 512, 1024 Кбитс и 54 Мбитс. Трехмерные кубы коэффициентов ДКП содержат информацию о видеоизображении, которая описывает пространственно-временные характеристики. Низкочастотный коэффициент куба содержит информацию о яркости всего блока. Высокочастотные коэффициенты, в зависимости от расположения, описывают пространственные коэффициенты по горизонтали и вертикали и временные коэффициенты по времени изменения внутри куба. Более эффективно использовать обход по зигзагу, соответствующий убыванию частот появления ненулевых коэффициентов преобразования в кубе 2. Исходя из описанного выше, при формировании слоев можно выделить низкочастотные коэффициенты в базовый слой, а в расширяющие слои в зависимости от их количества поместить высокочастотные коэффициенты. Так как следующими по значимости коэффициентами в кубе ДКП-3 являются коэффициенты, расположенные по трем направлениям от низкочастотного, логично вынести эти три коэффициента в расширяющий слой 1 см. рис. 9. Оставшиеся коэффициенты поместим в расширяющий слой 2. Рассмотрим более подробно формирование иерархического потока. Формирование иерархического потока и пакетов в системе видеонаблюдения с использованием ДПКП, ПЦЯ и иерархического кодирования производится таким же образом, как и для базового кодера см. рис. 2, при этом заголовок пакета полностью аналогичен заголовку пакетов потока, порожденного базовым кодером видеоинформации. Размер пакета соответствует размеру пакета базового кодера. Формат поля данных пакета иерархических слоев видеоданных изображен на рис. 12 Базовый слой иерархического потока рис. 12, содержит тип куба, изменение шага коэффициента квантования для следующего за этим полем куба, далее записывается кодовое слово низкочастотного коэффициента, где порядковый номер куба кода Хаффмана. Расширяющие слои рис. 12, формируются согласно заранее заданным границам размещения коэффициентов кода Хаффмана. Границы слоев задаются следующим образом базовый слой низкочастотные коэффициенты кода Хаффмана расширяющий слой 1 высокочастотные коэффициенты кода Хаффмана в диапазоне от двух до пяти при зигзагообразном сканировании коэффициентов куба расширяющий слой 2 высокочастотные коэффициенты кода Хаффмана в диапазоне от шести до 512 при зигзагообразном сканировании коэффициентов куба. При этом если в диапазоне расширяющего слоя встречается код конца блока, то он записывается в этот расширяющий слой. Для увеличения помехоустойчивости и лучшего восстановления принятой видеоинформации можно произвести передачу базового слоя по наиболее помехоустойчивому каналу связи либо применить коды, исправляющие ошибки. Например, построив систему с передачей по каналам третьего 3G, четвертого 4GLTE поколения и Wi-Fi, можно производить отсылку базового слоя и по 3G-, и по 4GLTE-сетям, а расширяющие слои передавать по 4GLTE и Wi-Fi. Рассмотрим характеристики базовой и иерархической систем видеонаблюдения. При сжатии тестовой видеопоследовательности была установлена следующая характеристика ограничение на порождаемый кодером поток видеоданных не более 1 Мбитс. При иерархическом кодировании с масштабированием по качеству фактическое количество кодов Хаффмана остается таким же, как и у базового кодера, поэтому избыточность порожденного потока зависит только от того, как коэффициенты кода Хаффмана будут распределены по пакетам. Для видеопоследовательности иерархический поток по объему превысил на 0,6 поток, порожденный базовым кодером. Это связано с тем, что при формировании пакетов, описанном выше, используется ограничение в 1000 Б на размер пакета. Так как кодовые слова кода Хаффмана имеют различную длину от 2 до 26 бит, то их распределение, учитывая ограничение на длину пакета, может влиять на размер суммарного выходного иерархического потока видеоинформации. Однако для другой видеопоследовательности и других параметров сжатия может наблюдаться ситуация, когда поток базового кодера больше, чем иерархического. Таким образом, избыточность иерархического потока сопоставима с избыточностью потока базового кодера видеоинформации. Графики зависимости пикового отношения сигнала к шуму PSNR для потока без ошибок, потока базового кодера, иерархических потоков 1 и 2 приведены на рис. 13, . В иерархическом потоке 1 следующее распределение потоков базовый 13, расширяющий слой 1 29, расширяющий слой 2 58 . Иерархический поток 2 содержит потоки со следующим распределением базовый 24, расширяющий слой 1 47, расширяющий слой 2 29 . Размер пакета для обоих иерархических потоков не более 1000 Б. По приведенным результатам можно сделать вывод, что выигрыш от применения иерархического кодирования с масштабированием по качеству может достигать 6 дБ, однако при различных распределениях потоков по иерархическим слоям может происходить потеря данных, которая ведет к падению PSNR до 3 дБ и более. Из-за отличного от базового распределения коэффициентов в сформированном иерархическом потоке восстановленные изображения после воздействия ошибок канала связи выглядят иначе рис. 14, . На рисунке видно, что при пропадании пакета, относящегося к базовому потоку, изображение искажается в соответствии с позициями пропавших кубов. В то же время при пропадании пакета из расширяющего слоя иерархического потока изображение не искажается полностью, а лишь становится более блочным. Критичным является случай потери пакета с базовыми коэффициентами в этом случае характер визуального искажения аналогичен характеру искажений базового кодека. Реализованный режим иерархического кодирования позволяет улучшить потребительские характеристики системы видеонаблюдения с использованием ДПКП и принципа ПЦЯ, потому что является более эффективным для системы видеонаблюдения в каналах связи с ошибками. В работе рассмотрены три основных типа иерархического кодирования видеоинформации для систем с использованием ДПКП. Произведено сравнение типов иерархического кодирования видеоинформации. На основе сравнения выбран тип иерархического кодирования для системы видеонаблюдения с использованием ДПКП и принципа ПЦЯ. Произведено сравнение базовой и иерархической систем видеонаблюдения. Система видеонаблюдения с применением иерархического кодирования порождает поток, сопоставимый по объему с потоком базовой системы видеонаблюдения без иерархического кодирования. Иерархический поток более устойчив к воздействиям канальных ошибок, что делает предпочтительным применение системы видеонаблюдения с использованием иерархического кодирования при передаче видеоинформации по беспроводным каналам связи. При потере пакетов, относящихся к расширяющим слоям иерархического потока видеоданных, выигрыш PSNR относительно базового кодера может достигать 6 дБ. Потери пакетов, относящихся к базовому слою иерархического кодера, вносят искажения, сопоставимые с потерей пакетов потока базового кодера. За рамками статьи остался вопрос, связанный с помехоустойчивым кодированием базового и расширяющих слоев видеоинформации. Требуется также рассмотрение критериев предпочтительного распределения потока между слоями с учетом различной чувствительности слоев к потере пакетов. 