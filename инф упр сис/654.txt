СЕГМЕНТАЦИЯ ИСХОДНЫХ СНИМКОВ  ДЛЯ ФОТОМЕТРИЧЕСКОГО МЕТОДА  ТРЕХМЕРНОГО СКАНИРОВАНИЯ 

прежде чем осуществлять вычисления градиента поверхности на основе ее снимков при различном положении источников света, необходимо исключить возможность ситуации, не соответствующей модели, используемой в методе вычисления. Наиболее эффективный путь, не требующий какой-либо предварительной обработки объекта, заключается в сегментации исходных снимков. Целью работы является определение и систематизация признаков затенений, бликов и переотражений; разработка алгоритма сегментации исходных снимков с учетом специфики фотометрического метода сканирования. Методы: экспериментальные данные получены при компьютерном моделировании исходных изображений с использованием модели отражения Фонга. Для сегментации изображений используются признаки бликов и затенений, основывающиеся на проверке линейной зависимости интенсивностей снимков, находящихся в одной плоскости, и минимизации функции отклонения исходных данных от данных, соответствующих используемой модели. Результаты: определена конфигурация фотометрического трехмерного сканера из пяти фиксированных источников света, позволяющая использовать дополнительные признаки при сегментации затенений, бликов и переотражений. За счет избыточного количества снимков гарантируется наличие как минимум трех измерений яркости в каждой точке объекта, удовлетворяющих условиям проверки. Разработан алгоритм для проверки соответствия исходных данных и модели отражения света поверхностью, используемой для вычисления, в котором для большинства видимых точек задача минимизации функции от двух переменных не требует решения или была сведена к задаче минимизации функции от одной переменной. Представлен результат сегментации для двух фигур, на одной из которых смоделированы затенения, блики и разрыв поверхности, которые часто являются трудностями для вычисления ориентации поверхности. Практическая значимость: в сравнении с аналогами разработанный алгоритм сокращает время, необходимое для сегментации всей видимой области, а также осуществляет более детальную сегментацию исходных снимков.

Для фотометрического метода трехмерного сканирования вычисление градиента поверхности может производиться на основе как эмпирической модели отражения света поверхностью 14, так и аналитической модели 59. Аналитический метод 57 основывается на совместном решении трех уравнений для различных положений источников света 1 где интенсивность отраженного света вектор освещения вектор нормали к поверхности интенсивность падающего света угол между нормалью и вектором освещения. Решение системы уравнений позволяет определить градиент поверхности, и коэффициент отражения для диффузно отражающих поверхностей без необходимости проводить калибровку на объекте идентичного материала. Такой подход дает больше возможностей для анализа погрешностей вычисления ориентации поверхности, так как вычисления выполняются непосредственно на основании измеренных значений яркости. Необходимость выполнять сегментацию бликов и затенений вызвана тем, что для аналитической модели освещения вычисление ориентации поверхности в точках, не соответствующих закону отражения света поверхностью, не имеет смысла. Для эмпирической модели освещения это проявляется в отсутствии набора интенсивностей на эталонном объекте. Помимо отбрасывания данных, аналитическая модель позволяет подобрать набор, в наибольшей степени соответствующий и модели отражения, и исходным данным для эмпирической модели выбор наиближайшего набора может привести к значительным ошибкам. Необходимость сегментации обусловлена также высоким уровнем шума в затененных и близких к затененным областях 7, даже если затененный снимок может быть исключен. В работах 9, 10 сегментация бликов и затенений осуществляется с использованием спектрального анализа света, для снимков в режиме grayscale сегментация недостаточно надежна, в случае отклонения от аналитической модели выбирается наиболее яркий или наиболее темный пиксель 9. Метод сегментации 11 требует значительного количества времени на решение задачи минимизации и позволяет определить только затенения на исходных снимках. Выбранная для работы конфигурация освещения 57 позволяет использовать дополнительные признаки для более подробной сегментации. Исходными данными для алгоритма сегментации является набор снимков, в которых рассматриваются точки, принадлежащие сканируемому объекту. Конфигурация из пяти источников света 57 позволяет осуществлять проверку по каждой оси на наличие отхождений от диффузной модели отражения. Три снимка, или, в случае отсутствия затенений должны быть линейно зависимы, исходя из трех уравнений 1 можно выразить одно из изображений через два других При наличии шума и возможных слабых вторичных источниках света для того, чтобы осуществлять проверку, необходимо ввести пороговую величину 2 Выполнение неравенства будет означать, что в точке нет никаких отклонений от закона диффузного отражения света. В противном случае на снимках может присутствовать затенение, блик возможна не только диффузная составляющая или точка будет освещена вторичным источником света. Обозначим маску и аналогично Случайная шумовая составляющая для всех точек одинакова и имеет среднеквадратичное отклонение Для конфигурации из четырех источников света должно выполняться равенство что не позволяет определить отхождение от закона диффузного отражения света для каждой оси, т. е. вместо двух матриц и возможно определение только, за исключением бликов и переотражений на дополнительном снимке. Результат проверки для сферы представлен при наличии только затенений и флуктуационного шума рис. 1, т. е. точки, где 0 или 0, будут принадлежать затенениям на исходных снимках. Заметно, что в отмеченную область попадают также точки с низким, граница тени не четкая. Чтобы этого избежать, можно подобрать оптимальное значение для условий, в которых происходит сканирование, но в этом случае эффективность определения переотражений снизится. Более надежные результаты определения и можно получить, учитывая тот факт, что затенение, блик и переотражение проявляются в группе отчетов, расположенных рядом. Таким образом, обозначив величины, 0,5 1 1 1 1, сформулируем новое условие проверки которое учитывает наличие затенений в соседних точках. Это позволяет значительно снизить количество ложных определений, например в области низких на рис. 1. Под неверным определением подразумевается как ложное определение затенения, блика или переотражения, так и их пропуск. Для диффузно отражающей поверхности сферы при 30, и размере изображения 640 480 см. рис. 1 общее количество точек, принадлежащих затенениям, 12 868, минимальное количество неверных определений 2440 при оптимальном значении Общее количество точек, принадлежащих затенениям и бликам, для этой же поверхности, но имеющей зеркальную составляющую, 35 862, минимальное количество неверных определений 3669 при оптимальном значении рис. 2. Примечательно, что величина, сравниваемая с пороговой величиной по абсолютному значению в 3, отрицательна в области блика на снимке рис. 3, также отрицательное значение она будет принимать в случае самозатенений, так как на одном из смежных снимков значение яркости будет меньше условной без самозатенения в этой же точке яркости отраженного света. Эта информация может быть использована для дальнейшей классификации. Для сегментации изображения рассматриваются только точки, где 0 или 0, так как если 1 1, то в этой точке градиент поверхности может быть вычислен, исходя из значений яркости любых изображений. Если 0 1 или 1 0, то гарантированно может быть вычислено значение только одного приращения, для вычисления всего градиента необходимо определить, на каком из смежных снимков присутствует затенение или блик. В большинстве случаев ситуация 0 1 означает наличие затенения или блика на одном из смежных снимков. Вероятность пересечения зеркальных областей, областей затенения на смежных снимках мала. Случай 0 0 означает наличие затенения, бликов или переотражений на любом снимке, за исключением затенений на дополнительном снимке. Для обработки ситуаций 0 1, 1 0, 0 0 и точного вычисления градиента поверхности необходимо исключить те снимки, из-за которых возникает отклонение от модели диффузного отражения света. Затенения отличаются от вторичного освещения или блика тем, что яркость затененного отсчета равна нулю, в то время как вторичное освещение добавляет к яркости некоторую величину. Идеальное затенение соответствует 0, при наличии посторонних источников света и шума сравнение яркости с нулем не имеет смысла. Чуть более действенный способ сравнение с некоторой пороговой величиной, определяющей колебания в тени, но этот подход малоэффективен при непостоянном, так как не использует корреляцию значений яркости точек изображений в наборе. Для того чтобы более полно описать процесс получения снимков, будем использовать следующее уравнение яркости пиксела на изображении при постоянном коэффициенте отражения без учета вторичных источников где элемент матрицы затенений снимка, которая имеет ту же размерность, что и изображение, и может принимать в каждой точке значение 0 или 1. Если, 0, то в точке присутствует затенение и, обращается в ноль. Для того чтобы определить наиболее вероятное расположение затенений на снимках, следует подобрать наиболее удовлетворяющие значениям яркости пикселей. В общем случае необходимо минимизировать величину где количество изображений. Результатом для каждой точки является как набор, так и вектор нормали к поверхности, который при отсутствии бликов или переотражений с определенной точностью близок к искомому значению ориентации поверхности. Значение практически в каждой точке должно равняться 1, но может принимать нулевые значения на границах объекта. Множество конечно, и область возможных решений может быть также сокращена за счет использования результатов проверки рис. 4, . Например, комбинация 1,0,1,0,1 при 1 1 невозможна. При 0 1 достаточно рассмотреть четыре варианта множества 1,1,1,0,0, 1,1,1,0,1, 1,1,1,1,0 и 1,1,1,1,1. Отмеченные области соответствуют случаю затенения. Точки, отмеченные для которых 0, принадлежат блику или переотражению или ложно определены в результате высокого уровня шума. На рис. 4, точки, соответствующие ситуации изображены белыми, соответствующие темно-серыми, светло-серыми. Важно отметить, что для области 0 1 величина представляет собой функцию одной переменной, так как 1 позволяет вычислить значение . Согласно выдвинутому предположению 9, при наличии блика из рассмотрения может быть исключен самый яркий пиксель, в случае затенения самый темный. Причем рассматривается модель отражения Торренса Спарроу 8, 9, согласно которой зеркальная составляющая пр оявляется лишь на некоторых участках, т. е. используется возможность сканировать поверхность, рассматривая только диффузно отражающие участки поверхности. Проанализировав результат, представленный на рис. 3, 4, аналогичный вывод можно сделать и для модели Фонга. Для ситуации 0 1 1 0 при т. е. при блике на одном из снимков, рис. 5, при вычислении градиента из, исключается самый яркий пиксель. Блик на снимке может быть определен значительно проще. Достаточно сопоставить проверку с Сравнивая отклонение от диффузной модели отражения, с дополнительным снимком и без него, в силу отсутствия на нем затенений могут быть выделены блики на снимке рис. 5, . На рис. 5, представлена область для фигуры, полученной в результате вращения овала Кассини, область точек 0 на рис. 5, включает в себя блик на снимке . Полученная в области бликов ориентация поверхности должна быть такова, что нормаль совпадает с вектором где единичный вектор, направленный вдоль оси . Важно отметить, что переотражения не будут удовлетворять этому условию. Среди отмеченных областей затенений может быть выделена подгруппа самозатенений. Наличие самозатенения не зависит от ориентации поверхности, а обусловлено взаимным расположением частей фигуры, поэтому при 0 условное значение яркости будет сигнализировать о самозатенении. Но в этом случае необходимо вычислить градиент или использовать значения, в которых был установлен минимум . Наиболее простой вариант определять самозатенения по отрицательному значению . На рис. 5, белыми отмечены области, для которых 0, серыми области, для которых 0. В области точек 0 0 при необходимо рассматривать все 16 возможных вариантов множества но, например, будет означать наличие трех линейно зависимых снимков, т. е. вычисление градиента не может быть гарантировано. Поэтому 7 вариантов искомого множества 1,0,0,0,0, 1,0,0,0,1, 1,0,0,1,0, 1,0,0,1,1, 1,0,1,0,0, 1,1,0,0,0, 1,1,1,0,0, которые сигнализируют о затенениях на обоих смежных снимках, будут означать недоступность точки для реконструкции. Любая ситуация 1,0,1,0,1, 1,1,0,0,1, 1,0,1,1,0, 1,1,0,1,0 при 0 означает наличие затенений на двух снимках из-за невозможности пересечения области блика и затенения вычисление осуществляется по незатененным снимкам. На рис. 6 этой ситуации соответствует область, закрашенная бордовым цветом. Ситуации 1,0,1,1,1, 1,1,0,1,1, 1,1,1,1,0, 1,1,1,0,1 при 0 будут означать наличие самозатенений, области которых могут пересекаться с областью бликов на другой паре смежных снимков, остальные затенения с бликами пересекаться не могут. Ситуация, сигнализирующая о самозатенении, не позволяет в этот же момент определить наличие блика на другом снимке в этой точке. В этом случае для вычисления из трех незатененных пикселей исключается самый яркий. На рис. 6 этой ситуации соответствует область, закрашенная красным. Ситуация 1,1,1,1,1 будет сигнализировать о блике на снимке . На рис. 6 этой ситуации соответствует область белого цвета. Зеленым изображены блики на снимках, салатовым блики на снимках, . Все точки фигуры, полученной вращением овала Кассини, доступны для вычисления градиента, но необходимо учитывать, что в слабоосвещенных областях, граничащих с затенениями, погрешность вычисления будет значительно выше по сравнению с погрешностью в остальных областях. Представленный алгоритм сегментации затенений и бликов в большей степени базируется на информации о взаимном расположении источников света и корреляции значений яркости в наборе. Несмотря на то, что в обоих случаях ключевым фактором, влияющим на качество сегментации, является использование избыточного количества снимков, количество снимков в наборе более пяти не позволяет добиться значительного улучшения в качестве, при этом усложняя процесс сегментации. Использование алгоритма не просто позволяет отбрасывать самый яркий или темный пиксел, а в большинстве случаев указывает конкретную ситуацию на конкретном снимке. Но даже при сокращении множества возможных вариантов сегментация может занять значительное время. 