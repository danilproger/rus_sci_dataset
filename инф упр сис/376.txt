КОДИРОВАНИЕ И ПЕРЕДАЧА ИНФОРМАЦИИ АНАЛИЗ КАЧЕСТВА ПЕРЕДАЧИ ПОТОКОВОГО ВИДЕО  В БЕСПРОВОДНЫХ AD-HOC-СЕТЯХ 

Рассматривается передача потокового видео в беспроводной сети, использующей режим 802.11 ad-hoc. Качество передачи оценивается пиковым отношением сигнал/шум и сквозной задержкой декодированного видео. Для двух типичных топологий сети с помощью моделирования анализируется влияние степени компрессии потокового видео на качество передачи. 

Доставка мобильным беспроводным пользователям видеоконтента, включая потоковое видео, и обеспечение доступа к таким видеосервисам, как видеотелефония и видеоконференции, составляют доминирующую долю трафика в локальных и региональных беспроводных сетях, а также в сотовых 3Gи LTE-сетях 1. Одним из наиболее быстро развивающихся сегментов локальных беспроводных сетей являются ad-hocсети, обладающие такими привлекательными качествами, как быстрота развертывания, гибкость структуры, мобильность и живучесть 2, 3. Проблемы, связанные с организацией эффективной передачи видео в беспроводных ad-hoc-сетях, весьма многообразны и порождаются, главным образом, следующими факторами. Во-первых, для такого рода сетей характерно случайное изменение во времени величины доступной скорости the available throughput передачи между передающим и приемным узлами. Это объясняется как мобильностью пользователей, так и изменением текущей топологии сети. Во-вторых, передача пакетов в такой сети характеризуется сравнительно высоким уровнем вероятности неправильного приема и или стирания пакетов. В качестве третьего фактора следует выделить появление задержек и сетевого джиттера в процессе доставки пакетов, изменение порядка следования пакетов, а также потерю пакетов вследствие перегрузки сети. В интерактивных сервисах, таких как видеоконференции, допустимая сквозная задержка end-to-end latency жестко ограничена и, как правило, не должна превышать 150 мс 4. Дополнительные проблемы вносит и возможная потеря локальной синхронизации в битовом потоке компрессированного видео. В связи с тем, что доступная скорость передачи априори неизвестна и меняется в процессе передачи, а введение переспросов приводит, как правило, к неприемлемо большим задержкам, рациональный метод передачи видеоконтента должен базироваться на адаптации параметров видеокодека в первую очередь, скорости кодирования к текущей доступной скорости передачи, оцениваемой на основе получаемой информации о состоянии сети. Интуитивно понятно, что для простейшей топологии типа точка-точка передача видео со скоростью, близкой к доступной скорости в канале, обеспечит, видимо, наилучшее качество доставленного видео. В то же время, при наличии промежуточных и или интерферирующих узлов такая стратегия передачи, возможно, будет сопровождаться заметным возрастанием доли потерянных и или ошибочных пакетов, что приведет к существенному ухудшению качества доставленного видео. При уменьшении скорости кодирования видео, с одной стороны, снижается нагрузка на сеть и тем самым возрастают надежность и своевременность доставки пакетов. С другой стороны, уменьшение скорости кодирования сопровождается ухудшением отношения сигнал шум ОСШ в компрессированном видео. Кроме того, высокая степень сжатия приводит к большей чувствительности компрессированного видео к ошибкам, возникающим в процессе передачи. Таким образом, можно говорить о своего рода оптимальной в рамках некоторой модели скорости кодирования степени сжатия видеоконтента, предназначенного для передачи в ad-hocсети. В более общем контексте возникает задача выбора скорости кодирования видео, согласованной с протоколом передачи и текущим состоянием сети, включающим такие характеристики, как топология, метод маршрутизации, количество промежуточных и или интерферирующих узлов и т. д. Данная работа посвящена рассмотрению одного из аспектов этой задачи анализу влияния такого фактора, как наличие промежуточных и интерферирующих узлов ad-hoc-сети, во-первых, на соотношение оптимальной скорости кодирования видео и доступной скорости передачи в сети и, во-вторых, на величину суммарного времени задержки при доставке видеокадров получателю. В работе исследуется передача видео в локальной беспроводной WiFi-сети, функционирующей на основе стандарта 802.11b. Номинальная скорость передачи составляет 1, 2, 5 и 11 Мбитс в зависимости от выбранного вида модуляции-кодирования. Распределение общего ресурса сети между активными пользователями, базирующееся на процедуре CSMACA, подчиняется правилу, согласно которому скорость передачи, выделяемая активному пользователю, примерно обратно пропорциональна числу таких пользователей. В результате при нескольких активных пользователях в сети доступная скорость передачи оказывается заметно меньше номинальной скорости. Рассматриваемая в работе схема передачи представлена на рис. 1. В качестве передаваемого видео в работе использовались стандартные видеоклипы Foreman и Ref7, характерной особенностью которых является наличие существенной доли динамических фрагментов. Для создания компрессированных видеофайлов использовался открытый проект FFmpeg 5, на основе которого формируется большое число мультимедиаприложений. Широкий выбор кодеков, настроек процедуры кодирования, высокая скорость работы и постоянные обновления делают FFmpeg эффективным инструментом кодированиядекодирования видео. В данной работе FFmpeg использовался для компрессии видео и создания RTPпотока 6, а также восстановления декодирования RTP-потока. Текущие ограничения в FFmpeg не позволяют сохранять RTP-пакеты в файл или читать их из файла. Вывод и ввод производятся UDP-пакетами на адрес и порт, указанные в файле протокола управления сессией Session Description Protocol SDP 7. Вспомогательная утилита сохраняет пакеты, которые будут использоваться в дальнейшем для моделирования процесса передачи. Эта же утилита способна воспроизводить сохраненные RTP-пакеты для восстановления видео с помощью FFmpeg. Для оценки качества восстановленного видео в работе используется наиболее распространенная метрика пиковое ОСШ Peak Signal-toNoise Ratio PSNR. Примерное соотношение между PSNR и метрикой, базирующейся на субъективном восприятии Mean Option Score MOS, приведено в работе 8. В качестве моделирующей программы был выбран Network Simulator 3, NS-3 9. Этот симулятор дискретных событий предназначен для исследования протоколов сетей в том числе Интернета и моделирования больших систем. Разработка моделей с использованием NS-3 близка по своей сути к созданию классических объектноориентированных многопоточных приложений на языке С. Можно выделить три основные части программы. 1. Инициализация узлов сети тип трафика, расположение и т. д. и настройка характеристик скорости передачи, очереди приемников и передатчиков и т. д.. Выбор топологии сети и ее характеристик. 2. Непосредственно моделирование работы сети. Следует отметить, что моделирование работы сети отнюдь не сводится к организации передачи трафика между узлами. Во время моделирования возможно включение и или удаление узлов из сети, изменение интенсивности трафика и его типа, перемещение узлов в пространстве и изменение характеристик среды. 3. Моделирование заканчивается сбором статистики и ее обработкой. Условие окончания моделирования настраивается пользователем. Модель передачи видео в ad-hoc-сети, построенная с использованием симулятора NS-3 рис. 2, включает в себя фиксированные и настраиваемые параметры. Под параметрами понимаются настройки всех программ в комплексе моделирования, а именно NS-3, FFmpeg и утилиты. К фиксированным, т. е. жестко запрограммированным параметрам относятся размер UDP-пакета, равный 2000 Б минимальный квант времени, который используется при описании топологии и составляет 1 мс протокол маршрутизации в сети в модели используется OLSR Optimized Link-State Routing оптимизированная маршрутизация по состоянию канала 10 стандарт связи IEEE 802.11b. Все узлы полагаются неподвижными, но расположение узлов при запуске может быть случайным. К настраиваемым параметрам модели относятся передаваемые видеоклипы 1 Foreman разрешение SIF 352 288 пикселей с частотой 30 кадровс, цветовое пространство YCbCr 420, длительность 300 кадров и 2 Ref7 разрешение DVD 720 576 пикселей с частотой 30 кадровс, цветовое пространство YCbCr 420, длительность 220 кадров кодек из множества MPEG1, MPEG2 и MPEG4 скорость кодирования от 200 Кбитс до 4000 Мбитс порядок следования кодированных кадров group of pictures GOP. Как правило, GOPпоследовательность IPPIPP выбирается из условия, что время между соседними кадрами не превышает 1 с номинальная скорость передачи 1 2 5,5 и 11 Мбитс топология сети рассматривается ниже допустимая задержка на приемной стороне от начала приема до начала декодирования. Очевидно, многие из настраиваемых а также частично фиксированных параметров будут меняться при рассмотрении других кодеков например, VP8, клипов и беспроводных сетей например, IEEE 802.16s. В программе моделирования используется стек протокола IPv4 с небольшими изменениями его можно заменить на IPv6. Все узлы лежат в одной подсети 10.1.1.024, начиная с адреса 10.1.1.1 и до 10.1.1.254. Расположение узлов в одной сети позволяет с минимальными изменениями конфигурационных файлов легко настраивать топологию. Топология сети описывается в конфигурационном файле. Каждая строчка файла, которая не начинается со знака диез, описывает одну сущность узел или соединение. Узел описывается следующей строкой Возможные значения и описание параметров узла приведены в табл. 1. Пример описания узла Для задания параметров соединения используется схожий синтаксис Возможные значения и описание параметров соединения приведены в табл. 2. Пример описания соединений В работе используются две топологии, иллюстрирующие односкачковую single-hop и многоскачковую multi-hop ad-hoc-сети. Топология 1 тривиальна и содержит два узла передатчик и приемник, расположенных в прямой видимости друг от друга. Такая топология позволяет получить результаты, которые являются верхней границей в смысле качества передачи для других, более сложных топологий. Топология 2 включает промежуточные и интерферирующие узлы. Топология 1 Топология 2 Как видно из описания топологии 2, видео должно пройти от узла 0, 0, 0 до узла 120, 0, 0 через три промежуточных узла. Два интерферирующих соединения расположены в непосредственной близости от промежуточных узлов, участвующих в передаче видео. Схематичное изображение топологий 1 и 2 представлено на рис. 3, и . Расстояние между соседними узлами выбрано с учетом того, что при максимальной скорости 11 Мбитс предельная дальность Tx range, позволяющая обеспечить приемлемую вероятность ошибки, на практике близка к 30 м 11. Для обеих топологий путем моделирования передачи UDP-пакетов были определены значения доступной скорости передачи при номинальных скоростях 1 2 5,5 и 11 Мбитс. По результатам, представленным в табл. 3, видно, что доступная скорость оказывается существенно меньше номинальной скорости даже для соединения точка-точка. Это объясняется, главным образом, тем, что заметную долю в общем трафике составляет служебная информация, а именно заголовки и RTSCTSACK пакеты. Для многоскачковой сети к указанному фактору добавляется эффект разделения скорости между частью узлов, что в еще большей степени снижает доступную скорость. Более того, в рассматриваемой многоскачковой сети увеличение номинальной скорости с 1 до 2 Мбитс сопровождается снижением доступной скорости с 0,42 до 0,21 Мбитс. Этот парадокс объясняется следующим обстоятельством. При номинальных скоростях 1 и 2 Мбитс предельная дальность передатчика превышает 60 м, поэтому протокол маршрутизации обнаруживает, что узел доступен для узла без промежуточного узла и, соответственно, назначает ему маршрут без промежуточного узла . В результате отношение сигналпомеха на входе приемника узла падает примерно на 6 дБ, что оказывается более критичным при номинальной скорости 2 Мбитс для нее изначально отношение сигналпомеха на 3 дБ меньше, чем для скорости 1 Мбитс . Каждый компрессированный кадр видео в формате RTP разбивается согласно указанным в работе 12 правилам на пакетов. Величина зависит от скорости компрессированного видео чем выше скорость, тем больше величина, типа кадра ключевой кадр требует, в общем случае, большего значения и природы видео. За время длительности кадра следует отправить пакетов длины, 1, 2, для одного видеокадра при доступной скорости передачи . Таким образом, время, затрачиваемое на передачу одного кадра 1 Для больших битовых скоростей большинство RTP-пакетов подвергаются разбиению на пакеты максимально возможной длины это означает, что время передачи одного кадра можно оценить сверху в виде 2 Если, то передача следующего кадра начинается через интервал относительно начала передачи текущего. Если время передачи текущего кадра оказывается больше, то кадры, следующие за текущим, отбрасываются до тех пор, пока текущий кадр не передан. Количество отброшенных кадров 3 Используя оценку 2 в выражении 3, получаем верхнюю границу для количества отброшенных кадров 4 позволяющую, в свою очередь, оценить степень ухудшения качества принятого видео. Указанная стратегия гарантирует отправку текущего кадра и, как показывает анализ, в сочетании с подходящей процедурой маскирования пропущенных кадров в большинстве ситуаций оказывается более эффективной с точки зрения качества, чем частичная отправка нескольких кадров. В процессе моделирования оба видеоклипа кодировались тремя видеокодеками MPEG1, MPEG2 и MPEG4 со скоростями кодирования компрессии в диапазоне 200 4000 Кбитс для клипа Foreman и 1000 4000 Кбитс для клипа Ref7. Отметим, что для обоих клипов даже на нижней границе диапазона скоростей кодирования обеспечивается отличное либо хорошее качество по шкале MOS. Кодированное видео передавалось по сети с возможными номинальными скоростями 1 2 5,5 и 11 Мбитс. На рис. 4 представлены результаты вычисления ОСШ PSNR в декодированном клипе Foreman для указанных значений доступных скоростей. В качестве верхней границы на рис. 4 и последующих рисунках используется функция PSNR скорость кодирования, соответствующая видеокодеку MPEG4. Для клипа Ref7 результаты, характеризующие PSNR в декодированном видео, показаны на рис. 5. По результатам можно сделать выводы, что, во-первых, при номинальных скоростях 1 и 2 Мбитс оптимальная в смысле максимума PSNR скорость кодирования несколько превосходит доступную скорость отношение находится в интервале от 1,04 до 1,31. Во-вторых, если скорость кодирования не превосходит оптимальную скорость, влияние канала на качество принятого видео практически несущественно ухудшение составляет от 0,01 до 0,5 дБ. В-третьих, при превышении оптимальной скорости кодирования качество принятого видео быстро падает до неприемлемых значений плохое качество по шкале MOS. В этой топологии, как указано выше, присутствуют узлы, генерирующие интерферирующую помеху, и дополнительные промежуточные узлы. Влияние интерферирующей помехи и промежуточных узлов проявляется следующим образом. Интерферирующий трафик, во-первых, потребляет какую-то часть доступной скорости передачи в сети в силу механизма доступа CSMACA и, во-вторых, искажает передаваемый сигнал, приводя к дополнительным ошибкам в передаче. Промежуточные узлы, в свою очередь а также занимают какую-то часть доступной скорости передачи б могут отбрасывать пакеты из-за переполнения буфера и в могут пропускать отправку кадра, если предыдущий кадр еще не завершил передачу. Рис. 6 иллюстрирует влияние перечисленных факторов при передаче клипа Foreman. Для сети с топологией 2 характерно следующее см. рис. 6. Во-первых, оптимальная скорость кодирования вновь оказывается близка к доступной скорости отношение находится в интервале от 0,95 до 1,04 во-вторых, проигрыш относительно варианта передачи в топологии 1 составляет 56 дБ. Для клипа Ref7 передача даже с наибольшей компрессией из рассмотренного диапазона скорость кодирования 1 Мбитс сопровождалась неприемлемым качеством при номинальных канальных скоростях 1 и 2 Мбитс. Результаты моделирования для скорости 11 Мбитс показаны на рис. 7. Как видим, здесь отношение 1,15, а проигрыш относительно варианта передачи в топологии 1 составляет около 5 дБ. Таким образом, проведенные эксперименты показывают, что 1 для обеих топологий оптимальная скорость кодирования оказывается близка к доступной скорости передачи и 2 увеличение дальности передачи в 4 раза, достигаемое при использовании многоскачковой сети с интерферирующими узлами, сопровождается ухудшением PSNR на 56 дБ при этом качество остается отличным по шкале MOS. . Анализ причин задержки при доставке видеокадров в рамках топологии 2 показал следующее. Задержки возникают вследствие затрат времени на передачу сообщения, его ожидание в очереди и необходимости ретрансляции на другой узел. Соседние узлы могут занимать общую среду, увеличивая время на передачу. Основным фактором, определяющим величину задержки, является соотношение скорости кодирования и доступной скорости передачи. Для оценки влияния этого соотношения были рассмотрены три варианта передачи с номинальной скоростью передачи 1 Мбитс, что соответствует доступной скорости 420 Кбитс. В первом варианте скорость кодирования составляла 200 Кбитс. На рис. 8 приведены текущие значения суммарного времени задержки при доставке видеокадров для клипа Foreman. Как видно из графика, максимальное значение задержки не превосходит 150 мс, а джиттер находится в приемлемом диапазоне, так что буфер подходящего размера обеспечит плавное воспроизведение видео. При небольшом увеличении скорости кодирования до 230 Кбитс задержка резко увеличилась почти в 7 раз, достигнув 1 с. И, наконец, при 400 Кбитс задержка в течение первой же секунды с момента начала передачи стала лавинообразно нарастать и достигла 8 с. Такая задержка допустима, если речь идет просто о доставке видео. Вместе с тем для интерактивных приложений приемлемая скорость кодирования, как видим, оказалась примерно вдвое меньше величины, что, в свою очередь, привело к снижению PSNR примерно на 3 дБ. В данной работе анализировалось качество передачи видео в односкачковой и многоскачковой ad-hoc-сетях. Ключевым фактором, определяющим качество передачи, является отношение скорости кодирования видео к доступной скорости передачи в сети . С точки зрения максимизации PSNR в доставленном видео, оптимальное значение отношения оказалось близким к 1 для обеих топологий. Увеличение дальности передачи вчетверо, достигаемое при переходе от односкачковой топологии к рассмотренной в работе многоскачковой топологии с интерферирующими узлами, сопровождалось ухудшением величины PSNR на 56 дБ. Тем не менее, качество доставленного видео оставалось отличным по шкале MOS. В интерактивных приложениях с допустимой задержкой порядка 150 мс оптимальное отношение при передаче в многоскачковой сети оказалось существенно меньше 1 в наших экспериментах это отношение было близко к 0,5. Как следствие, PSNR в доставленном видео дополнительно снизилось примерно на 3 дБ. Одним из инструментов улучшения качества передачи видео в ad-hoc-сетях представляется совершенствование использованного в работе алгоритма маршрутизации OLSR с тем, например, чтобы исключить появление парадоксов, аналогичных тому, что был отмечен при обсуждении полученных при моделировании доступных скоростей передачи в сети см. табл. 3. Желательно, в частности, чтобы алгоритм маршрутизации учитывал не только доступность узлов, но и уровень отношения сигналшум на входе узла. Это позволит трафику с высокой чувствительностью к потерям пакетов проходить по более надежным каналам, пусть и с большим числом промежуточных узлов. Для менее чувствительного трафика или трафика с низкой интенсивностью можно использовать прямой маршрут с худшим значением сигналшум на входе узла. Такая модификация протокола маршрутизации позволит, как представляется, увеличить доступную скорость передачи в многоскачковой ad-hoc-сети. 