ПРИМЕНЕНИЕ ПРЕДВАРИТЕЛЬНОГО МАСШТАБИРОВАНИЯ  ПРИ СЖАТИИ ВИДЕОПОТОКА В РЕАЛЬНОМ ВРЕМЕНИ 

Анализируется возможность применения предварительного масштабирования кадров видеопотока, сжимаемых по алгоритму JPEG, для улучшения качества восстановленного изображения. Определяется количественная зависимость качества изображения от соотношения степени сжатия алгоритмом JPEG и коэффициента масштабирования. Оценивается симметричность метода при работе в режиме реального времени.

Тенденция развития телекоммуникационных услуг показывает, что к 2013 г. суммарный поток видеоданных составит примерно 90 пользовательского телекоммуникационного трафика, включая видеоконференции, мобильную телефонию и видеонаблюдение 1. В результате актуальной становится проблема сжатия видеоинформации для передачи по телекоммуникационным сетям с сохранением высокого качества изображения на стороне пользователя. В системах видеонаблюдения, работающих в режиме реального времени, повышение степени сжатия видеоданных с сохранением уровня различимости объектов на отдельных изображениях позволит сократить интенсивность потока передаваемой информации и увеличить информационную емкость устройств хранения. Из известных в настоящее время методов сжатия видеопотока 2, 3 для передачи изображения в режиме реального времени наиболее подходят симметричные по времени компрессиидекомпрессии методы, многие из которых основаны на поблочном дискретном косинусном преобразовании ДКП изображения. Однако при высокой степени сжатия такими методами на декомпрессированном изображении становятся заметны границы блоков, на которые разбивается изображение при сжатии, что значительно снижает визуальное качество на стороне пользователя. В работе 4 описан предложенный авторами метод предварительного масштабирования изображения перед компрессией. Суть метода заключается в том, что перед компрессией изображение предварительно масштабируют вниз каким-либо алгоритмом сжатия, т. е. уменьшают размер сжимаемого по алгоритму JPEG изображения, затем сжимают, а после передачи по каналу и декомпрессии восстанавливают до исходного размера, т. е. масштабируют вверх с помощью алгоритмов интерполяции изображения. В результате заметность блочной структуры на декомпрессированном изображении уменьшается. Проведенные авторами эксперименты 4 показали, что в качестве алгоритма масштабирования по соотношению качество восстановления время обработки наиболее подходит интерполяционный алгоритм Bilinear 5. Анализ известных 6, 7 методик количественной оценки качества результирующего изображения по сравнению с исходным показал 4, что наиболее адекватно отображает разницу между изображениями мера 7 за счет многостороннего анализа сходства изображений по яркости, контрасту и структуре. В настоящей работе для изображений различного типа цветных, монохромных, контрастных, размытых, с мелкими деталями найдено оптимальное соотношение коэффициентов масштабирования и компрессии с точки зрения качества результирующего изображения, а также проведена оценка симметричности метода. Для обеспечения возможности объективно сравнивать результаты при проведении экспериментов коэффициенты масштабирования вниз и компрессии подбирались так, чтобы размер полученного изображения был равен размеру изображения после компрессии без предварительного масштабирования. Размер сжатого изображения при использовании предварительного масштабирования пропорционален выбранным для его сжатия коэффициентам масштабирования и компрессии . Под коэффициентом масштабирования понимается некоторое число, большее единицы, пропорционально которому меняется размер изображения, а коэффициент компрессии коэффициент сжатия изображения в диапазоне от 1 до 100. Чем выше коэффициент масштабирования, тем меньше размер изображения, и чем меньше коэффициент компрессии, тем выше качество изображения, т. е. . 1 В качестве алгоритма компрессии используется алгоритм JPEG как наиболее распространенный и универсальный, подходящий для разных типов изображений и не требующий значительных вычислительных ресурсов. Для каждого значения можно построить график зависимости качества изображения, восстановленного после сжатия, от отношения коэффициентов масштабирования и компрессии. Эта зависимость позволит определить наилучшие, с точки зрения качества по мере, значения и при конкретном . Для получения наиболее полной картины зависимости качества восстановления от коэффициентов масштабирования и сжатия были проанализированы результаты обработки изображений разных типов. При проведении экспериментов использовались четыре изображения разных типов контрастное рис. 1, размытое, монохромное градации серого и текст. Формат всех изображений bmp, размер 800 600 пикселей. Для нахождения наилучшего соотношения коэффициентов масштабирования и сжатия проводилось сравнение изображений одинакового размера из двух групп. Первая группа изображений была получена сжатием исходного изображения по алгоритму JPEG без масштабирования с коэффициентом качества от 1 до 100. Коэффициент качества у используемой при проведении экспериментов программы сжатия изображения алгоритмом JPEG представляет собой некий условный коэффициент сохранения качества при сжатии чем выше коэффициент, тем лучше качество и соответственно меньше степень сжатия, т. е. в алгоритме JPEG значение коэффициента качества обратно пропорционально коэффициенту компрессии из 1. Вторая группа изображений получена сжатием с помощью алгоритма JPEG предварительно отмасштабированного изображения с различными значениями коэффициента . В табл. 1 приведено соответствие коэффициента масштабирования и получающегося размера изображений в пикселях. Для каждого размера изображения коэффициент компрессии подбирался так, чтобы размер полученного после компрессии файла был равным размеру файла из первой группы изображений, что позволило объективно сравнить качество восстановленных изображений. Первое тестовое изображение пейзаж см. рис. 1. По результатам обработки была составлена таблица с размерами файлов всех полученных после сжатия изображений. Первый столбец в этой таблице содержит размеры изображений 1-й группы с коэффициентом, равным 1. Все остальные столбцы содержат размеры изображений 2-й группы с коэффициентом, большим 1, т. е. все эти изображения были перед сжатием масштабированы. Номера строк соответствуют коэффициенту качества JPEG. Всего было получено 1500 изображений. Фрагмент полученных данных приведен в табл. 2. По полученным данным были выделены 27 групп файлов с приблизительно равными размерами, причем в каждую группу входит от 2 до 15 изображений. Например, отмеченные в табл. 2 файлы относятся к одной группе с размером сжатого файла около 10 КБ. Сформированные группы были также сведены в таблицу. Первый столбец таблицы среднее арифметическое размера файла группы по строке, т. е. одна строка группа файлов примерно одного размера. Фрагмент полученных данных приведен в табл. 3. После замены данных была получена таблица, в которой вместо размеров файлов приведены соответствующие коэффициенты качества JPEG. Фрагмент полученной таблицы, соответствующий табл. 3, приведен в табл. 4. Из нее видно, что для получения изображения некого фиксированного размера можно варьировать коэффициенты масштабирования и компрессии в достаточно широких пределах. Далее была произведена оценка качества восстановленных изображений по всем 25 группам с помощью меры структурного подобия Изображения всех групп сравнивались с эталоном, т. е. исходным изображением, а результаты измерений были сведены в таблицу, фрагмент которой приведен в табл. 5. Анализ полученных данных свидетельствует о том, что качество предварительно отмасштабированных перед сжатием изображений превышает качество немасштабированных изображений, начиная с группы со средним размером 12,9270 КБ, которому соответствует коэффициент качества JPEG около 13. Например, помеченные в табл. 5 ячейки соответствуют предварительно отмасштабированным перед сжатием изображениям с более высоким качеством, чем немасштабированные изображения. При небольших коэффициентах компрессии эффект виден на самом меньшем коэффициенте сжатия 1,5, но с увеличением коэффициента компрессии соответственно, уменьшением коэффициента качества JPEG исходного изображения эффект становится заметен и на других изображениях с большим коэффициентом компрессии. По результатам измерения качества восстановленных изображений был составлен график рис. 2. Для изображений других типов были проведены аналогичные эксперименты, составлены группы файлов, совпадающих по размерам, и произштабирования для увеличения качества видеопотока при его передаче в on-line режиме, является его симметричность по времени, т. е. время, затраченное на декомпрессию изображения после передачи его по какому-либо каналу, должно быть меньше либо равно времени компрессии. Использование предварительного масштабирования для повышения качества видеопотока предполагается выполнять по схеме, представленной на рис. 3. Исходное изображение предварительно масштабируется вниз с помощью алгоритма Bilinear, сжимается алгоритмом компрессии JPEG и передается по каналу передачи. После передачи изображение восстанавливается алгоритмом компрессии, после чего масштабируется вверх алгоритмом масштабирования. Одной из главных характеристик видеопотока является количество кадров в секунду. Чем выше эта характеристика, тем более плавным и естественным будет казаться пользователю движение на экране. Минимальное значение этой характеристики, при котором движение будет восприниматься однородным, является частота 16 кадров в секунду англ. fps. В традиционном кинематографе используется частота 24 fps, системы телевидения PAL и SECAM используют 25 fps, а система NTSC 29,97 fps 8. Максимально высокая частота смены кадров, которую способен воспринять человеческий мозг, лежит в диапазоне от 39 до 42 fps. Большое значение имеет и такая характеристика видеопотока, как размеры кадра по высоте и ширине в пикселях. Для обычного аналогового телевидения в стандартах PAL и SECAM размер кадра составляет 720 576 пикселей, для стандарта NTSC 720 480 пикселей. В последнее время широкое распространение получило телевидение высокой четкости HDTV. Существует три стандарта HDTV 9, 10 1 720p 1280 720 пикселей, прогрессивная развертка 24, 25, 30, 50 и 60 fps 2 1080i 1920 1080 пикселей, чересстрочная развертка 50 и 60 fps ведены измерения качества мерой S . Всего было обработано 5600 изображений. Пороговые значения коэффициентов качества JPEG, при которых качество восстановленного изображения после сжатия с предварительным масштабированием превышает качество восстановленного изображения после сжатия без масштабирования, для разных типов изображений следующие контрастное 13 монохромное 16 размытое 11 текст 46. Пороговое значение коэффициента качества JPEG, ниже которого есть смысл использовать предварительное масштабирование, зависит от типа изображения. Если у контрастного, монохромного и размытого изображений эти коэффициенты близки, то для текстового изображения пороговый коэффициент значительно выше. Это можно объяснить тем, что текст представляет собой специфическое высококонтрастное изображение с большим количеством резких и мелких деталей черные буквы на белом фоне. При сжатии изображений такого типа масштабирование с последующим растяжением приводит к заметному размыванию очень большого количества значительных перепадов яркости, что существенно влияет на оценку качества восстановленного изображения. При коэффициенте качества JPEG, равном 46 и ниже, ухудшение качества из-за появления блочной структуры у восстановленного изображения, которое сжималось без масштабирования, начинает превышать ухудшение качества из-за размывания восстановленного изображения, которое сжималось с предварительным масштабированием. Одним из важных требований, предъявляемых при использовании предварительного мас3 1080p 1920 1080 пикселей, прогрессивная развертка 24, 25 и 30 fps. Пропускная способность канала передачи данных накладывает ограничение на размер передаваемого изображения, так как необходимо исключить временные задержки на стороне пользователя. В табл. 6 приведены допустимые размеры файлов КБ для видеопотоков с заданным количеством кадров в секунду, передаваемых по каналам с разной пропускной способностью. Учитывая данные табл. 6 и пороговые значения коэффициентов качества JPEG, можно определить коэффициенты масштабирования и качества JPEG, позволяющие получить необходимый размер файла со сжатым кадром. Если сжать изображение размером 720 480 пикселей алгоритмом JPEG с самым высоким коэффициентом компрессии, то размер файла составит примерно 2,9 КБ. Эта величина превышает максимально допустимый размер из табл. 6, т. е. канал с пропускной способностью 64 КБ с из дальнейшего рассмотрения можно исключить. Для канала с пропускной способностью 128 КБ с изображения для стандартов PAL и SECAM с исходным размером 720 576 пикселей необходимо сжимать алгоритмом JPEG с коэффициентом качества 7, что позволяет получить файл размером около 4,9 КБ. Исходя из оптимального соотношения коэффициентов масштабирования и компрессии изображение сначала необходимо масштабировать вниз с коэффициентом масштабирования 2, а потом сжать алгоритмом JPEG с коэффициентом качества 29. Размер полученного файла составит 4,9 КБ, что равно по размеру файлу сжатого изображения без предварительного масштабирования. Изображение, предварительно отмасштабированное, с точки зрения восприятия человеческим глазом по качеству существенно лучше. Оценка качества мерой дает следующие значения изображение, сжатое только JPEG, 0,8046 рис. 4, полученное с использованием предварительного масштабирования, 0,8420 рис. 4, . Для передачи других стандартов этот канал не подходит по пропускной способности. Для передачи изображения в стандарте HDTV 720p с 24 и 25 fps подходит канал с пропускной способностью 256 КБ с. Для получения из исходного изображения 1280 720 пикселей файла сжатого изображения размером, достаточным для передачи по этому каналу, коэффициент качества JPEG должен быть не более 5 размер файла примерно 8,5 КБ. Такой же размер имеет файл, полученный в результате масштабирования изображения вниз с коэффициентом масштабирования 2 с последующей компрессией с коэффициентом качества JPEG 20. Оценка качества мерой дает следующие значения изображение, сжатое только JPEG, 0,7901 рис. 5, полученное с использованием предварительного масштабирования, 0,8683 рис. 5, . Для передачи HDTV 1080i и 1080p с 24 fps подходит канал с пропускной способностью 512 КБ с. Для получения из исходного изображения 1920 1080 пикселей файла сжатого изображения размером, достаточным для передачи по этому каналу, коэффициент качества JPEG должен быть не более 4 размер файла примерно 19 КБ. Такой же размер имеет файл, полученный в результате масштабирования изображения вниз с коэффициентом масштабирования 2 с последующей компрессией с коэффициентом качества JPEG 20. Оценка качества мерой дает следующие значения изображение, сжатое только JPEG, 0,7740 рис. 6, прошедшее предварительное масштабирование, 0,8763 рис. 6, . Полученные соотношения коэффициентов масштабирования и компрессии позволяют оценить симметричность метода в зависимости от пропускной способности канала. Использование предварительного масштабирования предполагается по схеме, приведенной на рис. 3. Для передачи видеопотока PALSECAM по каналу с пропускной способностью 128 КБ с каждый кадр сначала необходимо отмасштабировать вниз с коэффициентом 2, на что потребуется 7,56 мс. Далее отмасштабированный кадр необходимо сжать с коэффициентом качества JPEG 29, на что потребуется 5 мс. Просуммировав время, необходимое на масштабирование и компрессию, получаем, что на обработку одного кадра при сжатии должно потребоваться 12,56 мс. После передачи по каналу изображение декомпрессируется алгоритмом JPEG, причем, декомпрессия не превысит 5 мс, так как алгоритм JPEG симметричен по времени 3. Масштабирование изображения до исходного размера займет 10,75 мс. Итого, декомпрессия займет 15,75 мс. Аналогичные вычисления были проведены для других пропускных способностей канала передачи. Результаты представлены в табл. 7. Масштабирование изображения вниз занимает меньше времени, чем масштабирование вверх, т. е. сам по себе метод не симметричен. На восстановление изображения требуется примерно в 1,2 раза больше времени, чем на его сжатие. При частоте кадров 25 fps обработка одного кадра не должна превышать 40 мс. Этому требованию соответствуют два канала передачи данных 128 и 256 КБ с. Очевидно, что время работы любого алгоритма напрямую зависит от характеристик компьютера. При проведении экспериментов для оценки времени использовался компьютер со следующими характеристиками процессор AMD Athlon 64 X2 4600 с частотой ядра 2400 МГц оперативная память DDR2 1Gb PC2-6400 800MHz DIMM объемом 2 ГБ материнская плата MSI K9N6PGM2-V2 с чипсетом GF6150. Использование более мощного и современного компьютера позволит уменьшить время работы как алгоритмов интерполяции, так и компрессии и, соответственно, расширит перечень допустимых пропускных способностей канала передачи. Проведенные эксперименты подтверждают целесообразность использования предварительного масштабирования изображения перед компрессией для повышения качества восстановленного изображения при передаче видеопотока в реальном времени. Анализ результатов экспериментов позволяет дать следующие рекомендации если коэффициент качества JPEG не превышает 15, то для всех изображений, кроме текстовых, использование предварительного масштабирования повышает качество восстановленного изображения качество изображения имеет максимальное значение при небольшом коэффициенте масштабирования вниз, причем с увеличением коэффициента масштабирования вниз и увеличением компрессии качество падает, т. е. целесообразно использовать небольшие коэффициенты масштабирования вниз 1,52 несмотря на то, что алгоритм масштабирования не симметричен, эта несимметричность незначительно сказывается на времени работы рассмотренного метода. 