УСТАНОВЛЕНИЕ СВЯЗЕЙ МЕЖДУ ЭЛЕМЕНТАМИ   БАЗОВОЙ СЕТИ ПРИ ПАРАМЕТРИЗАЦИИ ЧЕРТЕЖЕЙ  

Рассмотрены проблемы создания параметрической модели любого чертежа путем определения количественных связей между элементами базовой сети, образованной характерными точками основных графических примитивов. Создание модели ведется на основе обработки размерных обозначений, установленных на  этом чертеже в соответствии с методом аналитико-синтетической параметризации. Изложены особенности алгоритмов обработки различных размерных обозначений, имеющихся на чертеже. Установление связей служит  для обеспечения модификации чертежа с учетом задания новых значений параметров. Ключевые слова  — параметризация, модификация, чертеж, электронное представление, базовая сеть, графические примитивы, размерное обозначение, связь элементов сети. 

При параметризации ранее созданных чертежей, представленных в виде файлов векторного описания графических примитивов, составляющих чертеж, необходимо вычислить координаты всех точек, определяющих эти примитивы, в зависимости от используемых значений размерных обозначений. Это требование обусловлено тем, что автоматически перечертить модифицировать чертеж детали, задав для этой детали другие значения размеров, можно только при условии знания того, как при этом изменяются координаты точек каждого графического примитива, входящего в описание чертежа. Эта задача решается при использовании аналитико-синтетического метода параметризации 1, в основе которого лежит понятие опорной базовой сети чертежа. Каждый элемент этой нерегулярной координатной сети определяется положением координатами характерных точек всех графических примитивов изображения детали. При этом вся сеть включает в себя основные ортогональные составляющие горизонтальную и вертикальную, а также вспомогательную угловую составляющую. Все их можно рассматривать относительно независящими друг от друга сетями подсетями. Введение такой опорной сети существенно упрощает создание параметрической модели чертежа, так как действие сети распространяется на все поле изображения чертежа и по горизонтали, и по вертикали, и в угловом представлении. При этом опорная сеть с установленными количественными или функциональными связями между всеми ее элементами через используемые в чертеже размерные обозначения и является, по сути, параметрическим описанием такого чертежа. В случае наличия таких описаний легко определить новые координаты всех графических примитивов детали при ее модификации в соответствии с заданными новыми значениями размерных обозначений и автоматически перерисовать чертеж. Использование опорной сети чертежа облегчает определение связей между ее элементами, т. е. создание параметрической модели чертежа, при этом процесс создания оказывается унифицированным и практически независимым от конкретного представления изображенной на чертеже детали. Он не зависит от системы координат, в которой представлен чертеж, от количества используемых в нем видов, от типа используемых размерных обозначений и места их установки, от количества и типа графических примитивов и условий их взаимного отношения и расположения. Процесс параметризации и модификации изображений при таком подходе требует минимального участия конструктора пользователя. Вмешательство конструктора осуществляется только на начальном этапе для задания ввода в систему новых значений размерных обозначений и на заключительном этапе для графического редактирования построенного чертежа. При этом редактирование требуется только в случаях редко встречающейся необходимости изменить схему простановки размерных обозначений и откорректировать внутренние параметры данные используемых в чертеже технологических обозначений. Однако эти операции достаточно просто автоматизировать, так что они не требуют много времени и усилий от конструкторов. Процесс определения связей между всеми элементами опорной сети по горизонтали DWX, вертикали DWY и по углу DWA процесс создания параметрической модели чертежа базируется на выявлении в чертеже основных видов детали и определении расстояний между этими видами в целях установления параметров связи между элементами опорных сетей этих видов так для элементов сети, соответствующих видам сверху и снизу, устанавливается связь с видами слева, справа и сзади, и наоборот определении базовой точки исходного чертежа последовательной обработке всех установленных имеющихся в чертеже размерных обозначений выявлении точек, породивших те элементы опорной сети чертежа, для которых после обработки размерных обозначений не были установлены связи с другими элементами сети. Это делается путем выявления графических примитивов, к которым эти точки относятся, и отношений между примитивами в этих точках в точках их со единения. На основе этого находятся связи этих точек с други ми характерными точками примитивов, т. е. связи для соответствующих элементов опорной сети. . В основе алгоритма выявления в чертеже представленных видов детали лежит принцип автоматического нахождения габаритов охватывающих прямоугольников, соответствующих отдельным видам. Эти прямоугольники формируются на основе анализа геометрических параметров основных графических примитивов, входящих в описание чертежа, с точки зрения их непосредственной связи касания или пересечения друг с другом. В результате определяется общее количество и взаимное расположение отдельных прямоугольников, соответствующих видам чертежа. Соответственно, на основе параметров выделенных прямоугольников, которые охватывают виды, определяются виды, присутствующие в чертеже, и положение главного вида, а также устанавливаются параметры связи между элементами опорных сетей, относящимися к разным видам. Эти параметры связей между видами необходимы для взаимного дополнения сетей DWX и DWY за счет параметров, определенных в одной из них. Так, часть сети DWX, которая относится к видам слева или справа, должна дополняться связями, определенными для сети DWY и относящимися к видам сверху или снизу, и наоборот. Кроме того, значения межвидовых параметров необходимы для учета взаимного влияния размерных обозначений главного вида на элементы сети DWX вида сзади, и наоборот. . В качестве базовой точки всего чертежа x, y, положение которой не меняется при его модификации, принимается точка главного вида, которая либо лежит на оси его симметрии, либо является точкой центральной симметрии этого вида, либо с ней связано наибольшее количество линейных размеров, установленных параллельно осям координат. При этом элементам сети dwx и dwy, которые связаны с этой точкой, сразу же присваивают значения, соответствующие ее координатам в исходном описании чертеже. Таким образом, при модификации чертежа положение этой точки не будет меняться, а все остальные элементы опорной сети, соответствующие задающим точкам графических элементов, рассчитываются непосредственно или опосредованно относительно этой точки. При этом связи должны быть определены между всеми элементами опорных сетей. . Определение связей между всеми элементами опорной сети начинается с выявления так называемых явных простых связей за счет последовательной обработки всех линейных вертикальных и горизонтальных, а также радиальных и диаметральных размерных обозначений. Это обусловлено тем, что подобные размерные обозначения непосредственно устанавливают связи между элементами соответствующих сетей, связанных с этими размерами. При этом составляются параметрические модели в виде списков или массивов связей по соответствующей координате DWX и DWY, в которые заносятся попарно те элементы сетей, для которых связь установлена после обработки каждого размерного обозначения. Элементы этих списков параметрической модели далее списков модели представляются в виде записей типа dwx dwx VV или dwy dwy VV, 1 где VV и VV величины, соответствующие значениям размерных обозначений, задающие значение связи между соответствующими элементами ортогональных сетей по оси Х или Y dwx dwx, dwy dwy, т. е. и VV, и VV положительны больше нуля. Для контроля и оптимизации процесса формирования параметрической модели чертежа необходимо постоянно отслеживать, какие из элементов опорных сетей DWX и DWY еще не обработаны, т. е. не включены в списки связей. В случае обработки симметричных размерных обозначений по соответствующей координате соответствующий список параметрической модели дополняется не одной, а двумя подобными 1 записями между каждой из точек, к которым привязано размерное обозначение, и элементом сети, соответствующим оси симметрии. При обработке радиальных и диаметральных размерных обозначений связи устанавливаются между элементами сетей, которые соответствуют положению центров всех дуг и окружностей и квадрантным точкам этих графических примитивов чертежа с учетом новых значений радиусов диаметров. Следует подчеркнуть, что при обработке каждого размерного обозначения связи устанавливаются для элементов сетей, связанных соответствующими точками для всех дуг и окружностей чертежа такого же радиуса диаметра. Не следует забывать, что одновременно с установлением связи между элементами опорной сети за счет обработки каждого из размерных обозначений необходимо устанавливать связи между элементами по противоположной сети, если они обусловлены влиянием видов чертежа друг на друга. . Дальнейший процесс установления отношений между элементами опорной сети связан с обработкой линейных параллельных и угловых размерных обозначений. Для решения задачи обработки параллельных размерных обозначений все имеющиеся в текущем чертеже параллельные размеры в соответствии с возможными способами их алгоритмической обработки 2 целесообразно разбить на четыре группы одиночные размеры, устанавливаемые на отдельные наклонные отрезки попарно связанные размеры, устанавливаемые на два отрезка, имеющих общую точку связанные в тройки, в которые входят размеры, установленные на три связанных друг с другом отрезка, в совокупности образующие треугольники особые случаи, куда следует отнести размеры, поставленные на отрезки, на конце концах которых находятся одна или две дуги сопряжения., установленные на наклонные отрезки, можно отнести к наиболее простым вариантам определения соответствующих им параметров базовой сети. В этих вариантах для выявления параметров сетей часто вместе с параллельным размером используется дополнительный размер одного из следующих типов горизонтальный, вертикальный или угловой рис. 1, . Эти случаи можно отнести к явному заданию элементов опорной сети. Элементы опорной сети, которые соответствуют концам таких отрезков, как правило, уже определены по одной из координат через значение горизонтального или вертикального размера. Тогда по второй координате они определяются на основе теоремы Архимеда. Если обрабатываемому параллельному размеру сопутствует угловой размер, связи по обеим координатам определяются на основе обрабатываемого размера и связанного с ним углового параметра с использованием тригонометрических функций sinАlf и cosАlf. обрабатываемому параллельному размерному обозначению непосредственно не сопутствует ни горизонтальный, ни вертикальный, ни угловой размер рис. 2. Однако для успешной обработки такого размера оба конца отрезка, на который поставлен этот размер, должны быть обязательно связаны с элементами опорной сети DWX или DWY, которые уже находятся в соответствующих списках параметрической модели. Иными словами, эти элементы опорной сети должны присутствовать в списках уже установленных связей с другими элементами по этой составляющей. Тогда связь для отрезка по координате Y или X определяется через цепочку известных связей между элементами опорной сети по этой координате. Такие цепочки, в которые может входить произвольная совокупность связей, определенных ранее через уже обработанные размерные обозначения, достаточно часто встречаются в реальных чертежах. Таким образом, при параметризации подобных случаев приходится вначале автоматически разрешить возникшую неопределенность и привести эти случаи к явному заданию связи между концами обрабатываемого параллельного размера, т. е. к предыдущим вариантам см. рис. 1. Алгоритм выявления значения неявной связи заключается в нахождении суммарного значения для цепочки элементов сети с установленными связями, подсоединенных к анализируемому параллельному размеру, и состоит из следующих этапов. На начальном этапе определяется совпадение элементов основной сети, которые соответствуют точкам начальной, средней для отрезка с осью симметрии или конечной отрезка, на который поставлен параллельный размер рис. 3, с одним из первых двух элементов в записях созданного к этому моменту списка параметрической модели. Это может быть список по координате X или Y, например по координате X dwx dwx VV dwx dwx VV dwx dwx VV . В случае совпадения элементов например, dwx или dwx по оси X, по крайней мере, для двух из трех точек отрезка, начинают формироваться вспомогательные списки массивы для соответствующего совпадающего элемента сети в виде dwx VV или dwx VV, 2 где в записи dwx или dwx первый параметр соответствует свободному не совпадающему элементу записи из списка параметрической модели dwx dwx VV запись VV рис. 4, делается в том случае, если совпадение характерной точки привязки происходит с элементом, который является в выявленной записи списка параметрической модели второй элемент записи в модели совпадает с элементом сети рассматриваемой точки отрезка, на котором установлен параллельный размер запись VV рис. 4, создается в случае, если запись в модели привязана к характерной точке отрезка своим первым элементом. При этом из дублирующего списка параметрической модели те записи, для которых выявлено совпадение элементов. Если в параметрической модели имеется не одна запись, элемент которой по соответствующей координате совпадает с анализируемой точкой, а несколько, то формируемый вспомогательный список Sp для рассматриваемой точки например, 0 должен включать в себя соответствующее число аналогичных записей Sp dwx VV dwx VV dwx VV . Таким образом, при обработке каждого параллельного размера может создаваться до трех вспомогательных списков в соответствии с количеством характерных точек отрезка, на котором установлен обрабатываемый параллельный размер Sp, Sp, Sp . На втором этапе осуществляется определение значения неявной связи при обработке вспомогательных списков с записями, которые непосредственно связаны с характерными точками отрезка. Для этого выявляется совпадение первых параметров в записи одного списка с записью другого списка рис. 5 и осуществляется вычитание значения VV, соответствующего точке с большим номером Sp из меньшего, например VV VV VV, так как координата точки 0 1. Если совпадение установлено см. рис. 5, можно считать, что параметр связи VV между элементами базовой сети определен, и осуществляют пополнение параметрической модели по этой координате. Одновременно обеспечивается обработка текущего параллельного размера и дополнение сети по другой координате в соответствии с тем, как это делалось для вариантов, представленных на рис. 1, . Иначе см. рис. 5, переходят к следующему, третьему этапу. На третьем этапе в циклах по всем записям вспомогательного второго и третьего списка осуществляется поиск совпадения первых значений каждой записи с одним из первых двух элементов в записях дублирующего списка параметрической модели так, как это делалось на первом этапе. В случае выявления совпадения осуществляется корректировка соответствующей записи вспомогательного списка меняется первый элемент записи на свободный не совпадающий элемент записи модели, а новое значение VV определяется алгебраической суммой элемента в записи вспомогательного списка и в записи модели в соответствии с правилом 2. После этого работа алгоритма возвращается на второй этап. Подобные переходы со второго на третий этап и обратно осуществляются до тех пор, пока не будет выявлено значение неявной связи или не будет полностью вычищен дублирующий список параметрической модели. В последнем случае считается, что неявная связь не определена, и данный параллельный размер необходимо перенести в конец списка необработанных размеров, временно отложив его обработку, и продолжить пополнять параметрическую модель за счет обработки других размерных обозначений. представляют более сложную конструкцию для определения функциональных связей опорной сети, так как в этих случаях необходимо одновременно устанавливать связь для общей точки двух отрезков сразу по обеим координатам. Если свободные концы связанных параллельных размеров находятся на одной координате рис. 6, то определение параметров связи необходимо выполнять только для общей точки обоих размеров. Процесс определения значений таких связей достаточно очевиден и не представляет особой трудности в плане вычисления он базируется на решении уравнения, составленного на основе равенства катетов для двух прямоугольников, образованных перпендикуляром, опущенным из общей точки на линию, соединяющую свободные концы отрезков, расстояние между которыми должно быть известно благодаря явному или неявному заданию. Для случая, представленного на рис. 6, это расстояние находится на основе теоремы косинусов 3. Сложность выявления связей для общей точки двух отрезков и соответствующих ей элементов базовой сети несколько возрастает, когда свободные концы отрезков не лежат на одном уровне значения их координаты по оси X или Y отличаются, как это представлено на рис. 6, . В подобных вариантах необходимо вначале определять расстояние между свободными концами связанных отрезков исходя из известных для них значений координат, а далее находить связи для общей точки c другими точками этих треугольников по координате X x и координате Y y так, как будто бы их концы находятся на одном уровне см. рис. 6, . Затем, исходя из наклона линии связи свободных концов к соответствующей оси координат например, на угол Alf к оси абсцисс, следует определять реальные значения связи общей точки с другими точками треугольника путем разворота треугольника вокруг общей точки на соответствующий угол. Нахождение реальных значений x и y осуществляется путем умножения значений x и y на матрицу поворота на угол Alf 4. После определения реальных значений связи по каждой координате осуществляется пополнение параметрической модели по обеим координатам. Сложность выявления связей для размерных и опорных сетей возрастает, когда для двух связанных отрезков параллельных размеров известен не угол, лежащий между ними, а угол наклона одного из этих отрезков например, рис. 6, . Здесь вначале для нахождения расстояния между свободными концами приходится использовать теорему косинусов, после чего этот вариант сводится к тем, которые рассмотрены ранее. При неявном задании свободных концов двух связанных параллельных размеров отрезков очевидно, что задача решения параметризации, соответственно, усложняется, так как необходимо вначале разрешить эту неопределенность, как это описывалось ранее. Только после этого можно приступать к решению основной задачи нахождению связи для общей точки этих отрезков размеров., установленные на три связанных друг с другом отрезка, в совокупности образуют треугольники рис. 7. Этот случай должен рассматриваться тогда, когда программа не смогла выявить явную или опосредованную неявную связь между свободными концами двух связанных параллельных размеров. Особенность этого варианта заключается в том, что вершины образованного этими отрезками и параллельными размерами треугольника могут быть как связаны, так и не связаны с размерной сетью остальных графических примитивов чертежа. В первом случае ориентация такого треугольника должна определяться этими связями, а во втором она может быть произвольной. Однако и в первом, и во втором случаях задача определения величин параметра связи может быть сведена к выполнению двух этапов определению связей подобно варианту, представленному на рис. 6, коррекции значений параметров связи с учетом разворота треугольника в системе координат до требуемого положения на определенный угол вокруг одной из вершин этого треугольника. Величина угла должна определяться либо условиями привязки треугольника к опорной сети остальных графических элементов чертежа, либо, если таких условий не выявлено, она может определяться исходным наклоном одного из отрезков размеров к осям координат., подсоединенные к этим отрезкам на одном или обоих концах. В этих случаях на параметры отрезков влияют не только установленные непосредственно на них параллельные размеры, но и параметры дуг сопряжения, в частности, положение центра дуг и значения их радиусов. Все эти параметры одновременно влияют на положение конца отрезка точки его сопряжения с дугой и его наклон. Это приводит к тому, что решение проблемы параметризации нахождения связей между координатами характерных точек отрезка и центрами дуг сопряжения для таких объектов в различных вариантах их сочетания рис. 8 оказывается нетривиальной задачей. Для выхода из этой трудной ситуации предлагается вводить вместо пар из параллельного и радиального размеров объединенные, так называемые фиктивные параллельные размеры. Эти размеры являются как бы порождением этой пары и должны определяться величинами как радиусов дуг сопряжения, так и связанных с ними параллельных исходных размеров рис. 9. Введение таких размеров позволяет разделить задачу автоматического нахождения параметрических связей характерных точек подобных фигур на два этапа. На первом этапе должна решаться задача определения связей координат центра дуги дуг с элементами сети, для которых связи уже установлены. Эта задача решается аналогично рассмотренным ранее вариантам при анализе обычных параллельных размеров, которые установлены на отрезки см. рис. 1, 6, 7. На втором этапе устанавливается связь между координатами центра дуги и точкой сопряжения соответствующей дуги и отрезка на основании значения радиуса дуги и значений исходного и фиктивного параллельных размеров см. рис. 9, 10. На первый взгляд, процесс нахождение координат точек сопряжения и, главное, установление связей их с другими элементами сети включение в модель параметризации достаточно сложен. Однако его можно существенно упростить, если предварительно решать эту проблему с использованием локальной системы координат, начало которой совпадает с центром рассматриваемой дуги сопряжения, а ось Х или Y совпадает с отрезком, на котором устанавливается фиктивный размер. Иными словами, ось должна проходить через центр дуги и свободный конец отрезка сопряжения при наличии одной дуги см. рис. 9 либо через центры дуг сопряжения, если дуги находятся на обоих концах см. рис. 10. В соответствии с рис. 9, и на основании подобия треугольников определение величин смещения координат точек сопряжения и относительно центра дуги окружности осуществляется следующим образом x R y L RL, y y, откуда x R L, y L RL, y L RL . В этом случае смещение координат точек сопряжения и относительно центра в исходном состоянии см. рис. 9, определяется с использованием матрицы поворота на угол против часовой стрелки В результате перемножения матриц получаем смещение координат точек касания левой и правой относительно центра дуги окружности по координате X и Y x x сos y sin, y x sin y сos, x x сos y sin, y x sin y сos . Нахождение смещения точек сопряжения отрезка с двумя дугами, расположенных по одну сторону от отрезка, относительно координат центра соответствующей дуги окружности не представляет никакой сложности см. рис. 10, так как x absR R y L R L . Отсюда x absR R R L, y R LL, x absR R R L, y R LL . При этом знак приращения по каждой координате точек сопряжения для каждой дуги должен выявляться в зависимости от расположения центров окружностей дуг друг относительно друга. Определение параметров смещения точек сопряжения отрезка с дугами, расположенных по разные стороны отрезка, относительно координат центра соответствующих дуг следует осуществлять в следующем порядке. Последовательно определяются координаты точки P пересечения отрезка сопряжения с отрезком, соединяющим центры окружностей обеих дуг, на основе параметрического уравнения для второго отрезка P P P P R P P наклон отрезка, соединяющего центры дуг, к оси абсцисс sin и cos расстояния L и L от этой точки до соответствующего центра дуги величины смещения каждой точки сопряжения относительно центра рассматриваемой дуги вначале в одной, а затем в другой локальной координатной сети, начало каждой из которых совпадает с центром соответствующей дуги реальное смещение точек сопряжения в исходной координатной системе. Оно находится в соответствии с алгоритмом обработки соединения, представленного на рис. 9. Параметрические модели конструкторского чертежа имеют важное значения для автоматического получения модифицированных комплектов документации, однако построение таких моделей представляется достаточно трудно решаемой задачей. В работе на примере ряда алгоритмов, обеспечивающих обработку самых разнообразных линейных размеров, наглядно показана возможность эффективного построения численной параметрической модели, устанавливающей связи между элементами базовой сети чертежа через эти параметры. Вместе с тем в представленном материале не рассмотрены многие вопросы параметризации, связанные с обработкой условий параллельности, перпендикулярности, постоянства толщины, дополнительных видов, центральной симметрии и т. д. Полагаем, что эти вопросы требуют отдельного рассмотрения. 