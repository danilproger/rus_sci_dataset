МЕТОД ФОРМИРОВАНИЯ 3D-ИЗОБРАЖЕНИЯ СЦЕНЫ  ПО ОДНОЙ ФОТОГРАФИИ 

Описан метод формирования 3D-изображения сцены, основанный на аппроксимации ее центральной проекции (2D-изображения) набором плоскостей с последующей декомпозицией сцены на эти плоскости. Для каждой из плоскостей находится аксонометрическая проекция путем использования имеющейся априорной информации об изображенной сцене и карта глубины. Завершающим шагом описываемого метода является  «сборка» 3D-изображения сцены объединением аппроксимирующих ее плоскостей и проекция сцены на экран  при заданных условиях наблюдения. Ключевые слова  — 3D-изображение, 3D-сканирование, карта глубины. 

При наблюдении трехмерных объектов и сцен, несмотря на то, что в их проекциях на сетчатки глаз координата глубины оказывается утраченной, мы, тем не менее, воспринимаем их объемными. Объясняется это тем, что в этих проекциях, которые представляют собой 2D-изображения, содержится информация, используя которую совместно с априорной информацией, имеющейся у зрителя о наблюдаемых объектах, зрительная кора в той или иной мере восстанавливает утраченную при проецировании информацию о координате глубины. Примерами информации, используемой зрительной корой для определения оценки утраченной координаты глубины, являются величина искажений геометрических размеров наблюдаемых объектов, возникающих в результате их центральной проекции на сетчатки глаз перекрытие объектами, близко расположенными к зрителю, объектов, которые расположены от зрителя на больших расстояниях распределение полутеней на криволинейных поверхностях объектов, обусловленное эффектом диффузного отражения света расположение объектов относительно линии горизонта наличие атмосферной дымки и пр. Эти свойства зрения изучались и использовались в архитектуре и живописи, начиная уже с античных времен. Колонны храма Парфенона, форма которых намеренно выбрана отличной от цилиндрической, являются примером одного из первых практических применений законов перспективы в архитектуре. Интенсивное развитие живописи в эпоху Возрождения также в значительной степени связано с использованием перечисленных выше свойств зрения. В настоящее время возрос интерес к 3D-технологиям и, в частности, к методам получения трехмерных изображений, что, естественно, проявилось в появлении множества публикаций на эту тему, например 17, а затем и в разработке 3D-сканеров, 3D-кинотеатров и 3D-телевидения. В последних двух случаях речь идет по существу о стереоскопических системах. В связи с тем, что изначально съемка 3D-фильмов является весьма дорогостоящим предприятием, появились попытки разработать методы, позволяющие преобразовывать обычные 2D-контенты в 3D-контенты, основанные на использовании перечисленных выше свойств зрения. Так, в университете Карнеги Меллона был разработан метод преобразования 2D-изображений в 3D-сцену, подробности которого не разглашаются, но известно, что 3D-изображение строится с использованием только вертикальных и горизонтальных поверхностей, обнаруженных на 2D-изображении 8. Были также разработаны методы, примененные в настоящее время в телевизорах, в которых использованы свойства взаимного перекрытия объектов переднего и последующего планов, а также разница в цвете и контрасте между изображениями объектов различных планов. Однако качество получаемых при этом изображений невелико. В данной статье рассматривается метод формирования 3D-изображения сцены и составляющих ее объектов, которые можно аппроксимировать плоскостями, по одной 2D-фотографии. Приведем свойства перспективных преобразований для прямых линий. 1. В общем случае прямая линия на объекте проецируется в прямую линию на изображении центральной проекции, но с . Например, движение точки с постоянной скоростью по прямой линии на объекте отображается ее движением на изображении тоже по прямой линии, но с неравномерной скоростью. Чем больше точка удаляется, тем меньше становится видимая скорость ее движения. Эта неравномерность шкалы приводит к тому, что при перспективном преобразовании не сохраняется соотношение длин и площадей в пространстве и в центральной проекции. 2. Параллельные прямые линии в пространстве изображаются в центральной проекции прямыми линиями, сходящимися в одной точке, так называемой точке схода. Если эти линии параллельны горизонтальной плоскости, то их точка схода располагается на линии горизонта. Если они параллельны наклонной восходящей плоскости, то точка их схода располагается выше линии горизонта. Если же они параллельны наклонной нисходящей плоскости, то их точка схода располагается ниже линии горизонта. Исключением из этого правила является случай, когда прямые линии в пространстве параллельны плоскости, на которую они проецируются. При этом на изображении эти линии также остаются параллельными и не имеют точки схода, а шкала проекции остается равномерной. Продолжая рассмотрение, выберем правостороннюю систему координат и обратимся к рис. 1, на котором показана так называемая модель камеры с передней плоскостью изображения. Рассмотрим центральную проекцию двух простейших объектов, изображенных на этом рисунке линий и, на плоскость, при этом координатную ось декартовой системы координат совместим с осью камеры, а оси и с плоскостью изображения. На рисунке использованы следующие обозначения длина линий, одинаковая для обеих линий расстояние между линией и центром объектива расстояние между линией и центром объектива фокусное расстояние объектива расстояние между линиями и длина проекции линии на переднюю плоскость изображения плоскость проецирования длина проекции линии . Из подобия треугольников и -0 следует, что 1 а из подобия треугольников и -0 следует, что 2 В общем случае длина проекции линии протяженностью, которая параллельна плоскости проецирования независимо от ее углового положения по отношению к координатным осям, и удалена от центра объектива на расстояние, равна 3 где можно рассматривать как масштабирующий множитель. Отсюда следует, что любая точка объекта с координатами, отобразится на центральной проекции точкой с координатами, 4 Из формулы 3, в частности, следует, что при длина проекции линии равна длине самой проецируемой линии. Решая совместно уравнения 1 и 2, найдем расстояние по глубине между двумя линиями и 5 Рассмотрев основные аспекты перспективного преобразования прямых линий, можно перейти к перспективным преобразованиям плоского прямоугольника. Рассмотрим теперь задачу определения истинных размеров одного из простейших объектов, которым является плоский прямоугольник, по его центральной проекции. Будем считать, что две его стороны вертикальны и, следовательно, параллельны плоскости проекции, которая перпендикулярна горизонтальной плоскости, а плоскость, в которой он лежит, повернута на некоторый угол относительно направления главного луча. В этом случае проекция прямоугольника будет иметь вид трапеции, поскольку размер проекции удаленной стороны вследствие перспективных искажений будет меньше размера ближайшей стороны. Примем также, что нам известны фокусное расстояние объектива, использованного при фотографировании, расстояние, с которого производилось фотографирование, а также размеры проекций ближайшей и удаленной сторон, соответственно и, которые определяются по изображению. Переходя к определению размеров прямоугольника, найдем размер его вертикальных сторон, что следует из формулы 1. Для определения размера его горизонтальных сторон, который обозначим, найдем вначале расстояние по глубине между этими сторонами по формуле 5. Поскольку плоскость прямоугольника составляет с главным лучом угол, то глубина представляет собой размер проекции его ширины на вертикальную плоскость, в которой лежит главный луч. Отсюда следует, что 6 Опуская вследствие громоздкости вычислений рассмотрение случая, когда проецируемой фигурой является плоский многоугольник, стороны которого не обязательно параллельны плоскости, на которую он проецируется, отметим лишь, что методика анализа и в этом случае полностью сохраняется. Рассмотренный случай, несмотря на свою простоту, важен при решении ряда практических задач, поскольку на практике часто встречаются объекты, оболочки которых могут быть аппроксимированы плоскостями прямоугольной формы. К таким объектам относятся наружные стены зданий, стены интерьеров, предметы мебели, а также ряд других объектов. Пояснение метода проведем на примере несложного объекта, представляющего собой два соединенных прямоугольных рекламных щита рис. 2, . Будем считать, что вертикальные линии прямоугольных щитов параллельны плоскости проецирования, а расстояние между ближайшей точкой объекта, т. е. местом, где щиты соединяются, и центром объектива с фокусным расстоянием равно . Суть метода заключается в следующем. 1. Вначале выполняется декомпозиция изображения объекта на две аппроксимирующие плоскости рис. 2, . 2. Далее для каждой из аппроксимирующих плоскостей производится пересчет от перспективной проекции к аксонометрической проекции. Для пояснения того, как это делается, обратимся к рис. 3, на котором показана центральная проекция правой плоскости щита, изображенного на рис. 2, . Из рис. 3 видно, что размер центральной проекции дальней вертикальной границы прямоугольного щита меньше размера центральной проекции его ближней вертикальной границы . Величина этого изменения составляет . В такой же мере имеет место уменьшение и горизонтального размера центральной проекции прямоугольного щита, хотя это сразу и не бросается в глаза. Из рис. 3 также следует, что коэффициент изменения координат линейно изменяется с изменением координаты проекции, поскольку уменьшению соответствует уменьшение расстояния между рассматриваемой точкой и центром объектива, т. е. 7 Поэтому при определении координат аксонометрической проекции каждой точки объекта на переднюю плоскость изображения и необходимо это учесть следующим образом 8 В результате этих расчетов находится аксонометрическая проекция объекта в масштабе, который определяется масштабирующим множителем . Координаты и произвольных точек объекта находятся путем деления координат и на масштабирующий множитель . Полученные таким образом аксонометрические проекции каждой из аппроксимирующих плоскостей представлены на рис. 2, . 3. Затем определяется расстояние по глубине между вертикальными линиями, ограничивающими прямоугольные аппроксимирующие плоскости, по формуле 5. Другими словами, определяется расстояние по глубине между двумя плоскостями, параллельными передней плоскости изображения, в которых лежат эти линии. 4. После этого необходимо определить координату глубины для каждой точки аппроксимирующей плоскости, т. е. рассчитать карту глубины. С этой целью вначале методом линейной интерполяции находятся координаты глубины вдоль прямых линий, соединяющих вершины аппроксимирующих плоскостей, для которых координаты глубины известны в рассматриваемом примере, поскольку плоскости вертикальны, для всех точек вертикальных линий координата глубины будет неизменной. Линейная интерполяция оказывается возможной, поскольку в аксонометрической проекции шкала дальности, в отличие от шкалы дальности центральной проекции, равномерная. 5. Далее методом линейной интерполяции вычисляются координаты глубины для всех точек пикселей аппроксимирующей плоскости и таким образом формируются карты глубины каждой из двух аппроксимирующих плоскостей рис. 2, . На картах глубины более светлый тон соответствует точкам, находящимся ближе к центру объектива, а более темный точкам, расположенным дальше. 6. И, наконец, завершающим шагом описываемого метода является сборка объекта путем объединения аппроксимирующих его плоскостей. В зависимости от сложности и количества объектов, изображенных на фотографии, может потребоваться большее число аппроксимирующих плоскостей, чем в рассмотренном примере рис. 4, . Найденные аксонометрическая проекция объекта и карта глубины содержат всю информацию о 3D-объекта и позволяют выводить его изображение на экран дисплея для рассматривания при различных ракурсах и с различных расстояний. Для получения полного 3Dизображения объекта, а не только видимой его части, как и в случае традиционных 3D-сканеров, возникает необходимость в склейках частей 3D-изображений, полученных при различных ракурсах съемки. Обусловлено это тем, что ни один непрозрачный физический объект невозможно одновременно видеть со всех сторон. Представление 3D-изображения в виде аксонометрической проекции и карты глубины, так называемый 2DZ-формат, применяют в 3D-телевидении точнее, в стереоскопическом телевидении. Этот формат может быть преобразован в другие форматы 3D-изображений. Покажем теперь, как, располагая аксонометрической проекцией объекта и картой глубины, вывести на экран дисплея центральную проекцию объекта при заданном ракурсе и расстоянии наблюдения. Задача заключается в определении координат каждой точки формируемого изображения 3D-объекта, соответствующего новому ракурсу наблюдения этого объекта и новому расстоянию, с которого он наблюдается. Будем считать известными расстояние, с которого была произведена съемка, и фокусное расстояние объектива . Решая задачу, вначале находим координаты объекта, затем осуществляем поворот объекта на заданные углы и, наконец, находим центральную проекцию объекта, видимого с заданного расстояния наблюдения. и Как уже было отмечено, декартовы координаты произвольной точки объекта, соответствующие его исходному положению, находятся путем деления координат и на масштабирующий множитель, т. е. 9 Что касается координаты глубины произвольной точки объекта, то она полностью определяется его картой глубины., и Поворот объекта вокруг оси в рассматриваемом случае интереса не представляет, так как его вращение в плоскости проекции не приводит к изменению ракурса наблюдения. Возьмем точку на поверхности объекта с координатами, повернем объект сначала на угол вокруг оси и найдем его новые координаты, 10 Допустимое значение угла ограничивается значениями, при которых изображение повернутого 3D-объекта еще не включает в себя тех фрагментов, которые при его фотографировании были заслонены самим объектом. Далее, возьмем эту же точку на поверхности объекта после его поворота по азимуту на угол вокруг оси и найдем ее новые координаты, после поворота объекта вокруг оси на угол места 11 Подставив значения, из формулы 10 в формулу 11, получим 12, и . Согласно формуле 4, между искомыми координатами центральной проекции объекта и соответствующими координатами объекта имеют место соотношения 13 где расстояние от центра объектива до точки объекта, координаты которой рассчитываются. Это расстояние равно сумме расстояний расстояния между центром объектива и ближайшей к камере точкой объекта и расстояния от ближайшей точки к центру объектива до рассматриваемой точки, которое определяется из карты глубины, т. е. . С учетом изложенного имеем 14 Проекции 3D-изображений см. рис. 4, полученные описанной выше обработкой 2D-изображений, показаны на рис. 5. Описанный метод может найти свое применение в тех случаях, когда требуется, используя цифровую камеру, получать 3D-изображения отдельных объектов и целых сцен, которые допускают аппроксимацию плоскостями. Это может быть актуальным, если принять во внимание, что стоимость лазерного 3D-сканера, используемого для этой цели, в сотни раз превышает стоимость недорогой цифровой камеры. Поскольку в результате применения описанного выше метода из 2D-изображений формируются 3D-изображения, то не составляет труда сделать следующий шаг и из 3D-изображений получать их стереопары. Опуская вследствие ограниченности объема статьи рассмотрение метода формирования стереопары из 3D-изображения, приведем в качестве иллюстрации лишь сами полученные в процессе выполнения данной работы стереоскопические изображения. На сайте 9 показаны анаглифные изображения, сформированные в конечном итоге из 2D-изображений, которые приведены в тексте настоящей статьи. Анаглифный метод представления стереоскопических изображений для данной демонстрации выбран по причине его доступности. Напомним, что для рассматривания такого рода стереоскопических изображений требуются анаглифные очки, которые в настоящее время чрезвычайно широко распространены и недороги. Описанный в статье метод может быть также использован как элемент алгоритма, предназначенного для реализации функции преобразования 2D-изображений в стереоскопические изображения, которую начинают применять в современных телевизорах 10. 