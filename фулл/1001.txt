ВОССТАНОВЛЕНИЕ ДВУМЕРНЫХ ИЗОБРАЖЕНИЙ  С ДЕФЕКТАМИ 

Рассматривается задача обработки и восстановления изображений типа графический орнамент. Предложен  новый подход, который заключается в комбинировании известных математических алгоритмов для достижения  бóльших надежности и вычислительной экономичности алгоритма восстановления. Метод проходил тестирование и был оптимизирован для анализа и последующего восстановления исторических орнаментов, составленных главным образом из геометрических мотивов. Ключевые слова  — обработка изображений, вейвлет-анализ, фрактальный анализ. 

Проблема восстановления изображений с дефектами актуальна при исследовании поврежденных исторических орнаментов на основе статистических данных и информации, полученной из уцелевших фрагментов. Разработано большое количество методов распознавания и восстановления изображений, основанных на учете их семантической структуры 1, 2. К сожалению, подобные методы не адаптированы к восстановлению и классификации исторических орнаментов. Традиционно подобная задача решается специалистом в данной области, однако до сих пор не было разработано эффективного алгоритма для автоматизации решения данной проблемы. Поиску, разработке и внедрению такого алгоритма и посвящена данная работа. Дословный перевод с латинского слова орнамент украшение. В специальной литературе орнамент означает узор, состоящий из ритмически упорядоченных элементов для украшения какихлибо предметов или архитектурных сооружений. Исторически сложилось так, что человек заметил пользу в работе упорядочивающего начала, позволяющего тратить меньше сил, делать нарядным, праздничным быт, в результате чего появилось понятие ритм. Люди стали передавать свои зрительные впечатления в виде изображений узоров, орнаментов. Для создания элементов орнамента человек выбирал силуэты птиц, рыб, животных, самого себя, растений. Но ритмическая основа орнамента всегда оставалась, а содержание менялось вместе с условиями жизни. Кроме натурных изображений стали использоваться украшения неизобразительного характера, способные вызывать у человека радость, печаль, создавать ощущение покоя. Позже появилось понимание стиля в смысле единого художественного оформления здания, вещей, предметов, окружающих человека. Стиль как образная система основан на единстве идейного содержания, порождающего единство всех элементов художественной формы, всех художественно-выразительных средств. В буквальном смысле слово стиль обозначает то видимое, ощутимое своеобразие, которое, прежде всего, бросается в глаза и является отличительным признаком художественного произведения. Понятие это бесконечно многообразно. Различают стиль одного произведения, целого ансамбля, индивидуальный, авторский стиль. Можно говорить о стиле отдельных стран, народов, художественных направлений, например, русский, китайский, строгий, суровый, исторический, романский, готический, модерн, ретро и др. Элемент орнамента, многократно повторяющийся, называют раппортом. Раппорт повторяющаяся часть узора. Мотив простейшая динамическая смысловая символическая единица орнамента. Кроме того, это слово имеет другое значение материал для создания сюжета раппорта. Источником для создания орнамента служат реальный мир, природа, мифология, народный эпос или же используются строгие геометрические фигуры, геометрические построения, письмена, шрифт. В ходе развития орнаментального искусства четко выделились типы орнаментов. Лента, или ленточный орнамент, пожалуй, наиболее многочисленный подвид орнаментов. Он применяется при оформлении зданий, предметов, вещей в качестве бордюра, фриза, каймы, тесьмы, обрамления и др. Один из самых древних, распространенных и богатых вариантами видов ленточного орнамента меандр. В данной работе наиболее тщательно исследуются такие раппорты орнаментов, как крест и лента линия. Для технической реализации решения предложенной задачи в данной работе был использован пакет MatLab 35. Выбор этой среды разработки был обусловлен следующими факторами 1 оптимизация языка MatLab для технических вычислений и обработки изображений 2 наличие большого количества готовых программных решений в языке MatLab 3 наличие обширной документации по языку MatLab как предложенной разработчиками, так и сторонней 4 высокая производительность при должной оптимизации программы на языке MatLab. Алгоритм регенерации орнаментов включает в себя следующие шаги. 1. Считывание данных из файла и команд пользователя посредством графического интерфейса пользователя. 2. Удаление областей повреждения. 3. Конвертирование исходного изображения в бинарное. 4. Разбиение изображения на мотивы. 5. Нахождение дочерне-родительских связей между мотивами. 6. Нахождение одинаковых мотивов. 7. Нахождение углов поворота одинаковых мотивов относительно друг друга. 8. Нахождение композиционных фигур на изображении композиционный анализ. 9. Регенерация композиционных фигур. 10. Синтез композиционных фигур на основе имеющихся. Шаги 36 при этом условно названы графическим анализом. Алгоритм не производит анализа указанных пользователем поврежденных областей. Данные об их границах хранятся в программе для последующего использования, а поврежденная область на данном этапе заполняется белым если изображение требуется инвертировать либо черным в противном случае фоном. Графический и композиционный анализ исходного изображения целесообразно производить на бинарном изображении, без учета его цветности и насыщенности. Для приведения к бинарному виду над изображением выполняются следующие действия. 1. Приведение исходного цветного изображения к формату оттенки серого путем игнорирования оттенка и насыщенности пиксела с сохранением его яркости . 2. Нахождение порогового значения границы черноебелое по методу Оцу по умолчанию либо получение желаемой пользователем границы посредством интерфейса. 3. Приведение изображения в формате оттенки серого к бинарному формату при использовании найденного порогового значения. 4. Инвертирование изображения. Здесь и далее в работе белые единичные фрагменты бинарного изображения будут называться узором орнамента, а черные нулевые фрагменты его фоном. Как графический, так и композиционный анализ и последующий синтез изображения осуществляются при наличии черного фона 0 в бинарной матрице и белого узора орнамента 1 в бинарной матрице. Поскольку статистика по орнаментам показывает, что в подавляющем большинстве случаев анализировать требуется орнамент, построенный при помощи темного узора на светлом фоне, полученное бинарное изображение требуется инвертировать. Это является настройкой по умолчанию, которую пользователь может изменить. Мотивом называется фрагмент изображения, который изолирован либо имеет незначительное количество точек соприкосновения с прочим узором орнамента. Алгоритм восстановления орнаментов, рассматриваемый в данной статье, построен на следующих важных свойствах мотива 1 мотив визуально изолируется наблюдателем-человеком 2 мотив может состоять из других мотивов, по отношению к нему называемых дочерними 3 в изображении может содержаться множество одинаковых мотивов. Мотив А считается одинаковым по отношению к мотиву В, если его можно получить из мотива В путем применения к последнему таких аффинных преобразований, как поворот и зеркальное отражение 4 как правило, орнамент состоит из одинаковых мотивов, объединенных в композиционные фигуры. Для разбиения орнамента на мотивы используется следующий итеративный алгоритм. 1. Если это не первая итерация алгоритма, над изображением производится шаг приближения к узловым опорным точкам скелета изображения. 2. Над изображением проводится операция разбиения. 3. Находятся полностью изолированные фрагменты узора мотивы. 4. Если это не первая итерация алгоритма, найденные мотивы восстанавливаются до первоначальных значений. 5. Мотивы, площадь которых меньше заданной константы, считаются незначительными возможно, артефактами изображения и не принимаются в расчет при дальнейших исчислениях. Площадью мотива здесь и далее называется количество его единичных элементов. 6. Если данный мотив не был учтен на предыдущей итерации, добавляем его в список найденных мотивов. 7. Инкремент счетчика итераций и возврат к шагу 1. Количество итераций данного алгоритма задается пользователем по умолчанию равно трем и определяет степень глубину разбиения мотивов на более мелкие. Обращаем также ваше внимание на то, что некоторые найденные мотивы являются дочерними мотивами других. Скелетом бинарного изображения называется изображение, полученное из исходного путем итеративного обнуления границ узора, но таким образом, чтобы ранее цельные объекты оставались цельными. Ширина итоговых объектов составляет 1 пиксель. Узловыми точками скелета называются единичные точки, находящиеся на пересечении линий скелета. Например, показанному на следующей матрице скелету соответствует следующая узловая точка Процесс приведения изображения к его узловым точкам итеративный. В настоящей работе используется только несколько как правило, 3 его итераций, для того чтобы разделить орнамент на изначально соединенные между собой мотивы. Поскольку в результате разделения мотивов они искажены относительно оригинальных, так как их площадь уменьшена, требуется восстановить мотивы до оригинальных размеров. Следовательно, те граничные контурные точки узора, которые были обнулены, должны быть отнесены к тому или иному мотиву. Для этого выполняются следующие действия. 1. Создается нулевая бинарная матрица тех же размеров, что и исходное изображение. 2. На нее помещаются найденные искаженные мотивы, причем элементы каждого из помещенных мотивов равны порядковому номеру мотива, начиная с 1. На этом этапе матрица состоит из нулей фон и значений от 1 до количество найденных мотивов. 3. Полученная матрица складывается с исходным, неразделенным на мотивы бинарным изображением. На этом этапе матрица состоит из нулей фон, значений от 2 до 1 искаженные мотивы и единиц пикселы, которые требуется соотнести с тем или иным мотивом. 4. Для каждого единичного элемента полученной матрицы находится ближайший элемент, больший 1. Алгоритм нахождения такого пиксела заключается в поиске такого элемента вокруг исходной точки, с преобразованием и последующим округлением полярных координат и постепенным увеличением радиуса поиска. Алгоритм порождает погрешности ввиду округления и выбора большого шага для угла . Исследования показали, что погрешности на данном этапе вполне допустимы, поскольку задача соотнесения пикселов к мотивам и разделение мотивов как таковое сложно выражаема естественным языком и допускает вариации при формализации. Неоспоримым достоинством метода является его низкая временная ресурсоемкость. 5. Все ненулевые элементы матрицы декрементируются. Полученная матрица идентична исходной по местонахождению узора и фона за исключением найденных артефактов, но содержит разные значения для разных мотивов т. е. на данном этапе они изолированы. Мотив А называется дочерним по отношению к мотиву В, если при покоординатном помещении их обоих на изображение мотив А полностью содержится в мотиве В. На практике используется следующее условие если 95 площади мотива А содержатся на площади мотива В, мотив А является дочерним по отношению к В. Если мотив А является дочерним по отношению к В, а В к С, то А является дочерним по отношению к С транзитивность. Вероятностные коэффициенты здесь и далее были подобраны эмпирическим путем, и в последующих шагах алгоритма восстановления изображений решения будут применяться с возрастающей степенью допущения т. е. с меньшей точностью, однако, как будет показано впоследствии, благодаря историческим статистическим данным это не повлияет на точность восстановления изображения. Мотивы А и В называются одинаковыми, если мотив А может быть получен из мотива В путем таких аффинных преобразований, как поворот и зеркальное отражение. Мотивы, имеющие ту же форму, но разный размер, в данном методе не считаются одинаковыми. Предполагается, что в орнаменте существует несколько множеств одинаковых элементов. На данном этапе требуется определить эти множества и входящие в них элементы. Описанные ниже методы являются во многом эмпирическими как входящие в них константы, так и некоторые условия принятия решения получены опытным путем на реально существующих исторических орнаментах. Справедливо следующее высказывание, определяющее первичный негативный признак сортировки если мотив А является дочерним по отношению к мотиву В, они не могут считаться одинаковыми. Простейшим в программной реализации и наиболее точным методом обнаружения одинаковых мотивов, а также углов их поворота относительно друг друга является метод пошагового поворота мотива А вокруг заданной точки к примеру, центра масс мотива и вычисления корреляционной функции мотивов А и В на каждом шаге. Метод используется в данной работе, однако его существенным недостатком является очень низкая производительность. Для повышения общей производительности метода в алгоритм включены предварительные действия, предназначенные для уменьшения размерности данных. В математической статистике различают ошибки I и II рода. Если мотив принадлежит к множеству А, но отвергнут алгоритмом неверно отвергнут, то это называют ошибкой I рода. Если мотив не принадлежит к множеству А, но принят алгоритмом неверно принят, то это называют ошибкой II рода. Поскольку вышеуказанные шаги снижают размерность данных для алгоритма поворота и вычисления корреляционной функции, который отличается высокой точностью и низкой производительностью, на этом этапе приоритетно снизить ошибку типа I настолько, насколько это возможно, даже допуская при этом рост ошибки II типа. Это обусловливает выбор высоких коэффициентов доверия в описанных ниже методах предварительной сортировки. Ниже описан негативный признак принадлежности мотивов к одному множеству. Справедливо следующее утверждение напомним, площадью бинарного мотива называется количество его единичных пикселов если отношение модуля разности сумм мотивов к среднему арифметическому сумм этих мотивов больше константы, равной 0,2, эти мотивы не являются одинаковыми, т. е. Для дальнейшей сортировки требуется найти большую и малую оси мотива отрезки, отвечающие следующим требованиям большая ось мотива это наибольший возможный отрезок, проходящий через центр масс мотива и соединяющий две точки внешнего контура мотива малая ось мотива это отрезок, перпендикулярный большой оси, проходящий через центр масс мотива и соединяющий две точки внешнего контура мотива. Центром масс мотива называется точка, координаты которой находятся по следующей формуле Дальше будет проведена отдельная сортировка по трем различным методам. Результаты сортировки по каждому из этих методов сохраняются отдельно, и итоговое решение о том, являются ли данные мотивы одинаковыми, будет принято по этим результатам. Мотивы А и В являются одинаковыми по длине, если справедливо следующее неравенство где, соответственно длины больших осей мотивов. Если мотивы равны по длине, на данном этапе также производится определение угла поворота одного мотива относительно другого. Пусть, точки пересечения главной оси мотива А и его внешнего контура 4. Тогда Аналогично найдем tg для мотива В. Тогда угол поворота мотива В относительно мотива А В данном методе проверяется возможность получения трех граничных точек мотива В из трех граничных точек мотива А путем преобразования Гивенса. Граничными точками мотива называются точки пересечения его главной оси с внешним контуром, а также точка пересечения малой оси с внешним контуром в целях уменьшения погрешности берется та точка, которая более удалена от центра масс. Тогда справедливо равенство -координата точек принята за 1, чтобы матрица была обратимой. Тогда, если мотивы А и В являются одинаковыми, матрица имеет вид По формулам легко можно проверить, так ли это. Однако, несмотря на кажущийся высокий потенциал метода, погрешность на практике очень велика. В итоге при реализации метода проверяются только следующие факторы 1 модуль каждого элемента матрицы не должен превышать 2 если он больше 1, элемент в зависимости от знака приравнивается к 1 или 1 2 элементы в позициях 1, 1 и 2, 2 должны быть одного знака 3 элементы в позициях 1, 2 и 2, 1 должны быть разных знаков. Если эти условия выполнены, мотивы считаются одинаковыми по матрице поворота, а угол поворота одного мотива относительно другого вычисляется как среднее арифметическое арккосинуса среднего арифметического элементов 1, 1 и 2, 2 и арксинуса среднего арифметического элементов 1, 2 и 2, 1. Все углы при этом предварительно переводятся в первую четверть, т. е. на практике найденный угол с учетом погрешности В данном методе мотивы сравниваются по пропорции деления большой оси центром масс мотива. Метод обладает относительно высокой точностью, однако в нем не предусмотрено нахождение угла поворота одного мотива относительно другого. Условием равенства мотивов по крестообразному делению является следующее неравенство где, отношения отрезков, на которые центр масс делит большую ось мотива, вычисленные для мотивов А и В. Множеством равенства называется множество мотивов орнамента, которые в ходе выполнения аргумента были признаны одинаковыми. Мотив считается принадлежащим к множеству равенства, если он принадлежит к этому множеству по результатам хотя бы двух из трех описанных выше алгоритмов, а именно метода равенства по длине, метода равенства по матрице поворота и метода равенства по крестообразному делению. Некоторые полученные в результате фильтрации множества равенства показаны на рис. 1. Ошибка типа II на данном этапе не была аннулирована. Следующим шагом является нахождение угла, на который повернут каждый мотив относительно первого мотива в данном множестве равенства, который называется эталонным. Для этого используется следующий алгоритм. Определим возможный диапазон угла поворота. Если для мотива был найден и угол поворота по матрице, и угол поворота по длине, и эти углы находясь в I четверти при необходимости из угла предварительно вычитается отстоят друг от друга больше чем на 40, границами возможного интервала являются эти углы. В противном случае интервал равен среднему арифметическому этих углов или единственному найденному углу 20 . После этого проходим по интервалу с шагом в 5, поворачивая тестируемый мотив вокруг его центра масс и вычисляя корреляционную функцию этого мотива по отношению к тестовому. Шаг выбран достаточно большим из соображений увеличения производительности метода как будет показано далее, эта ошибка будет аннулирована. Корреляционная функция двумерных изображений имеет вид и ее значения находятся в пределах 0 1. После этого интервал проверяется для II четверти, т. е. к верхней и нижней границам интервала прибавляется 90, затем для III и IV четвертей. Если на какой-либо итерации корреляционная функция превышает 0,7, алгоритм прерывается и найденный угол считается истинным. Если максимальное найденное значение корреляционной функции не превышает 0,3, мотив исключается из множества равенства. Мотивы, повернутые на найденный угол, показаны на рис. 2. Следующим шагом является композиционный анализ, т. е. изучение взаимного расположения мотивов на изображении. Исследование орнаментов показало, что наиболее часто встречающимися в той или иной вариации композиционными фигурами орнаментов являются линия и крест. Линией в данной работе также является такая статистически частая композиционная фигура, как меандр. Крестом в данной работе называется такое расположение четырех мотивов, при котором мотивы повернуты на соответственно 90, 180, 270 относительно четвертого, эталонного мотива, а центры масс мотивов удалены от центра масс эталона на, соответственно, пикселов. Линией в данной работе называется такое расположение мотивов, при котором центры масс мотивов лежат на прямой, а расстояние между центрами мотивов равно константе. Статистический анализ орнаментов показал, что крест очень частая геометрическая фигура, и если в ходе предыдущих шагов алгоритма были найдены мотивы, даже с большой погрешностью удовлетворяющие описанным выше условиям креста, целесообразно проверить данную гипотезу. На данном этапе проводится и восстановление неполных крестов. Алгоритм поиска и восстановления следующий. Для каждого мотива, входящего в какое-либо множество равенства, в том же множестве равенства ищутся мотивы, угол поворота которых относительно этого мотива равен соответственно 90, 180 и 270 . Если найдено хотя бы два таких мотива из трех, то производится проверка расстояния между центрами масс эталонного мотива и найденных. Статистический анализ орнаментов показал, что 1 линии составлены из более мелких мотивов, нежели кресты это приводит к возрастанию погрешности 2 составляющие линию элементы не повернуты относительно эталонного. Ввиду этих факторов в данной работе при поиске линии не учитываются углы поворота мотивов. Если в ходе композиционного анализа было установлено, куда следует помещать эталонный элемент и какие предварительные преобразования над ним следует проделывать, его размещение не составляет труда. Требуется переместить пикселы цветного изображения координаты которых совпадают с координатами перемещаемого мотива на указанную позицию. Единственным предварительным действием является проверка чередования цветности. Как правило, элементы, входящие в композиционную группу крест или линия, либо имеют ту же цветность, либо их цветовые параметры совпадают для накрест лежащих элементов для креста или чередуются через один для линии. При проверке цветности отдельно сравнивается среднее значение красного для всего мотива, среднее значение зеленого и синего. Если эти значения для двух разных мотивов отличаются не более чем на 50 при максимуме в 255, цветность этих мотивов считается одинаковой. Если чередование цветности для композиционной фигуры установлено, при ее восстановлении может использоваться не эталонный мотив, а смежный с ним для креста или ближайший к нему для линии. Полное восстановление композиционной фигуры возможно в том случае, если та же фигура, состоящая из тех же мотивов, встречается на орнаменте неоднократно, и одна из них не пострадала или была полностью восстановлена описанными выше методами, а вторая сохранилась хотя бы частично. Формальное описание условия звучит следующим образом если существует полностью восстановленная композиционная фигура и существует мотив, входящий в то же множество равенства, что и мотивы данной фигуры, но не входящий в фигуру, то целесообразно проверить, не является ли этот мотив частью такой же фигуры, утраченной в результате дефекта. Проверка данной гипотезы происходит по тому же принципу, что и восстановление композиционной фигуры по количеству пикселов, которые в результате переноса фигуры попали на фон, а не на узор и поврежденные области. Данный метод является простым в разработке, нетребовательным к производительности, точным и позволяет восстанавливать значительные части орнамента. Значительная часть разработанных и рассмотренных в данной статье алгоритмов имеет сложность, поскольку алгоритмы сравнения мотивов по тому или иному признаку содержат два вложенных цикла. Для оптимизации были приняты следующие меры 1 все возможные метаданные, необходимые для сравнения мотивов, для каждого из мотивов вычисляются однократно и при выполнении сравнения хранятся в оперативной памяти 2 память своевременно освобождается, когда метаданные становятся не нужны. Это привело к появлению алгоритмов сложности с большим количеством флопов на каждой итерации и алгоритмов сравнения сложности с минимально возможным количеством флопов. Алгоритмом сложности со значительным количеством флопов является только алгоритм определения угла поворота для его оптимизации размерность данных была сокращена. Хранение дополнительных данных не приводит к снижению производительности, так как разработанный алгоритм обладает высокой временной сложностью, но объемы данных, с которыми он работает, достаточно малы хотя пространственная сложность также достаточно высока. Поскольку после обработки единичного орнамента память освобождается, объем оперативного запоминающего устройства не является сдерживающим фактором данного алгоритма. Целью проводимой оптимизации было снижение требуемого процессорного времени, в том числе, как было показано, и за счет снижения точности промежуточных данных, не влияющей на точность результата. Для идентификации и восстановления изображений были использованы следующие известные методы повышениеснижение яркости, повышениеснижение контрастности, негатив, бинаризация, аффинные преобразования, масштабирование, сглаживающий фильтр, медианный фильтр, дискретное преобразование Фурье, методы выделения границ метод Робертса, метод Лапласа, метод Уоллеса, метод Собела, метод Кирша, статистический метод, корреляционный и регрессионный анализы. Проведенные исследования показали, что применения классических методов не позволяют с надлежащим качеством решить поставленную задачу. Основным препятствием является наличие паразитных шумов и дефектов изображений, которые могут быть удалены методами обработки изображений, основанных на применении вейвлет и фрактальной фильтрации, совмещаемой с логико-вероятностным анализом результатов. Эффективность алгоритма во многом зависит от характера орнамента, расположения поврежденных областей, а также от качества предложенного изображения. Для случаев простых геометрических орнаментов, характерных для культур Ближнего и Дальнего Востока для работы с которыми и был оптимизирован данный алгоритм, площадь поврежденных и впоследствии восстановленных сегментов в среднем должна достигать 4050 общей площади изображения. 