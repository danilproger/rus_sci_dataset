АЛГОРИТМ ПЛОТНОЙ СТЕРЕОРЕКОНСТРУКЦИИ НА ОСНОВЕ КОНТРОЛЬНЫХ ТОЧЕК И РАЗМЕТКИ ПЛОСКОСТЯМИ 

Предлагается новый алгоритм плотной стереореконструкции по паре изображений. Алгоритм отталкивается от предложенной в одной из современных работ идеи агрегации стоимостей в каждой точке не по локальной окрестности, а по минимальному покрывающему дереву, охватывающему все пиксели изображения. При этом ключевой особенностью предложенного алгоритма является переход из пространства диспаритетов в пространство плоскостей: решение в каждом пикселе выводится из уравнения присвоенной ему плоскости. В статье также предлагается способ вычисления набора плоскостей, которыми будет аппроксимироваться трехмерная сцена, на основе контрольных точек. Контрольные точки, получаемые путем сопоставления изображений, используются и для регуляризации решения. Приводятся результаты тестирования предложенного алгоритма на современном, опубликованном в 2012 году тестовом наборе, содержащем 194 пары изображений наземной городской съемки. Кроме того, обсуждаются возможные пути дальнейшего развития метода.

 Плотная стереореконструкция по паре изображений, или бинокулярное стерео, является одной из классических задач компьютерного зрения. Ее можно сформулировать следующим образом имея два ректифицированных изображения, найти карту диспаритета, кодирующую смещение каждого пикселя левого изображения вдоль соответствующей строки. Подробное описание и систематизация задачи даны в работе 1. При известной стереобазе и фокусном расстоянии диспаритет точки однозначно пересчитывается в глубину, то есть в удаленность точки от плоскости изображения в трехмерном пространстве. Таким образом, по карте диспаритета можно восстановить трехмерную структуру сцены. Являясь, как правило, составной частью более общей задачи плотной стереореконструкции по набору изображений, бинокулярное стерео находит свое применение в таких областях, как трехмерная реконструкция городов по данным наземной и аэрофотосъемки, создание трехмерного видео, навигация роботов и во многих других. Существующие подходы Все известные алгоритмы бинокулярного стерео можно разбить на две большие группы локальные и глобальные. В первую входят методы, использующие для вычисления диспаритета в каждой точке информацию лишь с части пикселей изображения, как правило, из окрестности данной точки. Более сложные алгоритмы, например 2 и 3, используют окна с адаптивными весами или адаптивной структурой. Большинство локальных методов отличаются высокой вычислительной эффективностью, однако качество их работы в среднем хуже, чем у глобальных алгоритмов. Некоторые алгоритмы сопоставимы с глобальными методами и по качеству, и по времени работы. Глобальные методы используют информацию со всех пикселей изображения при вычислении решения в каждой точке. Часто решение формулируется в терминах минимизации энергии на графе, вершины которого соответствуют пикселям изображения. Энергия состоит из унарного потенциала, отвечающего за согласованность решения по яркости, и парного потенциала, контролирующего гладкость решения. Подобные алгоритмы различаются структурой графа, видом унарного и парного потенциалов и методом минимизации энергии. Примерами могут служить методы, описанные в работах 4 и 5. Как правило, результат глобальных алгоритмов превосходит результат локальных, однако время их работы в среднем больше. Приобретают популярность методы, пытающиеся совместить сильные стороны локальных и глобальных алгоритмов. Решение в каждом пикселе принимается независимо, однако влияние на него оказывают либо все остальные пиксели изображения, либо часть пикселей, не ограниченных локальной окрестностью данной точки. К числу подобных методов относятся алгоритмы, использующие общую идею поиска оптимального решения в каждом пикселе путем применения динамического программирования на дереве 6, 7. К данной группе относится и подход 8, рассматриваемый в данной работе как базовый, поскольку от него отталкивается предлагаемый алгоритм. Алгоритм 8 использует понятие минимального покрывающего дерева. Пусть G некоторый граф с заданными на нем весами ребер. Минимальным покрывающим деревом для графа G называется такое дерево, которое включает в себя все вершины графа и сумма весов ребер которого минимальна. Для вычисления минимального покрывающего дерева известны эффективные алгоритмы, например 9. Идея алгоритма 8 заключается в агрегации стоимостей присвоения пикселю того или иного диспаритета не по окну, как принято в локальных алгоритмах, а по дереву, покрывающему все изображение. Расстояние D между двумя произвольными пикселями p и q определяется как сумма весов вдоль кратчайшего пути между соответствующими вершинами дерева. Выражение для агрегированной стоимости присвоения диспаритета d пикселю p имеет вид, где C штраф за диспаритет d в точке q параметр алгоритма, влияющий на гладкость решения. В качестве решения в каждом пикселе выбирается значение, дающее наименьшую агрегированную стоимость. Достоинством базового метода является высокая вычислительная эффективность, сопоставимая с эффективностью простейших локальных алгоритмов. В работе 8 предложен быстрый способ вычисления агрегированных стоимостей в каждом пикселе изображения, требующий лишь два прохода по дереву. Однако недостатком алгоритма является голосование одновременно всех точек изображения за один и тот же диспаритет. Точки, между которыми существует путь в дереве без сильных перепадов яркости, оказывают сильное влияние друг на друга, и алгоритм способствует присвоению одинаковых значений диспаритета таким точкам. Другими словами, алгоритм поощряет наличие фронтально-параллельных плоскостей в итоговом решении. На практике такой подход зачастую оказывается некорректным, в первую очередь, когда в сцене присутствует значительное число наклонных плоских областей. Такая ситуация характерна, например, для сцен антропогенной природы. Предложенный алгоритм Рассмотрим алгоритм, основывающийся на вычислительно эффективном подходе базового метода, но лишенный указанного выше недостатка. Решение ищется не в пространстве диспаритетов, а в пространстве плоскостей. Набор плоскостей, присутствующих в сцене, вычисляется по контрольным точкам разреженным точкам, для которых с высокой степенью уверенности известно правильное значение диспаритета. Контрольные точки используются также для регуляризации решения. Представление решения в виде разметки плоскостями. Такое представление уже встречалось ранее 10. Пусть F некоторый набор плоскостей, тогда выражение для агрегированной стоимости отнесения пикселя p к плоскости fF можно записать следующим образом Вычисление набора плоскостей. Одна из ключевых проблем, связанных с переходом из пространства диспаритетов в пространство плоскостей, получение набора плоскостей F, из которых будет осуществляться выбор в каждом пикселе. Чтобы решение считалось качественным, этот набор должен быть не слишком большим и содержать все основные плоскости, присутствующие в сцене. Для вычисления набора плоскостей F предлагается использовать контрольные точки, получаемые как результат сопоставления изображений на основе характерных точек. Стоит отметить, что сопоставление изображений зачастую предшествует ректификации снимков, поэтому полученные таким образом контрольные точки можно считать частью входных данных алгоритма. В случае заранее скалиброванной пары камер возможно сопоставление уже ректифицированных снимков. Возможны и альтернативные способы получения контрольных точек. Так, в работе 11 надежными считаются пиксели, для которых три простых алгоритма бинокулярного стерео дали одинаковый результат. В качестве контрольных точек могут использоваться и данные лазерного сканирования, если они доступны. Поэтому задачу вычисления набора плоскостей F можно сформулировать как задачу сегментации облака трехмерных точек на плоскости. Для этого в данной работе применяется жадный алгоритм, состоящий из следующих шагов. 1. Вычисление алгоритмом RANSAC 12 параметров плоскости, поддерживаемой наибольшим числом точек из GCP. Добавление плоскости в множество F. 2. Исключение поддерживающих плоскость точек из множества GCP. 3. Повторение шагов 1 и 2, пока существуют плоскости, поддерживаемые достаточным числом точек. Алгоритм позволяет надежно вычислить основные плоскости сцены. В случае наземной городской съемки плоскости земли и зданий. Однако на поздних итерациях, после исключения большей части точек, возможна сегментация и менее значимых плоскостей. Регуляризация решения при помощи контрольных точек. Наличие контрольных точек можно использовать с целью придания решению дополнительной стабильности и гладкости. Для этого предлагается следующий подход сначала получить регуляризирующее решение D с использованием только контрольных точек, затем посчитать итоговое решение по всем точкам, налагая дополнительный штраф за отклонение от регуляризирующей карты диспаритета. Однако в данном случае преследуется иная цель, нежели улучшение готового решения. Также в силу большей надежности контрольных точек введена квадратичная зависимость штрафа от отклонения диспаритета от правильного значения. Однако алгоритм 11 является глобальным и использует метод разрезов графа для поиска оптимальной разметки по всему изображению. В каждом пикселе выбирается плоскость, для которой стоимость E минимальна. Основные шаги предложенного алгоритма представлены на рисунке 2. Экспериментальная оценка Тестирование предложенного алгоритма проводилось на наборе данных KITTI 13, содержащем 194 пары ректифицированных изображений и эталонные карты диспаритета, полученные путем лазерного сканирования. По сравнению с более популярным на сегодняшний день набором Middlebury 14 тестовый набор KITTI содержит более интересные и более сложные с точки зрения практических задач данные изображения были получены не в лабораторных условиях, а съемкой с автомобиля при проезде по улицам города. При этом характер представленных в наборе сцен позволяет лучше продемонстрировать преимущества предложенного алгоритма. Контрольные точки были получены путем сопоставления ректифицированных изображений с использованием особых точек Харриса 15 и дескрипторов SIFT 16. В таблице представлены средняя ошибка по всей базе, а также минимальная и максимальная ошибки по всем парам изображений для базового и предложенного алгоритмов. В отличие от алгоритма 8 предложенный алгоритм не склонен к сегментации решения на множество фронтально-параллельных плоскостей и обеспечивает значительно более гладкую карту диспаритета. Дальнейшие исследования Главным ограничением предложенного алгоритма является аппроксимация всей сцены множеством плоскостей, что неизбежно порождает ошибки на менее структурированных объектах естественной природы, таких как деревья, а также на неплоских объектах. В последнем случае решить проблему можно было бы за счет расширения алгоритма на различные классы поверхностей. Более общим подходом могли бы стать сегментация сцены на плоские и неплоские участки и применение предложенного алгоритма только к плоским частям сцены. Другим узким местом алгоритма является шаг вычисления набора плоскостей F. Неточная оценка параметров плоскостей, нахождение лишних или, наоборот, пропуск плоскостей, присутствующих в сцене, приведут к ошибкам в карте диспаритета. Одним из способов устранения данного недостатка может стать итерационное применение алгоритма с дополнительным этапом уточнения параметров плоскостей между итерациями подобно тому, как это делается в работе 10. Использование алгоритмов геометрического разбора изображений, например 17, позволило бы получить более точный начальный набор плоскостей. Также возможно дополнение множества контрольных точек другими примитивами, например отрезками, для которых найдены надежные соответствия между двумя изображениями. Наконец, применение более сложных, чем описанный жадный алгоритм, методов сегментации плоскостей в облаке трехмерных точек, например на основе работы 18, тоже может дать улучшение результатов. В заключение следует отметить, что в данной статье рассматривалась задача плотной стереореконструкции по паре изображений. Описан новый алгоритм, определяющий решение в каждой точке как плоскость с наименьшей стоимостью, агрегированной по минимальному покрывающему дереву. Предложены способ инициализации набора плоскостей по множеству контрольных точек, а также способ регуляризации решения путем учета его близости к карте диспаритета, вычисленной только по надежным точкам. Приведена экспериментальная оценка алгоритма на данных из тестового набора KITTI, показано его превосходство над базовым методом и перечислены пути дальнейшего улучшения результатов. 