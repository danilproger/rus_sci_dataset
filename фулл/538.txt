ПРИМЕНЕНИЕ FPGA ДЛЯ УСКОРЕНИЯ РАСЧЕТА  ВОЛНОВОГО ФРОНТА ЦУНАМИ

Рассматривается вопрос ускорения численного расчёта распространения волны цунами от очага до берега   в рамках дифференциальной модели мелкой воды с применением аппаратного ускорения на базе FPGA. Разработана программная архитектура для расчета системы мелкой воды без учёта внешних сил, являющейся эквивалентной используемой в пакете MOST для численного моделирования движения волны цунами по водной акватории.  Численная реализация системы мелкой воды осуществлялась по схеме Мак-Кормака. Точность вычислений  разработанного решателя была проверена сравнением с точным решением, известным в случае плоского наклонного дна. Достигнутая точность не уступает, а местами и превосходит точность известного программного пакета  MOST.  : расчет цунами, ускорение, FPGA, Мак-Кормак, MOST, численные модели.   Работа выполнена в рамках бюджетного проекта 0319-2018-0010 «Исследование и развитие методов и технологий построения интегрированных программно-аппаратных комплексов для задач моделирования и управления динамическими системами обработки и отображения данных» (регистрационный номер: АААА-А17117062110016-4).  

Возможность оценки опасности побережий в случае возникновения цунами до прихода туда волны является востребованной и актуальной задачей для прибрежных регионов, находящихся в зоне риска. Основная проблема служб предупреждения цунами это своевременное оповещение населения и реализация различных эвакуационных сценариев в зависимости от ожидаемой высоты волны в тех местах побережья, где это требуется 1 2. Работа направлена на ускорение численного расчта распространения волны цунами от очага до берега в рамках дифференциальной модели мелкой воды с применением аппаратного ускорения на базе FPGA. Широко известен и применяется подход на основе численного моделирования распространения волны с использованием дифференциальной модели мелкой воды. Наибольшее распространение получили несколько разностных схем, корректно решающих нелинейные уравнения мелкой воды, реализованные в виде алгоритмов пакеты прикладного программного обеспечения MOST, TUNAMI и COMCOT. Численный расчт распространения волны на персональном компьютере в достаточной области порядка 10 миллионов расчтных узлов длится 23 часа 3 . При этом пространственные шаги сетки, покрывающей область такого размера, в которую входят и очаговая область, и береговая линия, не может быть достаточно детальной для корректного моделирования вблизи берега и в бухтах. При использовании в расчтах шага, равного нескольким метрам вместо нескольких сот метров, потребуется на 23 порядка больше вычислительных ресурсов оперативной памяти и времени расчтов, что практически исключает использование персональных компьютеров для получения результата в течение имеющихся в запасе десятков минут. В пакете MOST для численного моделирования движения волны цунами по водной акватории используется следующий эквивалентный вид так называемой системы мелкой воды без учта внешних сил донное трение, сила Кориолиса и т. д. 4 где полная глубина слоя жидкости, глубина возмущенного слоя, профиль глубин, считающийся известным цифровая батиметрия, время, компоненты вектора скорости вдоль осей и соответственно, g ускорение свободного падения. Моделирование происходит в прямоугольной и не меняющейся со временем области, с применением разностных схем прямоугольной сетке, где, шаги сетки по пространственным переменным и, шаг по времени. В данной работе для простоты используется равномерный шаг как по пространственным переменным, так и по времени. Для аппроксимации уравнений мелкой воды используется явная двух шаговая конечноразностная схема второго порядка аппроксимации типа Мак-Кормака 5 6. 1 шаг 2 шаг Вентильные матрицы, программируемые пользователем FPGA для различных задач, используются с 1990-х гг. При этом вначале наибольшее применение нашли вариации программируемых логических матриц PLDCPLD, имеющие энергонезависимую память для хранения конфигурации. PLD успешно применялись для решения небольших задач по разработке автономных устройств и контроллеров, имеющих малое энергопотребление и массагабаритные размеры. Увеличение объема логических элементов и возможность неограниченного перепрограммирования для изменения алгоритмов обработки данных стало возможным при появлении FPGA. Такие FPGA позволяют реализовывать трудоемкие математические алгоритмы обработки данных, а также выполнять прототипирование вычислительных устройств для дальнейшего производства серийных заказных микросхем ASIC. Но до недавнего времени существовало 2 основных препятствия для применения FPGA, связанных с необходимостью ручной реализации алгоритмов с точностью до регистров и триггеров уровень регистровых передач RTL register transfer level 1 трудоемкость реализации программных модулей, требующая значительно больше времени до 2 порядков больше, чем реализация для PC на высокоуровневых языках 2 высокие требования к квалификации разработчика. Создаваемые средства для автоматизации процесса разработки Simulink MatLab, SystemVerilog, SystemC не позволяли производить полноценную разработку алгоритмов на высокоуровневом языке происходило значительное снижение производительности и требования к ресурсам по сравнению с RTL моделью. Современная технология High-Level Synthesis HLS позволяет использовать для описания цифровых схем C-подобный язык 7. Это является новым витком развития способов создания различных вычислительных устройств, обеспечивающих полный цикл от описания архитектуры до верификации проекта с использованием различных средств моделирования. HLS представляет собой автоматизированный процесс проектирования, который интерпретирует алгоритмическое описание поведенческой модели и позволяет создавать цифровые устройства, четко реализующие заданные условия. С помощью HLS можно легко изменять параметры конвейера, подстраиваясь под временные timing или пространственные utilization требования. Также технология HLS позволяет производить верификацию программного кода до его преобразования в схему для конкретной микросхемы FPGA. Именно технология HLS и большие ресурсы современных микросхем FPGA позволяют сегодня применять их для решения новых типов задач в новых областях. Изложенная вычислительная схема была реализована на платформе вентильных матриц программируемых пользователем FPGA. Для реализации алгоритма на FPGA была предложена архитектура поточного вычислителя, состоящая из процессорных элементов ПЭ. ПЭ осуществляет вариант двумерной прогонки конвейера с последовательным потоком данных. Вспомогательными данными для каждого узла, которые необходимо хранить, являются значения всех используемых функций в 4-х соседних узлах. Особенность архитектуры FPGA позволяет использовать внутреннюю память BRAM для организации соответствующего буфера данных и линии задержки, что позволяет реализовать конвейер при количестве памяти до . Математические операции, необходимые для алгоритма Мак-Кормака, реализованы вычислительным конвейером, обеспечивающим производительность обработки одной точки сетки за один такт. Полученное решение позволяет гарантировать производительность с точностью до такта. Блок-схема предложенной архитектура всего спецпроцессора представлена на рисунке см. далее. Помимо самого вычислителя, спецпроцессор имеет контроллеры памяти DDR3, контроллер PCIe, модуль DMA, обеспечивающий взаимодействие вычислителя с памятью компьютера-хоста в режиме прямого доступа. Данные поступают в вычислитель из памяти через FIFO, что позволяет легко варьировать частоту отдельных вычислительных блоков, подстраиваясь под конкретный кристалл FPGA и характеристики внешней памяти и интерфейсов. Сам вычислитель в зависимости от доступных ресурсов FPGA состоит из одного или нескольких процессорных элементов. Спроектированный вычислитель на уровне алгоритмов был протестирован с применением технологий HLS. Модули, обеспечивающие работу всего процессора, протестированы с помощью RTL-симуляторов. Для практической реализации и тестирования были использованы следующие платформы SLEDv7 на базе кристалла семейства Virtex-6 8 VC709 на базе кристалла Virtex-7 . Итоговая производительность и затраты ресурсов зависят не только от количества ПЭ, но также от частоты их работы. В результате тестирования было выяснено, что реализованные конвейеры способны работать на частоте 200 MГц на плате SLEDv7 и до 300 MГц на платах VC709 и KU115. Далее в таблице представлена производительность вычислителя для двух платформ. Замеры представлены для тестовых данных, используемых NOAA 2580 2879 точек, акватория Тихого океана с временным шагом 10 с. В случае платы SLEDv7 использовалась цепочка из 2 ПЭ одинарной точности на частоте 200 MГц. В результате была получена производительность в 52 итерации в секунду, или час модельного времени за 6,84 с. Сравнение производительности вычислителей при использовании разных кристаллов xc6vsx315-1 SLEDv7 xc7vx690-2 VC709 Кол-во ПЭ 2 8 Частота МГц 200 250 Время одного прохода мс 38 31 Время одной итерации мс 19 3,8 Платформа VC709 позволила разместить в себе 8 процессорных элементов на частоте 250 MГц. Итоговая производительность составила 263 итерации в секунду, или час модельного времени за 1,368 с. Для тестирования описанного численного метода и его реализации было проведено сравнение результатов численного решения модельной задачи распространения цунами от круглого источника над наклонным дном с известным точным решением, а также с решением, полученным пакетом MOST 5. Сравнение распределения высот и времен прихода волны показало хорошее их соответствие вне зоны шельфа, т. е. там, где глубина превышает 150 200 м. В целях ускорения расчета распространения волны цунами по глубоководной части океана был спроектирован спецвычислитель на базе архитектуры вентильных матриц программируемых пользователем FPGA. Численная реализация системы мелкой воды осуществлялась по схеме Мак-Кормака. Точность вычислений разработанного решателя была проверена сравнением с точным решением, известным в случае плоского наклонного дна. Достигнутая точность не уступает, а местами и превосходит точность известного программного пакета MOST. Предложенная архитектура поточного вычислителя на базе FPGA основана на процессорных элементах ПЭ для двумерной прогонки конвейера с последовательным потоком данных, что позволяет масштабировать решение для различных кристаллов, получая максимально возможную производительность. Архитектура предложенного ПЭ позволяет одновременно обрабатывать точек входного потока данных, что дает возможность параметризовать ПЭ в зависимости от особенностей используемой вычислительной платформы для получения максимальной производительности. 