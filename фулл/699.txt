АВТОМАТНОЕ ПРОГРАММИРОВАНИЕ ПЛИС   В ЗАДАЧАХ УПРАВЛЕНИЯ ЭЛЕКТРОПРИВОДОМ 

Рассматривается применение автоматного программирования для реализации блоков управления электроприводом, построенных на основе микросхем программируемой логики. Показана эффективность такого подхода. Приведены результаты испытаний блоков. Ключевые слова  — автоматное программирование, конечный автомат, электропривод, программируемые  логические интегральные схемы. 

В системах управления техническими средствами кораблей и судов часто возникает необходимость регулирования положения того или иного исполнительного органа. Для решения таких задач могут использоваться различные типы приводов электромеханический, гидравлический, пневматический и т. д. Каждый из них имеет свои особенности и область применения. В настоящей работе рассматриваются блоки управления электромеханическим приводом на основе специально разработанного для таких электроприводов шагового двигателя ШД. Указанные блоки могут быть построены на основе аналоговых микросхем, цифровых микросхем низкой степени интеграции, цифровых микросхем высокой степени интеграции или микроконтроллеров. Настоящая работа посвящена автоматной реализации блоков управления электроприводом на основе программируемых логических интегральных микросхем ПЛИС. Традиционно их программирование осуществляется с использованием языков описания аппаратуры Verilog, VHDL, а также функциональных схем. Предлагаемый подход отличается тем, что алгоритм управления электроприводом задается в общем случае в виде системы графов переходов конечных автоматов, как это было предложено в работе 1. Текст на языке описания аппаратуры, необходимый для синтеза устройства в САПР производителя микросхем программируемой логики, формируется автоматически средствами пакета MATLAB. Предлагаемый подход является развитием автоматного программирования 2 применительно к программированию аппаратуры. Вопрос о применении автоматов при создании программ управления электроприводом для микроконтроллеров описан в работе 3. Подход состоит из следующих этапов. 1. Создание схемы связей блока управления с объектом управления и системой верхнего уровня. 2. Разработка перечня и описания входных и выходных переменных. 3. Получение алгоритма работы от Заказчика в виде словесного описания и временных диаграмм. 4. Эвристическое проектирование системы графов переходов конечных автоматов. 5. Отображение графов переходов с использованием пакета Stateflow, входящего в состав MATLAB, по методике, изложенной в работе 4. 6. Разработка модели объекта управления средствами MATLAB-Simulink. 7. Комплексное моделирование системы автоматов и объекта управления с получением временных диаграмм работы. 8. Сравнение результатов моделирования с требуемым алгоритмом работы. Если результаты моделирования не удовлетворяют требованиям Заказчика, то необходимо вернуться к этапу проектирования графов переходов. 9. Реализация системы графов переходов, представленных в Stateflow на языке описания аппаратуры Verilog, VHDL, с помощью интерпретатора пакета HDL Coder, входящего в MATLAB. 10. Моделирование полученной программы с использованием САПР производителя ПЛИС или другой системы HDL-моделирования, например ModelSim. 11. Компиляция и последующая загрузка в целевую аппаратуру. При разработке с использованием автоматов отладка либо занимает меньше времени, чем при традиционном подходе, либо она вообще отсутствует, так как автоматы обычно сразу работают в соответствии с требуемым алгоритмом. При этом отметим, что один и тот же автомат может быть использован как для получения исполняемого кода на языках программирования C, так и для получения описания устройства на языках описания аппаратуры, таких как, например, Verilog, VHDL. Применение предлагаемого подхода исключает трудоемкий и обычно приводящий к большому числу ошибок процесс ручного программирования. Структурная схема канала управления электроприводом на основе четырехобмоточного ШД показана на рис. 1. Вторичный источник питания предназначен для формирования напряжения питания внутренних цепей блоков источник для питания силового преобразователя блока источник для питания силового преобразователя блока блок управления для формирования режимов работы электропривода и уставок токов фаз ШД в соответствии с сигналами, поступающими из системы верхнего уровня блок силовых преобразователей для формирования токов фаз ШД в соответствии с уставками, поступающими из блока управления, контроля их достоверности и формирования некоторых режимов работы электропривода в случае отказа блока управления, а блок подхвата для контроля токов, формируемых блоком силовых преобразователей, и подхвата токов фаз ШД в случае отказа блока . В настоящей работе структура канала управления и блоки типов не рассматриваются. Блок управления рис. 2 содержит два функциональных узла, первый из которых узел 1 предназначен для формирования режимов работы электропривода и уставок токов фаз, а второй узел 1 для контроля исправности блока управления и блока силовых преобразователей. Для этого используется обратная связь по токам фаз ШД. Блок силовых преобразователей содержит три функциональных узла рис. 3. Первый из них узел 2 предназначен для контроля достоверности сигналов, поступающих из блока управления, и формирования некоторых режимов работы электропривода в случае отказа блока управления, второй узел 2 для контроля исправности блока силовых преобразователей и линий связи с ШД, а третий узел для формирования токов фаз ШД и контроля исправности силового преобразователя. Модель фрагмента канала управления, содержащего блоки управления, силовых преобразователей и нагрузку, показана на рис. 4. Модель реализована в среде MATLAB-Simulink с использованием таких его расширений как Power Systems Blockset, Stateflow, HDL Coder. Подсистема на рис. 4 предназначена для моделирования части входных переменных модели блока управления, представленного в виде подсистемы . Подсистема содержит модель блока силовых преобразователей и нагрузку . В качестве выходных переменных на блоки регистрации и выведены следующие переменные и сигналы внутренние переменные блока управления, определяющие направление движения дискретные сигналы на включение фаз и дискретные сигналы обратной связи по току уставки и токи фаз сигналы и индикация неисправности блока силовых преобразователей. Модель подсистемы представлена на рис. 5. Блок предназначен для имитации внутренних аппаратных неисправностей блока управления, например отсутствия вторичного электропитания, неисправности тактового генератора и т. п. Модели поведения узлов УФ1, УК1 реализованы в виде соответственно. Подсистема см. рис. 4 содержит модели поведения узлов УФ2, УК2, выполненные аналогично моделям, а также модель узла . На рис. 6 представлена модель одного из четырех каналов узла УУ. Она содержит модель регулятора тока с широтно-импульсным модулятором ШИМ, модель силового преобразователя, аналоговый коммутатор, блок согласования шага интегрирования и пороговое устройство, предназначенное для реализации дискретной обратной связи по току Подсистема рис. 7 содержит пропорциональный интегральный регулятор тока блок и ШИМ блоки модель датчика тока . Выходными сигналами являются импульсы управления силовыми транзисторными ключами. Модель рис. 8 состоит из модели источника напряжения см. рис. 1 блок модели силового преобразователя и нагрузки . Всего в системе содержится, описывающие поведение узлов УФ1, УК1, УФ2, УК2 соответственно. Машины состояний рис. 9, рис. 10, содержат по два гиперсостояния, а машины узла три гиперсостояния . При этом отметим, что гиперсостояние содержит один вложенный конечный автомат, гиперсостояние четыре вложенных автомата, гиперсостояние четыре вложенных автомата, а гиперсостояния не содержат вложенных автоматов. Таким образом, система состоит из 18 конечных автоматов. Результаты моделирования в одном из режимов представлены на рис. 11. Из их рассмотрения следует, что блоки отработали 12 шагов рабочего органа в прямом направлении, после небольшой паузы один шаг в обратном, пять шагов в прямом, а затем после паузы восемь шагов в обратном и остановились в режиме удержания на фазах 1 и 2. Испытания опытного образца проводились в условиях стенда, блоки были установлены в штатный прибор, использовались штатные источники вторичного электропитания. В качестве нагрузки для модулей был использован штатный электропривод с нагрузочным устройством, обеспечивающим номинальную нагрузку на валу двигателя. Из рассмотрения результатов испытаний рис. 12 следует, что в начальный момент времени модули находились в режиме удержания на фазах 3 и 4, а затем они отрабатывают отдельные шаги с выходом на ток удержания после окончания каждого шага такой режим работы определяется входными сигналами из системы верхнего уровня. Сравнение графиков на рис. 11 и 12 показывает, что результаты моделирования и испытаний практически совпадают. В заключение раздела отметим, что, несмотря на наличие достаточно большого числа автоматов в системе, особых проблем с отладкой не было. Это объясняется такими особенностями структуры автоматной части системы, как иерархичность, параллельность автоматов и состояний, а также вложенностью. В ходе проектирования и испытаний система существенно эволюционировала, начав с шести автоматов. При этом каждое расширение ее функциональности происходило достаточно просто. Поэтому излагаемый подход может быть назван . Применение автоматного программирования по сравнению с традиционным подходом, состоящим в непосредственном программировании на языке описания аппаратуры, является более наглядным, доступным для интуитивного понимания, хорошо документируется, легко модернизируется человеком, который даже не принимал участия в разработке. Процесс программирования ПЛИС с применением автоматов формализован, что облегчает его использование и уменьшает число ошибок. При таком подходе возможно также применение методов формальной верификации программного обеспечения. 