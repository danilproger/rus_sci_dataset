ПРИЛОЖЕНИЕ ДЛЯ АВТОМАТИЗАЦИИ ПРОЦЕССОВ   УСТАНОВКИ И ЗАПУСКА GNU/LINUX-ОКРУЖЕНИЯ   НА УСТРОЙСТВАХ ПОД УПРАВЛЕНИЕМ ANDROID 

Проводится обзор основных функций разработанного программного обеспечения для автоматизации установки GNU/Linux-дистрибутивов и запуска Linux-приложений на устройствах под управлением Android. Даны  примеры его возможного использования, сравнение с аналогами. Описываются принципы работы програм много обеспечения. Приведены оценка производительности и статистика по апробации. Ключевые слова  — мобильные устройства, операционные системы, программное обеспечение, Android,  Linux. 

За последние годы платформа Android получила немалое распространение это мобильные телефоны, планшеты, электронные книги, медиаплееры, игровые приставки, телевизоры, встраиваемые системы. Платформа Android имеет открытый исходный код и построена на ядре Linux, однако не поддерживает запуск приложений других операционных систем. Тем не менее, в ярде Linux заложены механизмы, позволяющие при определенных условиях запускать GNULinux-приложения на устройствах под управлением Android 1. Идея запуска Linux-приложений появилась из-за желания иметь привычный инструментарий для системного администрирования прямо на мобильном устройстве, а существующие аналоги не удовлетворяли всем требованиям. Так появилось приложение Linux Deploy для простой установки и запуска GNULinux-окружения на устройствах под управлением Android. Можно выделить основные задачи, которые были поставлены перед разработкой приложения разработать простой, но эффективный интерфейс для установки, настройки и дальнейшего использования GNULinux-окружения обеспечить параллельную работу Linuxи Android-приложений реализовать весь доступный функционал Linux-приложений мобильных устройств как консольных, так и графических обеспечить поддержку наиболее распространенных Linux-дистрибутивов реализовать различные варианты установки окружения и обеспечить поддержку как старых, так и новых ARM-процессоров. Представленное приложение достаточно спе цифично, однако можно выделить основные направления его возможного применения запуск специализированных приложений на встраиваемых системах, использование в проектах Сделай сам, доступ к инструментарию GNULinux с мобильных устройств для технических специалистов, обучение или развлечение например, была запущена игра Герои 3. В настоящее время наличествуют схожие приложения зарубежных разработчиков, но все они имеют ряд ограничений, достаточно сложны в применении, имеют закрытый исходный код, распространяются платно и не поддерживают русский язык. В табл. 1 приведено сравнение с аналогами по основным характеристикам. Приложение Complete Linux Installer активно развивается, однако все еще не соответствует некоторым необходимым критериям. Принципиальное отличие этого приложения заключается в том, что образ каждого дистрибутива подготавливается вручную и не всегда своевременно обновляется. В то же время Linux Deploy позволяет устанавливать дистрибутив через Интернет из официального репозитория, что дает возможность всегда получать последние версии программного обеспечения. Принцип работы приложения заключается в использовании механизма ядра Linux, называемого chroot. Данный механизм позволяет запускать приложения в изолированном пространстве, корнем которого на уровне файловой системы будет являться выбранный каталог. В корне файловой системы Android располагаются файлы самой платформы и каталоги, в которые ядро Linux проецирует свои компоненты каталоги dev, proc, sys и каталог монтирования карт памяти mnt. Приложение создает собственный каталог datalocallinux, в котором размещает основные команды, сценарии установки Linux и файлы конфигурации каталоги bin, deploy, etc. На рис. 1 показана файловая структура, создаваемая приложением в операционной системе Android. Далее в каталоге mnt создается образ новой GNULinux-системы, устанавливаются необходимые пакеты, а также монтируются системные корневые каталоги dev, proc, sys и mnt. После этого осуществляется вызов команды chroot, с помощью которой запускаются необходимые Linux-приложения внутри подготовленного окружения. Доступ к управлению такими приложениями можно получить из локальной консоли Android либо по сети с использованием протоколов SSH и VNC. Также поддерживается возможность запуска сторонних приложений через сетевой протокол X Window System либо через X-сервер, который выводит изображение напрямую через фрейм-буфер устройства, что позволяет отображать графику без промежуточных слоев типа VNC. Для поддержки каждого дистрибутива разработаны специальные инсталлятор и конфигуратор. В своей работе они используют утилиту BusyBox 2. Инсталлятор занимается загрузкой, распаковкой и установкой пакетов из официального репозитория выбранного дистрибутива. Конфигуратор позволяет автоматически выполнить все необходимые настройки выбранного дистрибутива перед его запуском. Для каждой установки GNULinux-дистрибутива создается отдельный профиль, благодаря чему можно в последующем переключаться между установленными дистрибутивами. Можно выделить основные функции приложения автоматическая установка GNULinuxокружения выбранного дистрибутива одной кнопкой на данный момент поддерживается 7 дистрибутивов автоматическая настройка окружения и перенастройка сторонних образов GNULinux можно использовать образы дистрибутивов, которых нет в списке поддерживаемых, а также использовать rootfs-архивы запуск Linux-приложений внутри выбранного окружения предоставление доступа к приложениям и графической среде GNULinux остановка и полное удаление приложения и GNULinux-системы с Android-устройства не производит необратимых изменений на устройстве. Также следует отметить основные возможности приложения одновременная работа Android и Linuxприложений Linux-приложения работают с максимально возможной скоростью, поскольку приложение не является эмулятором доступ к ресурсам Android из Linuxприложений поддержка дистрибутивов Debian, Ubuntu, Arch Linux, Fedora, openSUSE, Kali Linux, Gentoo поддержка сборок GNULinux с оптимизацией под разные версии ARM процессоров, включая ARMv7 поддержка окружений рабочего стола LXDE, Xfce, GNOME, KDE поддержка установки в файл образ, на раздел карты памяти, в директорию поддержка файловых систем ext2, ext3, ext4 поддержка управления через локальную консоль, SSH, VNC, X Window System включая фрейм-буфер профилирование хранение и управление настройками нескольких дистрибутивов поддержка русского и английского языков интерфейса и локализации дистрибутивов. Интерфейс приложения Linux Deploy показан на рис. 2. Рассмотрим настройки приложения 3. . Параметры каждой установки хранятся в отдельном именованном профиле. Количество профилей не ограничено. Можно свободно переключаться между профилями, работая по очередно с различными дистрибутивами. Профили можно экспортировать и импортировать в виде xml-файлов. Каждый профиль содержит в себе настройки одного дистрибутива. Сюда входит название дистрибутива, версия и архитектура версии ARM. Если посчитать все поддерживаемые дистрибутивы, их версии и архитектуры, то на данный момент Linux Deploy поддерживает 38 различных вариантов установки GNULinux. Далее указывается адрес репозитория в Интернете, откуда будет выполняться установка. Необходимо предварительно выбрать тип установки из поддерживаемых в настоящее время трех вариантов файл, раздел и директория. При установке в файл задается размер файла образа и желаемая файловая система, которая будет создана внутри образа. В этом режиме создается файл образа и монтируется в системе, куда в последующем выполняется установка дистрибутива. При установке на раздел вместо пути к файлу указывается блочное устройство раздел карты памяти. На указанном разделе будет создана файловая система, раздел смонтируется и на него выполнится установка. Директория в качестве типа установки может быть выбрана только в том случае, если она находится на разделе с файловой системой ext2, ext3 или ext4, который смонтирован без опций noexec или nodev. Перед установкой также необходимо указать имя нового пользователя в системе, адрес DNSсервера, язык локализации и окружение рабочего стола. Пароль для пользователя по умолчанию задается changeme. На данный момент поддерживаются следующие окружения рабочего стола XTerm, LXDE, Xfce, GNOME и KDE. Установка может включать одно из перечисленных окружений либо вообще не включать графические компоненты, если это не требуется. Во время установки распаковываются все необходимые пакеты для выбранного окружения и выполняется настройка его запуска. Есть возможность настроить вручную запуск любой другой среды помимо указанных, если это необходимо. На рис. 3 представлен снимок экрана с устройства Android, на котором отображается окружение рабочего стола LXDE, работа с рабочим столом осуществляется через VNC-клиент. Стоит отметить, что большая часть всех параметров может быть оставлена без изменения, что позволяет приложению автоматически выбрать наиболее подходящие. Кроме полной установки можно выполнить переконфигурирование существующего дистрибутива, тем самым адаптировать любой сторонний образ для работы через программу Linux Deploy. Под запуском дистрибутива понимается запуск некоторых приложений и служб внутри chroot-окружения. Запуск и остановка сервисов осуществляются одной кнопкой. Поддерживается запуск SSH-сервера, VNCсервера, X Windows System в режиме клиента либо сервера через фрейм-буфер. Для каждого запускаемого сервиса предусмотрены свои настройки. Также можно осуществлять запуск любых других пользовательских скриптов. Особый интерес представляет возможность запуска графической среды через внешний X-сер вер. В этом случае запуск осуществляется по сети. X-сервер должен быть запущен на компьютере, а изображение с устройства передается на X-сервер. Подобно технологии тонких клиентов, на стороне X-сервера клиенте строится изображение, а само приложение выполняется на устройстве сервере. В отличие от VNC, где изображение передается в виде потока сжатых картинок, здесь передаются отдельные компоненты графического интерфейса, сборка которых осуществляется на стороне X-сервера. Другой интересной возможностью запуска графической среды на устройстве является запуск X-сервера в режиме фрейм-буфера. Данный режим дает указание X-серверу перенаправлять изображение напрямую на видеоустройство, а также использовать прямой доступ к устройствам ввода. В этом случае появляется выигрыш в производительности за счет прямого доступа к аппаратным ресурсам устройства. Однако тут есть обратная сторона. К сожалению, графическая подсистема Android и GNULinux не могут работать одновременно. Чтобы иметь возможность запустить графические приложения GNULinux в этом режиме, Linux Deploy приостанавливает работу Android на время, пока выполняются Linux-приложения. После завершения графического сеанса работа Android корректно возобновляется без необходимости перезагружать устройство. Другим ограничением использования данного режима является проблема совместимости Xorg с аппаратными ресурсами устройства в некоторых случаях. Установку и запуск GNULinux-дистрибутивов с использованием Li nux Deploy можно произвести не только через графический интерфейс, но и из консоли Android, локально или удаленно. Для этого есть специальная команда linuxdeploy, с помощью которой осуществляется полное управление дистрибутивом. Было проведено исследование производительности GNULinux-системы внутри chroot-окружения. В табл. 2 указана скорость чтениязаписи внутри chroot-окружения, а в табл. 3 время установки и занимаемый объем дистрибутива при установке через Linux Deploy. Результаты приведены для Debian 7.0 wheezy armhf на Samsung Galaxy S II i9100. Разработанный инструмент приложение Linux Deploy могут использовать в своей работе системные администраторы, программисты и обычные пользователи, которые хотят расширить функционал платформы Android за счет возможности запуска великого многообразия программного обеспечения GNULinux. Исходные коды приложения опубликованы на github.com httpsgithub.commeefik linuxdeploy, форум с поддержкой от заинтересованных пользователей открыт на сайте 4pda.ru http4pda.ruforumindex. phpshowtopic 378043, а само приложение можно установить из Google Play. На данный момент можно привести следующую статистику более 50 000 установок в Google Play 10 000 активных пользователей 91 положительных отзывов 450 отзывов, средняя оценка 4,6 работоспособность подтверждена на более чем 100 устройствах более 25 000 просмотров демонстрационного ролика 830 ч суммарного просмотра заинтересованность проектом и публикация материалов на популярных интернет-порталах habrahabr.ru, 4pda.ru, linux.org.ru, opennet. ru, xda-developers.com и другие пользователями приложения. 