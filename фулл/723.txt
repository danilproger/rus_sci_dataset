ПАРАМЕТРИЗАЦИЯ КОНСТРУКТОРСКИХ ЧЕРТЕЖЕЙ 

Рассмотрены проблемы создания параметрических моделей конструкторских объектов. Изложены особенности функционирования алгоритма параметризации чертежей, который базируется на аналитико-синтетическом  методе. Изложены основные задачи, решаемые в процессе реализации алгоритма на каждом этапе его работы. Ключевые слова  — параметризация, чертеж, электронное представление, опорная сеть, графические примитивы, модель, модификация.  

По данным International Data Corporation и журнала Document Management, в мире в электронной форме представлено около 1,5 млрд чертежей, и их количество существенно увеличивается за счет сканирования и векторизации уже имеющихся 6,5 млрд чертежей, хранящихся на бумажных носителях 1. Кроме того, по экспертным оценкам, при модификации старых и проектировании новых изделий и механизмов 80 узлов и деталей не претерпевают существенных изменений в конфигурации 2 по сравнению с изделиямипрототипами. В этой связи одним из важнейших функциональных средств современных конструкторских САПР является инструментарий, обеспечивающий эффективное внесение изменений в файлы описаний существующих чертежей, т. е. их редактирование и модификацию. Под редактированием понимаем возможность изменения параметров одного или нескольких однотипных графических примитивов, а под модификацией изменение ряда различных или даже всех имеющихся примитивов, составляющих изображение или чертеж. Возможность автоматизированного редактирования и модификации чертежей наиболее эффективно решается с использованием параметрических моделей, т. е. описаний, базирующихся на совокупности варьируемых параметров. При условии существования такого описания модификация сводится к заданию нового набора параметров, а все рутинные операции по изменению отдельных примитивов и построению нового чертежа выполняются автоматически. В настоящее время при создании параметрических моделей графических изображений используются два подхода программный и интерактивный. Первый предполагает получение описания модели в терминах процедур пакетов графического расширения, которые в виде библиотек входят в языки высокого уровня. Достоинство такого подхода заключается в том, что при создании модели и формировании на ее основе изображений с новыми размерами не требуется создавать специальные системы трансляции или интерпретации описаний, а может быть использовано общесистемное программное обеспечение. Однако для каждого класса группы объектов необхо димо разрабатывать специальную отдельную программу. При написании таких программ используется труд квалифицированных конструкторов-программистов, и процесс этот длительный и трудоемкий. Программный подход создания параметрических графических моделей из-за своей сложности и невысокой эффективности получил широкое распространение только для параметризации относительно простых и часто используемых графических образов. Этот подход применяется для создания описаний графических объектов, которые часто используются при оформлении конструкторских документов различного назначения. Как правило, это стандартные конструкторские детали болты, гайки, шайбы, винты и т. п. и условные графические образы схем различного типа электронных, электрических, топологических и др.. Таким же образом реализуются элементы оформления конструкторских документов размерные и технологические обозначения, обозначения швов сварных соединений, отверстия различного вида и т. п.. Однако для формирования параметрического описания конструкторских деталей произвольной формы, характерной для подавляющего большинства деталей конструкций, программный подход использовать нецелесообразно. Второй способ интерактивный. В этом случае параметрическая модель создается специализированной автоматизированной системой либо непосредственно в процессе формирования изображения параллельная параметризация, либо на базе ранее созданного графического файла описания последующая параметризация. В первом случае процессы формирования изображения и модели едины, и создать параметрическую модель проще, так как она строится автоматизированной системой одновременно параллельно с прорисовкой изображения. Такой метод называют также методом внутренней параметризации, так как от конструктора для создания модели не требуется никаких дополнительных действий. Система сама фиксирует информацию о способах формирования всех графических примитивов изображения и связей между ними в своих структурах данных. При втором варианте процессы создания изображения и соответствующей ему параметрической модели разделены во времени. При этом в графическом файле описания изображения или чертежа детали в явном виде представлены только данные о графических примитивах, составляющих изображение, и нет явной информации о способах их формирования и взаимных связях. В процессе формирования конструктором чертежа детали и установки на него размерных обозначений происходит экономия количества проставленных размерных обозначений на графических примитивах, которая достигается за счет повторяемости элементов, совпадения у различных примитивов точек и координат, условий параллельности, перпендикулярности и касания отдельных примитивов, за счет постоянства толщины, симметричности, условий связи основных и дополнительных видов и т. п. Экономия размерных обозначений приводит к тому, что большинство графических примитивов чертежа в файле его описания не имеют явной связи с имеющимися на чертеже размерами. Они не могут быть непосредственно изменены в соответствии с изменением значений размерных обозначений, т. е. непосредственная параметрическая связь отсутствует. Поэтому для параметризации такого электронного описания чертежа требуется доопределять его тем или иным образом. Например, при использовании метода параметризации с доопределением параметров приходится устанавливать дополнительные размеры на ряд графических примитивов чертежа. Достоинством метода параллельной параметризации является высокая степень автоматизации формирования модели, основным недостатком невозможность применять его для параметризации созданных изображений чертежей, которые представляются в общепринятых электронных форматах описания GKS, DXF, IG-S и т. п.. В этих случаях можно использовать системы, основанные на методе доопределения размерной сети метод последующей параметризации. Метод доопределения описаний чертежей путем внесения в них дополнительных размерных обозначений, который широко использовался еще совсем недавно, достаточно прост в реализации. Однако его главный недостаток заключается в относительно большом количестве требуемых дополнительных размеров, что существенно усложняет работу конструктора для получения параметрических описаний. В связи с ограничениями метода доопределения предлагается использовать метод аналитикосинтетического формирования параметрической модели чертежа 3 так называемый МАС-параметризации, который можно отнести к полностью автоматическим методам последующей параметризации. Метод не требует прорисовки дополнительных размеров и не предполагает фиксации способа формирования каждого графического примитива при первоначальном создании чертежа, а базируется на анализе имеющегося электронного файла описания чертежа. Метод основывается на том, что совокупность всех размерных обозначений, проставленных в чертеже, полностью определяет конфигурацию изображенного на нем объекта и позволяет по этому чертежу изготовить деталь строго определенной формы, так как чертеж является графическим параметрическим описанием изображенной на нем детали или сборочной конструкции в файле описания чертежа содержится вся информация, необходимая для автоматического построения его твердой копии прорисовки документа типа чертеж путем анализа всех примитивов изображения и их взаимного расположения можно установить параметры каждого графического примитива в зависимости от используемых в этом чертеже размерных обозначений и их конкретных значений, т. е. получить их параметрическое описание, которое способно воспринять и обработать ЭВМ. Эта возможность базируется на том, что чертеж сам является графическим параметрическим описанием, понятным человеку, но в исходном виде не воспринимаемым ЭВМ. Таким образом, метод аналитико-синтетической параметризации обеспечивает автоматическое преобразование одной формы параметрического представления графического, воспринимаемого человеком в форму представления, которую понимает ЭВМ. Следует отметить, что если описание файла чертежа не отвечает отмеченным условиям и по такому чертежу невозможно изготовить конкретную деталь, то такой чертеж следует считать незавершенным, и процесс его параметризации теряет смысл. Для решения общей задачи МАС-параметризации чертежа на основе файла его графического описания должен быть проведен анализ этого описания и осуществлено разделение сортировка всех графических примитивов, составляющих полное описание чертежа на основные отрезки, дуги, окружности, полилинии и т. п., из которых непосредственно формируется образ детали, представленной на чертеже вспомогательные, к которым следует отнести оси различного вида отрезки, дуги и окружности и размерные обозначения макросы или ассоциативные элементы, к которым относятся в первую очередь размерные обозначения разного вида, всевозможные технологические обозначения, сортируемые по типам, тексты примечаний, форматы с основными и дополнительными надписями создание опорной сети чертежа рис. 1. Под этим понятием подразумевается нерегулярная прямоугольная координатная сеть, узлы которой определяются положением всех характерных точек всех основных графических примитивов, составляющих чертеж точек начала, конца, излома отрезков и полилиний, центров и квадрантных точек дуг и окружностей, точек касания, привязки и т. д.. Таким образом устанавливается однозначная связь каждой характерной точки примитивов изображения с элементами сети горизонтальной и вертикальной. При этом для каждого элемента сети можно определить хотя бы один узел, которому можно сопоставить характерную точку одного или нескольких графических примитивов изображения создание угловой сети чертежа, приведенной к первому квадранту. Под этой сетью понимается информация о наклонах всех графических примитивов чертежа, для которого формируется параметрическая модель установление количественных отношений связи между элементами всех созданных сетей через размерные параметры, установленные на чертеже. Эта часть составляет ядро МАС-параметризации, так как, по сути, в результате этого процесса непосредственно создается параметрическая модель анализируемого чертежа. То есть параметрическая модель чертежа есть не что иное, как установленные количественные соотношения между всеми элементами каждой из опорных сетей горизонтальной, вертикальной и угловой через размерные обозначения, поставленные на чертеже, и постоянные коэффициенты, определяемые требованиями ЕСКД на оформление. Общий алгоритм МАС-параметризации, разработанный и реализованный авторами рис. 2, может быть условно разделен на три этапа. На первом, подготовительном этапе блоки осуществляются чтение файла описания чертежа, задание новых значений размерных параметров, анализ графических элементов, входящих в чертеж, разделение их на отдельные группы, исходя из их типов, с одновременным созданием опорных сетей прямоугольных по осям и и угловой. Параллельно с анализом геометрических параметров графических элементов чертежа формируются данные по прямоугольникам, охватывающим области, соответствующие отдельным видам детали, изображенным на чертеже. На основе параметров охватывающих прямоугольников определяются количество и тип видов, имеющихся на чертеже, и устанавливаются количественные параметры связей между всеми выявленными видами. Одновременно определяется базовая точка чертежа, от значений координат которой будут рассчитываться связи между всеми элементами прямоугольных опорных сетей. За базовую точку принимается та, которая связана с главным видом и является либо точкой центральной симметрии этого вида, либо лежит на оси его симметрии, либо с ней связано наибольшее количество линейных размеров, параллельных осям координат. Другие элементы сети считаются определенными, если они непосредственно или опосредованно связаны с базовой точкой через значения размерных обозначений, установленных на чертеже. После определения связей между всеми элементами сетей параметрическая модель чертежа будет полностью определена, и его можно модифицировать перерисовывать в соответствии с новыми значениями размерных обозначений. При этом базовая точка в процессе модификации чертежа преобразованиям не подвергается ее исходные координаты не меняются. Затем на первом этапе осуществляется фиксация простых связей, т. е. определение связей между теми элементами ортогональных сетей, с которыми непосредственно связаны горизонтальные, вертикальные, диаметральные и радиальные размерные обозначения. Одновременно обрабатываются и те элементы сетей, которые определяются дугами и окружностями с такими же радиусами и диаметрами, но расположенными в других местах чертежа, несмотря на то, что на них не установлены размерные обозначения. Следует отметить, что в процессе работы всего алгоритма параметризации при определении значения связи между любыми элементами сети, связанными с любым из видов чертежа, эта связь автоматически переносится на сопряженные виды например, с вида сбоку на виды снизу и сверху и наоборот. Как правило, после первого этапа в основной сети остается ряд неопределенных элементов. Это обусловлено тем, что при создании чертежа часть примитивов формируется с учетом параллельных и угловых размерных обозначений, которые непосредственно не определяют связи между элементами ортогональных сетей. Кроме того, при построении чертежей часто используются различные условия отношений, каждое из которых приводит к уменьшению общего количества размеров, необходимых для однозначного задания формы изображаемой фигуры. К таким отношениям между графическими элементами относятся, как известно, отношения принадлежности, параллельности, касания, симметрии различного типа, перпендикулярности, постоянства толщины или расстояния, а также отношения между основной частью изображения и выноской, отношения типа фаска, развертка и т. д. Поэтому, если после первого этапа опорная сеть оказывается не до конца определенной, ее необходимо доопределить на следующих этапах. На втором этапе блоки определение связей между элементами сетей должно выполняться в циклическом режиме. Это обусловлено тем, что порядок определения параметров сетей сильно зависит от структуры изображения и используемых в нем размерных обозначений. Поэтому определение некоторых элементов сетей может быть выполнено только после предварительного определения других. Начало второго этапа определения элементов ортогональных сетей связано с обработкой параллельных и псевдопараллельных одиночных, сдвоенных и строенных размерных обозначений. При этом под псевдопараллельным размерным обозначением понимается размер, который временно автоматически вводится системой МАСпараметризации вместо обычного параллельного размера например, вместо и рис. 3, вводятся соответственно и рис. 3, . Это делается тогда, когда параллельный размер установлен на отрезке, у которого один или оба его конца связаны условием сопряжения с дугой дугами. При этом исходный параллельный размер см. рис. 3, автоматически заменяется на псевдопараллельный, величина которого определяется величинами исходного размера и радиуса дуги радиусами дуг сопряжения. Таким образом, псевдопараллельный размер устанавливает связь между центрами дуг сопряжения или между центром дуги, если она одна, и свободным концом отрезка. Такая замена существенно упрощает определение связей, так как позволяет вначале установить связи для элементов сети, определяемые центром дуги дуг точкой и точками и см. рис. 3, а только затем определяются связи между этими элементами и элементами, определяемыми точкой точками сопряжения дуги дуг и отрезка см. рис. 3, точками, и, . В дальнейшем приходит доопределение ортогональных сетей и определение элементов угловой сети за счет обработки угловых размерных обозначений. Угловые размеры связаны сразу с двумя сетями горизонтальной и вертикальной, и при их обработке необходимо учитывать значения ранее установленных связей в одной из этих сетей. В случае если опорные сети после выполненных операций все еще определены не полностью, то для каждого неопределенного элемента сети выявляются примитивы изображения, которые связаны с этим элементом. При этом реализуется следующая последовательность операций определяются графические примитивы, к которым относится эта особая точка выявляется вид отношения этих примитивов друг с другом в данной точке сопряжение, пересечение, перпендикулярность и т. д. на основании соотношений, соответствующих выявленному виду связи, определяются количественные значения параметров связи для соответствующих элементов опорной сети с ранее определенными элементами сети. Например, так рассчитывается связь координат точки сопряжения отрезка и дуги с центром дуги на основании определенных параметров свободного конца отрезка и параметров центра и радиуса дуги. При наличии неопределенных элементов после выполнения второго этапа переходят либо к началу второго, либо к третьему этапу. Возврат к началу второго этапа осуществляется, если в ходе его выполнения системой был определен хотя бы один новый элемент сети или выявлена не реализованная в алгоритме ситуация, и конструктор ввел новые данные например, дополнительное разменное обозначение для разрешения этой ситуации. Второй этап завершается либо полным определением сетей чертежа завершением полного построения параметрической модели, либо выходом из неразрешимой ситуации в случае невозможности выявления за весь цикл ни одного нового элемента в любой сети. На третьем, завершающем этапе блоки осуществляется перерисовка образа детали в сети, перестроенной в соответствии с набором новых значений размерных обозначений. После этой перерисовки образа детали идет обработка элементов оформления чертежа осей симметрии, размерных и технологических обозначений и других макросов. Положение осей симметрии определяется соответствующими им элементами опорных сетей, которые уже определены в процессе формирования параметрической модели. Поэтому для их прорисовки необходимо только определить значения координат начала и конца всех осей после модификации основного изображения. Эти значения могут быть найдены, исходя из нового положения графических примитивов основного изображения, за которые оси выступают на величины, соответствующие требованиям ЕСКД. При этом в качестве выступающих за контур изображения значений могут быть взяты значения из исходного описания чертежа. Процесс обработки каждого макроса складывается из двух этапов. Первый связан с определением новой точки привязки и угла наклона. Эти параметры соответствуют исходным условиям привязки макроса к элементам основного изображения и меняются в соответствии с параметрической моделью основного изображения. Второй этап определяется возможностью изменять в ряде случаев содержательную информацию макросов при модификации чертежа. Обычно из-за изменения внутренних параметров макросов их автоматическая обработка в современных подсистемах не предусматривается, т. е. они вообще не включаются в параметрическую модель и не модифицируются, а проставляются конструктором заново. Однако, с нашей точки зрения, при наличии в системе средств идентификации макросов и определения параметров их геометрической связи с основным изображением более целесообразно реализовывать автоматическое определение нового положения макроса на чертеже совместно с оперативным редактированием его содержания. Параметризация установление связей между всеми элементами сетей по представленному алгоритму может быть реализована в функциональном или численном виде. При первом созданную модель необходимо сохранять в отдельном файле, и тогда ее можно использовать многократно для получения модифицированных чертежей. При втором варианте модель формируется каждый раз для конкретного набора значений размеров, вводимых пользователем перед модификацией анализ файла чертежа приходится осуществлять каждый раз заново. На кафедре САПР СПбГЭТУ ЛЭТИ реализован алгоритм в численном варианте на базе системы AutoCAD. Выбор этой системы определялся развитыми программными средствами языка AutoLisp 4 по работе с графическими объектами и связью этой системы с другими конструкторскими системами на основе графических файлов обмена различного типа. Построенная подсистема ускоряет работу конструктора по модификации чертежей в десятки раз. 